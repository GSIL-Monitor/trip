/**
 * Created by Administrator on 2018/2/9.
 */
/** * 可以考虑使用单例的方式只允许一个实例存在 */ var gsSearchClickFirst = 0; $.ready(function () { var Suggest = function (params, element) { var me = this; //defaults 全部参数的默认值 this.defaults = { isShow: true, //是否显示快搜 placeholder: "", //placeholder domainUrl: "", //域名地址 defaultData: {}, //当没有输入关键字时focus后显示的默认数据 callBack: function () { } //enter键时的回调函数 }; //配置参数 var config = { addressUrl: '/SearchSite/Service/Tip' }; //判断是否支持placeholder false是支持，true是不支持 this.noPlaceholder = false; this.noPlaceholder = !('placeholder' in document.createElement('input')); this.params = $.extend({}, this.defaults, params); this.params.addressUrl = this.params.domainUrl + config.addressUrl; this.element = element; this.placeholder = element.attr("placeholder") || this.defaults.placeholder; this.addBox(); this.sgtContainer = $('#gsSuggest'); this.sgtListcon = $('#gsSuggest'); this.setDefault(); this.element.bind('focus', function () { if (gsSearchClickFirst === 0) { me.inputFocus.call(me); }else{ me.element[0].select(); } }); this.element.bind('keydown', function (event) { me.onKeydown.call(me, event); }); this.element.bind('keyup', function (event) { if (me.noPlaceholder) { me.onKeyup.call(me, event); } }); this.element.bind('click', function (e) { if (gsSearchClickFirst === 1) { me.inputFocus.call(me); gsSearchClickFirst = 0; } if (me.sgtContainer[0].style.display == "none") { me.element[0].select(); } e.stopPropagation(); }); $(document).bind('click', function () { me.inputBlur.call(me); }); this.element.bind('contextmenu', function () { me.inputFocus.call(me); }); window.onresize = function () { me.setOffset(me.element, me.sgtContainer); }; }; Suggest.prototype = { oCache: {}, gos: 0, oldValue: '', isHide: true, kCode: { ENTER: 13, UP: 38, DOWN: 40, ESC: 27 }, //获取和设置元素内的value elementVal: function (val) { var element = this.element; if (arguments.length === 0) { return element.value(); //.value() 是cQuery的写法 } else { return element.value(val); } }, addBox: function () { var gsSuggest = document.createElement("div"); gsSuggest.id = "gsSuggest"; document.body.appendChild(gsSuggest); $("#gsSuggest").addClass('keyword_popup'); }, setDefault: function () { var $patent = this.element.parentNode(); var me = this; if (this.noPlaceholder) { var label = document.createElement("label"); label.setAttribute("for", "gsSuggest"); label.style.cssText = "display:inline;position:absolute;cursor:text;top:5px;left:4px;"; label.className = "inputSel"; $patent.append(label); var $pLabel = $patent.find("label"); $pLabel.text("输入城市名或景点名"); this.$pLabel = $pLabel; label.onclick = function () { me.element[0].focus(); }; label.onselectstart = function () { return false; }; $patent.css("position", "relative"); } if (this.elementVal() != '') { this.hidePlaceholder(); } this.element.attr("autocomplete", "off"); //关闭历史记录提示 var width = this.element.offset().width; width -= 2; this.sgtContainer.css("width", width + "px"); }, //缓存原有的搜索结果，keyword是输入的关键字 values后台返回的json addToCache: function (keyword, values) { this.oCache[keyword] = []; this.oCache[keyword] = values; }, checkCache: function (keyword) { if (this.oCache[keyword]) { return true; } }, //获取数据 getSuggestions: function (keyword) { this.oldValue = keyword; var me = this; if (keyword != "" && keyword != this.placeholder) { if (this.checkCache(keyword) == true) { this.displayResults(this.oCache[keyword]); } else { if ($.getJSON) { $.getJSON(this.params.addressUrl + "?Jsoncallback=?", { keyword: escape(keyword) }, function (data) { me.displayResults(data); me.addToCache(keyword, data); }); } else { $.jsonp(this.params.addressUrl + "?Jsoncallback=cQuery.jsonpResponse=&keyword=" + escape(keyword), { charset: 'gb2312', onload: function (data) { me.displayResults(data); me.addToCache(keyword, data); }, onerror: function () { } }); } } } else { me.displayResults(me.params.defaultData); } }, //补全域名 addDomain: function (d) { d = this.params.domainUrl + d; return d; }, displayResults: function (obj) { this.clean(); var me = this; if (me.elementVal() != '' && me.elementVal() != me.placeholder) { var htmlStr = this.sugContents(obj); this.sgtListcon[0].innerHTML = htmlStr; this.setOffset(); this.sgtContainer[0].style.display = "block"; } else { this.clearTime(); this.sgtContainer[0].style.display = "none"; } }, showPlaceholder: function () { if (this.noPlaceholder) { this.$pLabel[0].style.display = "block"; } }, hidePlaceholder: function () { if (this.noPlaceholder) { this.$pLabel[0].style.display = "none"; } }, inputFocus: function () { if (this.params.isShow) { this.clearTime(); this.setTime(); } }, inputBlur: function () { this.sgtContainer[0].style.display = "none"; this.clearTime(); }, onKeyup: function (event) { if (this.elementVal() == "") { this.showPlaceholder(); } else { this.hidePlaceholder(); } }, onKeydown: function (event) { switch (event.keyCode) { case this.kCode.UP: var o = this.sgtListcon.find('a'); if (o.length > 1) { this.gos--; if (this.gos == -1) { this.gos = o.length - 1; } this.selected(this.gos); } else if (o.length == 1) { this.selected(0); }; return false; case this.kCode.DOWN: var o = this.sgtListcon.find('a'); if (o.length > 1) { this.gos++; if (this.gos == 1 && !this.sgtListcon.find('a').hasClass('current')) { this.gos = 0; } if (this.gos == o.length) { this.gos = 0; } this.selected(this.gos); } else if (o.length = 1) { this.selected(0); }; return false; case this.kCode.ENTER: if (!this.params.isShow) { this.params.callBack(); } if (this.elementVal() == this.oldValue) { var iScurrent = 0; this.sgtListcon.find('a').each(function (o) { if (o.hasClass('current')) { iScurrent = 1; } }); if (iScurrent) { window.location.href = this.selected(this.gos).attr('href'); } else { this.params.callBack(); } this.clearTime(); this.oldValue = this.elementVal(); this.sgtContainer[0].style.display = "none"; } return false; case this.kCode.ESC: this.elementVal(''); this.sgtContainer[0].style.display = "none"; return false; default: if (this.params.isShow) { this.setTime(); } } }, selected: function (index) { var $as = this.sgtListcon.find('a'); var obj = $as.eq ? $as.eq(index) : $as.get(index); $as.removeClass("current"); $(obj).addClass("current"); return $(obj); }, clean: function () { this.gos = 0; this.sgtListcon.html(''); }, setOffset: function () { var M = this.element, N = this.sgtContainer, o = M.offset(), h = o.height; N.offset({ top: o.top + h, left: o.left }); }, checkValue: function () { var me = this; if (me.elementVal() != this.oldValue) { me.getSuggestions(me.elementVal()); } else { if (this.sgtContainer[0].style.display == "none") { me.getSuggestions(me.elementVal()); } } if (this.params.isShow) { this.clearTime(); this.setTime(); } }, setTime: function () { var me = this; function check() { me.checkValue(); } this.timeOut = setTimeout(check, 200); }, clearTime: function () { if (this.timeOut != 0) { clearTimeout(this.timeOut); } }, sugContents: function (obj) { var html = ''; var keywordVal = this.elementVal(); //攻略 if (obj.GuideList) { var li = []; var len = obj.GuideList.length; if (len != 0) { for (var i = 0; i < len; i++) { var item = obj.GuideList[i], name = item.Name; matchName = name.match(new RegExp(keywordVal, "i")); name = name.replace(matchName, '' + matchName + '') + "旅游攻略"; li.push(''); li.push('
    '); if (i === 0) { li.push(' 攻略'); } li.push(name); li.push('

    '); li.push(''); } html = '
    ' + li.join('') + '
    '; } } //目的地 if (obj.DestList) { var li = []; var len = obj.DestList.length; if (len != 0) { for (var i = 0; i < len; i++) { var item = obj.DestList[i], name = item.Name, eName = ""; if (item.DestName != null && item.DestName != "") { name += ", " + item.DestName; } if (item.EName != null && item.EName != "") { eName = item.EName; if (item.DestEName != null && item.DestEName != "") { eName = eName + ", " + item.DestEName; } } matchName = name.match(new RegExp(keywordVal, "i")); matchEName = eName.match(new RegExp(keywordVal, "i")); name = name.replace(matchName, '' + matchName + ''); eName = eName.replace(matchEName, '' + matchEName + ''); li.push(''); li.push('
    '); if (i === 0) { li.push(' 目的地'); } li.push(name); li.push('

    '); li.push('
    '); if (eName != null && eName != "") { li.push(' ' + eName + ''); } li.push('

    '); li.push(''); } html += '
    ' + li.join('') + '
    '; } } //景点 if (obj.SightList) { var li = []; var len = obj.SightList.length; if (len != 0) { for (var i = 0; i < len; i++) { var item = obj.SightList[i], name = item.Name, eName = ""; if (item.DestName != null && item.DestName != "") { name += ", " + item.DestName; } if (item.EName != null && item.EName != "") { eName = item.EName; if (item.DestEName != null && item.DestEName != "") { eName = eName + ", " + item.DestEName; } } matchName = name.match(new RegExp(keywordVal, "i")); matchEName = eName.match(new RegExp(keywordVal, "i")); name = name.replace(matchName, '' + matchName + ''); eName = eName.replace(matchEName, '' + matchEName + ''); li.push(''); li.push('
    '); if (i === 0) { li.push(' 景点'); } li.push(name); li.push('

    '); li.push('
    '); if (eName != null && eName != "") { li.push(' ' + eName + ''); } li.push('

    '); li.push(''); } html += '
    ' + li.join('') + '
    '; } } //问答 if (obj.QAUrl) { var li = []; li.push('
    '); li.push(' '); li.push('
    ') li.push(' 问答') li.push(' 搜索“' + keywordVal + '”的相关问答'); li.push('

    '); li.push(' '); li.push('
    '); html += li.join(''); } //游记 if (obj.TravelsUrl) { var li = []; li.push('
    '); li.push(' '); li.push('
    ') li.push(' 游记') li.push(' 搜索“' + keywordVal + '”的相关游记'); li.push('

    '); li.push(' '); li.push('
    '); html += li.join(''); } //搜索更多 if (obj.SearchUrl) { var li = []; li.push('
    '); li.push(' '); li.push(' 搜索更多关于“' + keywordVal + '”'); li.push(' '); li.push('
    '); html += li.join(''); } return html; } }; $('#submit5').bind("click", function () { gs_searchbox(); return false; }); function gs_searchbox() { var searchURL = gs_config.domain + '/SearchSite/?query='; var query = sug.elementVal() || ''; if (('景点名和城市名') == query) { query = ''; } if (query != "") { window.location.href = searchURL + escape(query); } } var sug = new Suggest({ isShow: true, domainUrl: gs_config.domain, callBack: function () { gs_searchbox(); } }, $('#gsSearch')); }); //You may also like (data array) var gsAlsoLikeArr = [["昆明", "http://you.ctrip.com/place/kunming29.html"], ["大理", "http://you.ctrip.com/place/dali31.html"], ["腾冲", "http://you.ctrip.com/place/tengchong696.html"], ["拉萨", "http://you.ctrip.com/place/lhasa36.html"], ["林芝", "http://you.ctrip.com/place/linzhi126.html"], ["桂林", "http://you.ctrip.com/place/guilin28.html"], ["阳朔", "http://you.ctrip.com/place/yangshuo702.html"], ["北海", "http://you.ctrip.com/place/beihai140.html"], ["南宁", "http://you.ctrip.com/place/nanning166.html"], ["敦煌", "http://you.ctrip.com/place/dunhuang8.html"], ["甘南", "http://you.ctrip.com/place/gannan426.html"], ["兰州", "http://you.ctrip.com/place/lanzhou231.html"], ["银川", "http://you.ctrip.com/place/yinchuan239.html"], ["西宁", "http://you.ctrip.com/place/xining237.html"], ["成都", "http://you.ctrip.com/place/chengdu104.html"], ["乐山", "http://you.ctrip.com/place/leshan103.html"], ["重庆", "http://you.ctrip.com/place/chongqing158.html"], ["海口", "http://you.ctrip.com/place/haikou37.html"], ["婺源", "http://you.ctrip.com/place/wuyuan446.html"], ["庐山", "http://you.ctrip.com/place/lushan20.html"], ["宜春", "http://you.ctrip.com/place/yichun743.html"], ["大连", "http://you.ctrip.com/place/dalian4.html"], ["沈阳", "http://you.ctrip.com/place/shenyang155.html"], ["丹东", "http://you.ctrip.com/place/dandong315.html"], ["长春", "http://you.ctrip.com/place/changchun216.html"], ["延边", "http://you.ctrip.com/place/yanbian415.html"], ["伊春", "http://you.ctrip.com/place/yichun498.html"], ["泉州", "http://you.ctrip.com/place/quanzhou243.html"], ["广州", "http://you.ctrip.com/place/guangzhou152.html"], ["深圳", "http://you.ctrip.com/place/shenzhen26.html"], ["珠海", "http://you.ctrip.com/place/zhuhai27.html"], ["湘西", "http://you.ctrip.com/place/xiangxi496.html"], ["长沙", "http://you.ctrip.com/place/changsha148.html"], ["青岛", "http://you.ctrip.com/place/qingdao5.html"], ["泰山", "http://you.ctrip.com/place/taishan6.html"], ["威海", "http://you.ctrip.com/place/weihai169.html"], ["烟台", "http://you.ctrip.com/place/yantai170.html"], ["杭州", "http://you.ctrip.com/place/hangzhou14.html"], ["西塘", "http://you.ctrip.com/place/xitang15.html"], ["绍兴", "http://you.ctrip.com/place/shaoxing18.html"], ["宁波", "http://you.ctrip.com/place/ningbo83.html"], ["舟山", "http://you.ctrip.com/place/zhoushan479.html"], ["南浔", "http://you.ctrip.com/place/nanxun80.html"], ["安吉", "http://you.ctrip.com/place/anji686.html"], ["武汉", "http://you.ctrip.com/place/wuhan145.html"], ["三峡", "http://you.ctrip.com/place/threegorges109.html"], ["西安", "http://you.ctrip.com/place/xian7.html"], ["上海", "http://you.ctrip.com/place/shanghai2.html"], ["北京", "http://you.ctrip.com/place/beijing1.html"], ["天津", "http://you.ctrip.com/place/tianjin154.html"], ["承德", "http://you.ctrip.com/place/chengde135.html"], ["坝上", "http://you.ctrip.com/place/bashang120073.html"], ["平遥", "http://you.ctrip.com/place/pingyao365.html"], ["大同", "http://you.ctrip.com/place/datong275.html"], ["洛阳", "http://you.ctrip.com/place/luoyang198.html"], ["郑州", "http://you.ctrip.com/place/zhengzhou157.html"], ["嵩山", "http://you.ctrip.com/place/songshan178.html"], ["开封", "http://you.ctrip.com/place/kaifeng165.html"], ["苏州", "http://you.ctrip.com/place/suzhou11.html"], ["无锡", "http://you.ctrip.com/place/wuxi10.html"], ["南京", "http://you.ctrip.com/place/nanjing9.html"], ["扬州", "http://you.ctrip.com/place/yangzhou12.html"], ["周庄", "http://you.ctrip.com/place/zhouzhuang81.html"], ["常州", "http://you.ctrip.com/place/changzhou206.html"], ["澳门", "http://you.ctrip.com/place/macau39.html"], ["台北", "http://you.ctrip.com/place/taipeicity360.html"], ["垦丁", "http://you.ctrip.com/place/kending1380.html"], ["高雄", "http://you.ctrip.com/place/gaoxiong756.html"], ["东京", "http://you.ctrip.com/place/tokyo294.html"], ["冲绳", "http://you.ctrip.com/place/okinawa292.html"], ["大阪", "http://you.ctrip.com/place/osaka293.html"], ["箱根", "http://you.ctrip.com/place/hakone60571.html"], ["首尔", "http://you.ctrip.com/place/seoul234.html"], ["釜山", "http://you.ctrip.com/place/busan432.html"], ["沙巴", "http://you.ctrip.com/place/sabah538.html"], ["曼谷", "http://you.ctrip.com/place/bangkok191.html"], ["清迈", "http://you.ctrip.com/place/chiangmai209.html"], ["华欣", "http://you.ctrip.com/place/huahin674.html"], ["甲米", "http://you.ctrip.com/place/krabitown616.html"], ["吴哥", "http://you.ctrip.com/place/siemreap599.html"], ["日惹", "http://you.ctrip.com/place/yogyakarta437.html"], ["开罗", "http://you.ctrip.com/place/cairo326.html"], ["迪拜", "http://you.ctrip.com/place/dubai1062.html"], ["雅典", "http://you.ctrip.com/place/athens382.html"], ["伦敦", "http://you.ctrip.com/place/london309.html"], ["巴黎", "http://you.ctrip.com/place/paris308.html"], ["里昂", "http://you.ctrip.com/place/lyon391.html"], ["柏林", "http://you.ctrip.com/place/berlin306.html"], ["罗马", "http://you.ctrip.com/place/rome303.html"], ["米兰", "http://you.ctrip.com/place/milan304.html"], ["悉尼", "http://you.ctrip.com/place/sydney236.html"], ["斐济", "http://you.ctrip.com/place/fiji100102.html"], ["纽约", "http://you.ctrip.com/place/newyork248.html"], ["关岛", "http://you.ctrip.com/place/guam1422.html"] ]; function gsAlsoLike() { var len = gsAlsoLikeArr.length, ran = parseInt(len * Math.random()), arr = []; for (var i = 0; i < 8; i++) { var flag = 0; do { flag = 0; for (var j = 0; j < arr.length; j++) { if (arr[j] == ran) { flag = 1; break; } } if (!flag) { arr[arr.length] = ran; } else { ran = parseInt(len * Math.random()); } } while (flag); } $("#gs_indexform p[data-may-like]")[0].innerHTML = ""; var html = '猜你喜欢：'; for (var m = 0; m < arr.length; m++) { var num = arr[m], text = gsAlsoLikeArr[num][0], url = gsAlsoLikeArr[num][1]; html += '' + text + ''; } $("#gs_indexform p[data-may-like]")[0].innerHTML = html; } function youSF() { gsAlsoLike(); gsSearchClickFirst = 1; if(!$.browser.isIPad){ $('#gsSearch')[0].focus(); $('#gsSearch')[0].select(); } }/*****env:2,update:2014-3-4 19:15:18*****//*****$endoflist$*****/