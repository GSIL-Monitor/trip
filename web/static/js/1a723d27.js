/**
 * Created by Administrator on 2018/2/9.
 */
//Online Version 20170414 var busBaseUrl = '//bus.ctrip.com'; var busFromAddress = null; var busToAddress = null; var busMaxDays = new Date().addDays(29).toFormatString('yyyy-MM-dd'); var maxDay = GetMaxDate(); //限售天数 var railsBaseUrl = '//rails.ctrip.com/'; //新增60天限售规则 function GetMaxDate() { var nowDate = new Date(); var nowDay = nowDate.getFullYear() + "-" + (nowDate.getMonth() + 1) + "-" + nowDate.getDate(); var myDate = new Date("2014/12/01"); if (nowDate < myDate) { return 19; } switch (nowDay) { case "2014-12-1": return 29; case "2014-12-2": return 35; case "2014-12-3": return 41; case "2014-12-4": return 47; case "2014-12-5": return 53; case "2014-12-6": return 59; default: return 59; } } $.ready(function () { $("#countAdult").value("1"); $("#countChild").value("0"); $("#countYouth").value("0"); $("#countOld").value("0"); var mindays = new Date().addDays(0).toFormatString('yyyy-MM-dd'); var maxdays = new Date().addDays(maxDay).toFormatString('yyyy-MM-dd'); var calendarStartDateForeign = new Date().addDays(7).toFormatString('yyyy-MM-dd'); bindEvent(document.getElementById("trainBody"), "click", handlePopup); $("#countAdult,#countChild,#countYouth,#countOld").bind("change", function (event) { if ($(event.target).value() == 0) { $(event.target).addClass('pep_numnone'); } else { $(event.target).removeClass('pep_numnone'); } }); $("#searchBoxUl li").bind("click", function (e) { if ($(getEventTarget(e)).parentNode().attr('styletag').toLowerCase().trim() != 'train') { $("li[styletag='train']")[0].className = "s_tab_nocurrent"; $("div[styletag='train']")[0].style.display = "none"; } }); $("#trainSwitch a").bind("click", function (e) { $("#trainSwitch a").each(function (a) { $(a)[0].className = ""; }); $(this).addClass("current"); if ($(this).attr("data-index") == 0) { $("#train")[0].style.display = ""; $("#outie")[0].style.display = "none"; $("#bus")[0].style.display = "none"; } else if ($(this).attr("data-index") == 2) { $("#train")[0].style.display = "none"; $("#outie")[0].style.display = "none"; $("#bus")[0].style.display = ""; } else { $("#train")[0].style.display = "none"; $("#outie")[0].style.display = ""; $("#bus")[0].style.display = "none"; } }); $("#outieType input[type='radio']").bind("click", function (e) { if ($(this)[0].value.toLowerCase() == 'single') { document.getElementById("outieNonThrough").style.display = ""; document.getElementById("outieThrough").style.display = "none"; document.getElementById("outieSeat").style.display = "none"; if (!$("#outieRoundHolder").hasClass("s_disable")) { $("#outieRoundHolder").addClass("s_disable"); $("#txtDateTo").addClass("inputSel"); } } else if ($(this)[0].value.toLowerCase() == 'round') { document.getElementById("outieNonThrough").style.display = ""; document.getElementById("outieThrough").style.display = "none"; document.getElementById("outieSeat").style.display = "none"; if ($("#outieRoundHolder").hasClass("s_disable")) { $("#outieRoundHolder").removeClass("s_disable"); $("#txtDateTo").removeClass("inputSel"); } } else if ($(this)[0].value.toLowerCase() == 'seat') { document.getElementById("outieNonThrough").style.display = "none"; document.getElementById("outieThrough").style.display = "none"; document.getElementById("outieSeat").style.display = ""; } else if ($(this)[0].value.toLowerCase() == 'through') { document.getElementById("outieNonThrough").style.display = "none"; document.getElementById("outieThrough").style.display = ""; document.getElementById("outieSeat").style.display = "none"; } }); $("#txtDateTo").bind("click", function () { if ($("#outieRoundHolder").hasClass("s_disable")) { $("#outieRoundHolder").removeClass("s_disable"); $("#txtDateTo").removeClass("inputSel"); } $("#outieType input[type='radio'][value='Round']")[0].checked = 'checked'; }); $.mod.load('notice', PluginsVersion.notice, function () { tipComm($('#txtCountryName'), "中文/拼音/首字母"); }); pCount.each(function (el) { pops.push([el[1][0], el[0][0]]); el[0].bind("click", function (e) { el[1][0].style.display = ""; }); $("a", el[1][0]).bind("click", function (e) { el[1][0].style.display = "none"; el[0][0].value = $(this)[0].innerHTML.trim(); }); }); regAddressInternet("#txtCityFrom", "txtCityFrom", "#hiddenStartCityCode", "#hiddenStartCityName"); regAddressInternet("#txtCityTo", "txtCityTo", "#hiddenDestCityCode", "#hiddenDestCityName"); regAddressInternet("#zuoweiCityFrom", "zuoweiCityFrom", "#hiddenzuoweiStartCityCode", "#hiddenzuoweiStartCityName"); regAddressInternet("#zuoweiCityTo", "zuoweiCityTo", "#hiddenzuoweiDestCityCode", "#hiddenzuoweiDestCityName"); regAddressInternetCountry("#txtCountryName", "txtCountryName", "#hidcountry"); if ($("#txtDateFrom").value().trim() == "") { $("#txtDateFrom").value((new Date()).addDays(1).toFormatString('yyyy-MM-dd')); } if ($("#txtDateTo").value().trim() == "") { $("#txtDateTo").value((new Date()).addDays(7).toFormatString('yyyy-MM-dd')); } if ($("#zuoweiDateFrom").value().trim() == "") { $("#zuoweiDateFrom").value((new Date()).addDays(1).toFormatString('yyyy-MM-dd')); } $.mod.load("jmp", '1.0', function () { $('#seatjmp').regMod('jmp', '1.0', { options: { boundaryShow: false, css: { maxWidth: '320', minWidth: '300' }, type: 'jmp_title', position: 'bottomLeft-topLeft', classNames: { boxType: 'jmp_title' }, template: '#seat_jmp_title', content: { txt1: '谁需要预订？只有通票持有人才需要预订座位，请注意如果只预订座位但是没有购买通票是无法登车旅行的。
为什么预订？在欧洲许多列车除了您购买的通票之外，还必须购买预订以确保您的座位。如观光火车和高速火车以及夜火车。请注意，在大部分国家如法国、意大利、西班牙的高速列车都是强制订座。另外，预订座位的费用并没有包含在通票中。
为什么需要提前预订？通票对应的座位在每列列车上都是有限的。如果到车站再订座，可能会遇到满位情况，而不得不乘坐下一班列车。
购买何种订座？请挑选与您购买或准备购买通票对应的订座舱位。
如您购买了法国通票，但计划乘坐从巴黎-琉森的订座。请选择对应法国通票的订座（价格相较购买了包含法国和瑞士通票对应的订座费用要高出一些）。
同样，如您购买了Eurail pass（多国通票）乘坐法国境内的列车 如巴黎-阿维尼翁，也请购买对应Eruail pass 的订座价格而不要购买对应法国通票（france pass）的订座。两者价格也可能略有不同。'}} }) }); var calendarCommContryOutTie = function (dateStr, startDate, endDate) { dateStr.regMod('calendar', PluginsVersion.calendar, { options: { minDate: startDate, maxDate: endDate, showWeek: 0 }, listeners: { onChange: function (input, value) { } } }); } $.mod.load('calendar', PluginsVersion.calendar, function () { calendarCommContryOutTie($('#txtDateFrom'), ((new Date()).addDays(1).toFormatString('yyyy-MM-dd')), (new Date()).addDays(180).toFormatString('yyyy-MM-dd')); calendarCommContryOutTie($('#txtDateTo'), ((new Date()).addDays(1).toFormatString('yyyy-MM-dd')), (new Date()).addDays(180).toFormatString('yyyy-MM-dd')); calendarCommContryOutTie($('#zuoweiDateFrom'), ((new Date()).addDays(1).toFormatString('yyyy-MM-dd')), (new Date()).addDays(180).toFormatString('yyyy-MM-dd')) }); $.mod.load('validate', PluginsVersion.validate, function () { var valid = $(document).regMod("validate", PluginsVersion.validate); var validateShow = function (obj, message) { setTimeout(function () { valid.method("show", { $obj: obj, data: message, removeErrorClass: true, hideEvent: "blur", isFocus: true }); }) return false; }; $("#searchOutiePTP").bind("click", function (e) { var countAdult = $("#countAdult").value(); var countChild = $("#countChild").value(); var countYouth = $("#countYouth").value(); var countOld = $("#countOld").value(); var totalCounts = countAdult + countChild + countYouth + countOld; if (totalCounts == 0) { validateShow($("#countAdult"), '预订人数总计不能为0'); return false; } if (document.getElementById("rdoOneWay").checked || document.getElementById("rdoPly").checked) { if ($("#txtCityFrom").value().trim() == "中文/拼音/英文" || $("#txtCityFrom").value().trim() == "") validateShow($("#txtCityFrom"), "请输入出发城市名称"); else if ($("#txtCityTo").value().trim() == "中文/拼音/英文" || $("#txtCityTo").value().trim() == "") validateShow($("#txtCityTo"), "请输入到达城市名称"); else if ($("#txtCityFrom").value().trim() == $("#txtCityTo").value().trim()) validateShow($("#txtCityTo"), "您选择的目的城市和出发城市相同，请重新选择"); else if ($("#txtDateFrom").value().trim().replace(/\//g, '-').trim() == "yyyy-mm-dd" || $("#txtDateFrom").value().trim() == "") { validateShow($("#txtDateFrom"), "请选择出发日期"); } else if( ($("#txtDateFrom").value().trim().replace(/\//g, '-').trim() == (new Date()).addDays(1).toFormatString('yyyy-MM-dd') || (new Date($("#txtDateFrom").value().trim().replace(/\//g, '-').trim())).getTime() > (new Date()).addDays(27).getTime()) && $("#hiddenStartCityCode").value().substring(0,2) == 'TW') validateShow($("#txtDateFrom"), "台湾火车票只支持一日后及27天之内的车次，请重新选择日期"); else if( ($("#txtDateTo").value().trim().replace(/\//g, '-').trim() == (new Date()).addDays(1).toFormatString('yyyy-MM-dd') || (new Date($("#txtDateTo").value().trim().replace(/\//g, '-').trim())).getTime() > (new Date()).addDays(27).getTime()) && $("#hiddenStartCityCode").value().substring(0,2) == 'TW') validateShow($("#txtDateTo"), "台湾火车票只支持一日后及27天之内的车次，请重新选择日期"); else if (document.getElementById("rdoPly").checked && ($("#txtDateTo").value().trim().replace(/\//g, '-').trim() == "yyyy-mm-dd" || $("#txtDateTo").value().trim() == "")) validateShow($("#txtDateTo"), "请选择返回日期"); else { returnd = ""; if (document.getElementById("rdoPly").checked) { var strdeDate = document.getElementById("txtDateFrom").value.trim().replace(/\-/g, '/'); var strbaDate = document.getElementById("txtDateTo").value.trim().replace(/\-/g, '/'); var dtdeDate = new Date(strdeDate); var dtbaDate = new Date(strbaDate); if (dtdeDate > dtbaDate) { validateShow($("#txtDateTo"), '返回日期不能小于出发日期'); return false; } //返回日期 arrivateDate = $('#txtDateTo').value().trim().replace(/\-/g, '/'); returnd = Math.ceil((new Date(arrivateDate) - new Date()) / (60 * 60 * 24 * 1000)) + 1; } var departureDate = document.getElementById("txtDateFrom").value.trim().replace(/\-/g, '/'); var d = Math.ceil((new Date(departureDate) - new Date()) / (60 * 60 * 24 * 1000)) + 1; var day = ""; if (d > 1) day = "-d" + d; var baseUrl = "http://trains.ctrip.com/TrainBooking"; // document.getElementById('locationUrl').value; var indexStart = baseUrl.indexOf("."); var indexEnd = baseUrl.lastIndexOf("/"); var len = indexEnd - indexStart; var urlparam = baseUrl.substr(indexStart, len); var url = "http://vacations" + urlparam + "/REBooking/SearchResult"; //单程跳转 var Url = "http://rails.ctrip.com/international/PTPProductList.aspx?from=" + $("#hiddenStartCityCode").value() + "&startCityName=" + $("#hiddenStartCityName").value() + "&destCityName=" + $("#hiddenDestCityName").value() + "&to=" + $("#hiddenDestCityCode").value() + "&departureDate=" + $("#txtDateFrom").value() + "&starttime=06:00-12:00" + "&adult=" + countAdult + "&child=" + countChild + "&youth=" + countYouth + "&seniors=" + countOld + "" //往返跳转 if (document.getElementById("rdoPly").checked) { Url += "&arriveDate=" + $("#txtDateTo").value() + "&backtime=06:00-12:00&searchType=1&pageStatus=0"; } else { Url += "&searchType=0&pageStatus=0"; } Url += "&passHolders=0"; searchLoading($(this)); window.location.href = Url; e.preventDefault(); } } }); //通票查询 $("#searchOutieThrough").bind("click", function (e) { if ($('#txtCountryName').value().trim() == "") validateShow($('#txtCountryName'), '请选择国家名称'); else { var url = "http://rails.ctrip.com/international/PassFamilySearch.aspx?countryName=" + $("#txtCountryName").value() + "&country=" + $("#hidcountry").value(); searchLoading($(this)); window.location.href = url; e.preventDefault(); } }); //订座查询 $("#zuoweiSearch").bind("click", function (e) { if ($("#zuoweiCityFrom").value().trim() == "中文/英文" || $("#zuoweiCityFrom").value().trim() == "") validateShow($("#zuoweiCityFrom"), "请输入出发城市名称"); else if ($("#zuoweiCityTo").value().trim() == "中文/英文" || $("#zuoweiCityTo").value().trim() == "") validateShow($("#zuoweiCityTo"), "请输入到达城市名称"); else if ($("#zuoweiCityFrom").value().trim() == $("#zuoweiCityTo").value().trim()) validateShow($("#zuoweiCityTo"), "您选择的目的城市和出发城市相同，请重新选择"); else if ($("#zuoweiDateFrom").value().trim().replace(/\//g, '-').trim() == "yyyy-mm-dd" || $("#zuoweiDateFrom").value().trim() == "") validateShow($("#zuoweiDateFrom"), "请选择出发日期"); else { var Url = "http://rails.ctrip.com/international/PTPProductList.aspx?from=" + $("#hiddenzuoweiStartCityCode").value() + "&startCityName=" + $("#hiddenzuoweiStartCityName").value() + "&destCityName=" + $("#hiddenzuoweiDestCityName").value() + "&to=" + $("#hiddenzuoweiDestCityCode").value() + "&departureDate=" + $("#zuoweiDateFrom").value() + "&starttime=06:00-12:00"; Url += "&searchType=0&pageStatus=0"; Url += "&passHolders=" + $("#passengerNumbers").value(); window.location.href = Url; } }); }); var langObj = { 'PRO': { 'GB': 'http://trains.ctrip.com/', 'HK': 'http://trains.big5.ctrip.com/', 'BIG5': 'http://trains.big5.ctrip.com/' }, 'UAT_NT': { 'GB': 'http://trains.uat.qa.nt.ctripcorp.com/', 'HK': 'http://trains.big5.uat.qa.nt.ctripcorp.com/', 'BIG5': 'http://trains.big5.uat.qa.nt.ctripcorp.com/' }, 'TEST': { 'GB': 'http://trains.testu.sh.ctriptravel.com/', 'HK': 'http://trains.big5.testu.sh.ctriptravel.com/', 'BIG5': 'http://trains.big5.testu.sh.ctriptravel.com/' } ,'FAT': { 'GB': 'http://trains.fat22.qa.nt.ctripcorp.com/', 'HK': 'http://trains.big5.fat22.qa.nt.ctripcorp.com/', 'BIG5': 'http://trains.big5.fat22.qa.nt.ctripcorp.com/' } }; var baseUrl = window.location.href.match(/(..)+\/\b/g)[0]; if (baseUrl) baseUrl = baseUrl.replace("www", "trains"); var lang = 'GB'; var solution = document.getElementById('solution'); var langArr = solution && solution.value && solution.value.toUpperCase().split('|'); if (langArr && langArr.length) { lang = langArr[1]; baseUrl = langObj[langArr[0]][langArr[1]]; } var big5Str = ""; if (lang != "GB") { big5Str = ".big5"; } else { big5Str = ""; } jsonFilterUrl = "//webresource.c-ctrip.com/ResTrainOnline/R1/TrainBooking/JS/station_gb2312.js"; if (big5Str != "") { jsonFilterUrl = "//webresource.c-ctrip.com/code/cquery/resource/address/train_new/station_big5.js"; } $("#btnclose").bind('click', function () { $("#hubtip").css("display", "none"); }) document.getElementById("singleTrip").checked = true; $("#ArraveDate").css("color", "gray"); $("#singleTrip").bind("click", function () { SelectTrip(); }); var sel = { from: $('#from'), to: $('#to'), hub: $('#hub'), fromCn: $('#notice01'), toCn: $('#notice02'), hubCn: $('#notice03'), departureDate: $('#DdateObj'), arriveDate: $('#AdateObj'), gosearchCountry: $('#searchTicket') }; var getCookie = function () { var m = cQuery.cookie.get('TrainLastSearch'); m = (m ? m : "").split("|"); if (m[4] != "" && m[4] != undefined) { if (unescape(m[4]) < mindays) { sel.departureDate[0].value = mindays; } else { sel.departureDate[0].value = unescape(m[4]); } changeColor("#DdateObj"); } } getCookie(); var setCookie = function () { var arrDate = ""; if (document.getElementById("roundTrip").checked) { arrDate = sel.arriveDate[0].value.trim(); } var cookiedomain = window.location.host.replace(/www\.|big5\./, ''); cQuery.cookie.set('TrainLastSearch', null, sel.fromCn[0].value.trim() + '|' + sel.from[0].value.trim() + '|' + sel.toCn[0].value.trim() + '|' + sel.to[0].value.trim() + '|' + sel.departureDate[0].value.trim() + '|' + arrDate, { expires: 30, domain: cookiedomain, path: '/' }); } $.mod.load('address', PluginsVersion.address, function () { CtripHomePage.Train.ControlElement.noticeHubAddress = regAddress(sel.hubCn, 'notice03', '#hub', jsonFilterUrl); }); $.mod.load('calendar', PluginsVersion.calendar, function () { calendarCommContry(sel.departureDate, mindays, maxdays); }); $.mod.load('calendar', PluginsVersion.calendar, function () { if (sel.departureDate[0].value.trim() != "yyyy-mm-dd") { var departdays = new Date(sel.departureDate[0].value.trim().replace(/\-/g, '/')).toFormatString('yyyy-MM-dd'); calendarCommContry(sel.arriveDate, departdays, maxdays); } else { calendarCommContry(sel.arriveDate, mindays, maxdays); } }); $.mod.load('notice', PluginsVersion.notice, function () { tipComm(sel.fromCn, "中文/拼音/首字母"); tipComm(sel.toCn, "中文/拼音/首字母"); tipComm(sel.hubCn, "中文/拼音/首字母"); tipComm(sel.departureDate, "yyyy-mm-dd"); tipComm(sel.arriveDate, "yyyy-mm-dd"); }); $.mod.load('validate', PluginsVersion.validate, function () { var valid = $(document).regMod("validate", PluginsVersion.validate); var validateShow = function (obj, message) { setTimeout(function () { valid.method("show", { $obj: obj, data: message, removeErrorClass: true, hideEvent: "blur", isFocus: true }); }) return false; }; sel.gosearchCountry.bind('click', function (e) { if (sel.fromCn[0].value.trim() == "中文/拼音/首字母" || sel.fromCn[0].value.trim() == "") { validateShow(sel.fromCn, "请输入出发城市名称"); return false; } if (sel.toCn[0].value.trim() == "中文/拼音/首字母" || sel.toCn[0].value.trim() == "") { validateShow(sel.toCn, "请输入到达城市名称"); return false; } if (sel.departureDate[0].value.replace(/\//g, '-').trim() == "yyyy-mm-dd" || sel.departureDate[0].value.trim() == "") { validateShow(sel.departureDate, "请选择出发日期"); return false; } if (!sel.departureDate[0].value.replace(/\//g, '-').trim().isDate()) { validateShow(sel.departureDate, "出发日期格式不正确"); return false; } if (new Date(sel.departureDate[0].value.trim().replace(/\-/g, '/')).getTime() < new Date(mindays.replace(/\-/g, '/')).getTime()) { validateShow(sel.departureDate, "出发日期不能小于" + mindays); return false; } if (new Date(sel.departureDate[0].value.trim().replace(/\-/g, '/')).getTime() > new Date(maxdays.replace(/\-/g, '/')).getTime()) { validateShow(sel.departureDate, "出发日期不能大于" + maxdays); return false; } var d2 = ""; if (document.getElementById("roundTrip").checked) { if (sel.arriveDate[0].value.replace(/\//g, '-').trim() == "yyyy-mm-dd" || sel.arriveDate[0].value.trim() == "") { validateShow(sel.arriveDate, "请选择返回日期"); return false; } if (!sel.arriveDate[0].value.replace(/\//g, '-').trim().isDate()) { validateShow(sel.arriveDate, "返回日期格式不正确"); return false; } if (new Date(sel.arriveDate[0].value.trim().replace(/\-/g, '/')).getTime() < new Date(sel.departureDate[0].value.trim().replace(/\-/g, '/')).getTime()) { validateShow(sel.arriveDate, "返回日期不能小于" + sel.departureDate[0].value.trim().replace(/\//g, '-')); return false; } if (new Date(sel.arriveDate[0].value.trim().replace(/\-/g, '/')).getTime() > new Date(maxdays.replace(/\-/g, '/')).getTime()) { validateShow(sel.arriveDate, "返回日期不能大于" + maxdays); return false; } arriveDate = sel.arriveDate[0].value.trim().replace(/\-/g, '/'); d2 = Math.ceil((new Date(arriveDate) - new Date()) / (60 * 60 * 24 * 1000)) + 1; } departureDate = sel.departureDate[0].value.trim().replace(/\-/g, '/'); var d = Math.ceil((new Date(departureDate) - new Date()) / (60 * 60 * 24 * 1000)) + 1; var day = ""; if (d > 1) { day = "-d" + d; } try { if ($("#to").value().trim() == "") { CtripHomePage.Train.ControlElement.noticeToAddress.method("validate"); } if ($("#from").value().trim() == "") { CtripHomePage.Train.ControlElement.noticeFromAddress.method("validate"); } if ($("#from").value().trim() != '' && $("#to").value().trim() != '') { var url = baseUrl + "TrainBooking/" + sel.from[0].value.trim() + "-" + sel.to[0].value.trim() + day; if (document.getElementById("singleTrip").checked) { url = baseUrl + "TrainBooking/Search.aspx?from=" + sel.from[0].value.trim() + "&to=" + sel.to[0].value.trim() + "&day=" + d + "&fromCn=" + sel.fromCn[0].value.trim() + "&toCn=" + sel.toCn[0].value.trim(); } else if (document.getElementById("roundTrip").checked) { url = baseUrl + "TrainBooking/RoundTrip.aspx?from=" + sel.from[0].value.trim() + "&to=" + sel.to[0].value.trim() + "&dayreturn=" + d2 + "&day=" + d + "&fromCn=" + sel.fromCn[0].value.trim() + "&toCn=" + sel.toCn[0].value.trim(); } else if (document.getElementById("hubTrip").checked) { if (sel.hub.value().trim() == "") { url = baseUrl + "TrainBooking/HubSingleTrip.aspx?from=" + sel.from[0].value.trim() + "&to=" + sel.to[0].value.trim() + "&jumpflag=2" + "&day=" + d + "&fromCn=" + sel.fromCn[0].value.trim() + "&toCn=" + sel.toCn[0].value.trim(); } else { url = baseUrl + "TrainBooking/HubRoundTrip.aspx?from=" + sel.from[0].value.trim() + "&to=" + sel.to[0].value.trim() + "&hub=" + sel.hub[0].value.trim() + "&day=" + d + "&number=" + "&fromCn=" + sel.fromCn[0].value.trim() + "&toCn=" + sel.toCn[0].value.trim() + "&hubCn=" + sel.hubCn[0].value.trim(); var test = url; } } if (typeof window.$location == "undefined") window.$location = function (url) { if (/MSIE (\d+\.\d+);/.test(navigator.userAgent)) { var referLink = document.createElement("a"); referLink.href = url; document.body.appendChild(referLink); referLink.click() } else location.href = url }; searchLoading(sel.gosearchCountry); $location(url); } } catch (e) { } e.preventDefault(); }); }); var vid = ""; if ($.cookie.get('_bfa') != null) { var values = $.cookie.get('_bfa').match(/\w+(?=\.)/g); if (!!values && values.length > 2) vid = values[1] + '.' + values[2]; } $('html').bind('mousedown', function () { trainConf.noFocusNext = true; setTimeout(function () { trainConf.noFocusNext = false; }, 10); }); cQuery.jsonp(baseUrl + "TrainBooking/Ajax/UI2IndexHandler.ashx?type=jsonpGetUserBehavier&vid=" + vid, { onload: function (result) { if (result.responseText != "") { var lists = result.responseText; lists.each(function (s) { s.split('&').each(function (behaviorEntry) { var cityName = behaviorEntry.toString().split('=')[1]; if (!!cityName) cityName = cityName.match(/[\u4e00-\u9fa5]*/)[0]; if (behaviorEntry.search("from=") > -1) { if (cityName.trim() != "") { if (tagFromCitys.indexOf(cityName) == -1) tagFromCitys += "" + cityName + ""; } } else if (behaviorEntry.search("to") > -1) { if (cityName.trim() != "") { if (tagToCitys.indexOf(cityName) == -1) tagToCitys += "" + cityName + ""; } } }); }); if (!!lists && !!lists.length && lists.length > 0) { var searchs = lists[0].split('&'); searchs.each(function (behaviorEntry) { if (behaviorEntry.search("from=") > -1) { if (behaviorEntry.toString().split('=')[1].trim() != "") { $("#notice01").value(behaviorEntry.toString().split('=')[1].match(/[\u4e00-\u9fa5]*/)); $("#notice01").css("color", "black"); $("#notice01").removeClass("inputSel"); $("#notice01")[0].oldValue = $("#notice01").value(); } } else if (behaviorEntry.search("to=") > -1) { if (behaviorEntry.toString().split('=')[1].trim() != "") { $("#notice02").value(behaviorEntry.toString().split('=')[1].match(/[\u4e00-\u9fa5]*/)); $("#notice02").css("color", "black"); $("#notice02").removeClass("inputSel"); $("#notice02")[0].oldValue = $("#notice02").value(); } } }); } } CtripHomePage.Train.ControlElement.noticeFromAddress = regAddress(sel.fromCn, 'notice01', '#from', jsonFilterUrl, tagFromCitys); CtripHomePage.Train.ControlElement.noticeToAddress = regAddress(sel.toCn, 'notice02', '#to', jsonFilterUrl, tagToCitys); CtripHomePage.Train.ControlElement.noticeHubAddress = regAddress(sel.hubCn, 'notice03', '#hub', jsonFilterUrl, tagToCitys); }, onerror: function () { CtripHomePage.Train.ControlElement.noticeFromAddress = regAddress(sel.fromCn, 'notice01', '#from', jsonFilterUrl, tagFromCitys); CtripHomePage.Train.ControlElement.noticeToAddress = regAddress(sel.toCn, 'notice02', '#to', jsonFilterUrl, tagToCitys); CtripHomePage.Train.ControlElement.noticeHubAddress = regAddress(sel.hubCn, 'notice03', '#hub', jsonFilterUrl, tagToCitys); } }); $("#notice01").bind('keydown', function (e) { var e = e || window.event; if (e.keyCode == 13) { sel.gosearchCountry.click(); } }); $("#notice01").bind('keypress', function (e) { var e = e || window.event; if (e.keyCode == 13) { sel.gosearchCountry.click(); } }); $("#notice02").bind('keydown', function (e) { var e = e || window.event; if (e.keyCode == 13) { sel.gosearchCountry.click(); } }); $("#notice02").bind('keypress', function (e) { var e = e || window.event; if (e.keyCode == 13) { sel.gosearchCountry.click(); } }); $("#notice03").bind('keydown', function (e) { var e = e || window.event; if (e.keyCode == 13) { sel.gosearchCountry.click(); } }); $("#notice03").bind('keypress', function (e) { var e = e || window.event; if (e.keyCode == 13) { sel.gosearchCountry.click(); } }); $("#DdateObj").bind('keydown', function (e) { var e = e || window.event; if (e.keyCode == 13) { sel.gosearchCountry.click(); } }); $("#DdateObj").bind('keypress', function (e) { var e = e || window.event; if (e.keyCode == 13) { sel.gosearchCountry.click(); } }); $("#AdateObj").bind('keydown', function (e) { var e = e || window.event; if (e.keyCode == 13) { sel.gosearchCountry.click(); } }); $("#AdateObj").bind('keypress', function (e) { var e = e || window.event; if (e.keyCode == 13) { sel.gosearchCountry.click(); } }); // $("#ArraveDate").css("display", "none"); //$("#singleTrip")[0].checked = true; window.trainSF = function () { if (!!CtripHomePage.Train.ControlElement.noticeFromAddress) setTimeout(function () { CtripHomePage.Train.ControlElement.noticeFromAddress.method('focus', { isHidden: true, isSelected: true }) }, 100); }; if ($("input[name='outieType']:checked").length > 0) $("input[name='outieType']:checked")[0].click(); trainSF(); // bus js getBusMaxPreSaleDate(); cQuery.mod.load('notice', PluginsVersion.notice, function () { tipComm(cQuery('#busFrom'), "中文/拼音/英文"); tipComm(cQuery('#busTo'), "中文/拼音/英文"); tipComm(cQuery('#busDate'), "yyyy-mm-dd"); }); cQuery('#busDate').regMod("calendar", PluginsVersion.calendar, { options: { showWeek: true, container: cQuery.container, maxDate: busMaxDays } }, true); busFromAddress = regBusAddress('#busFrom', 'busFrom', ''); busToAddress = regBusAddress('#busTo', 'busTo', ''); getBusFromCity(); cQuery("#busTo").bind("focus", function () { getBusToCity(encodeURIComponent(cQuery("#busFrom").value().trim())); }); cQuery.mod.load('validate', PluginsVersion.validate, function () { var validateShow = function (obj, message) { cQuery(document).regMod('validate', '1.1').method("show", { $obj: obj, data: message, removeErrorClass: true, hideEvent: "blur", isFocus: true }); }; cQuery("#searchBus").bind('click', function (e) { var notice01 = cQuery("#busFrom"), notice02 = cQuery("#busTo"), dateObj = cQuery("#busDate"); cQuery("#busForm").attr("action", "http:" + busBaseUrl + "/busList.html"); if (notice01.value().trim() == "中文/拼音/首字母" || notice01.value().trim() == "") { validateShow(notice01, "请输入出发城市名称"); return false; } else if (notice02.value().trim() == "中文/拼音/首字母" || notice02.value().trim() == "") { validateShow(notice02, "请输入到达城市名称"); return false; } else if (dateObj.value().trim().replace(/\//g, '-').trim() == "yyyy-mm-dd" || dateObj.value().trim() == "") { validateShow(dateObj, "请选择出发日期"); return false; } searchLoading($(this)); document.getElementById("busForm").submit(); return false; }); }); }); var trainConf = { noFocusNext: true }; var pops = new Array(); var pCount = new Array(); function bindEvent(element, event, handler) { $(element).bind(event, handler); } function hide(element) { element.style.display = "none"; } function isChildOf(parentEl, el, container) { if (parentEl == el) { return true; } if (parentEl.contains) { return parentEl.contains(el); } if (parentEl.compareDocumentPosition) { return !!(parentEl.compareDocumentPosition(el) & 16); } var prEl = el.parentNode; while (prEl && prEl != container) { if (prEl == parentEl) return true; prEl = prEl.parentNode; } return false; } function getEventTarget(event) { return ((window.event || event).srcElement || (window.event || event).target); } function handlePopup(event) { var others = new Array(); for (var i = 0; i < pops.length; i++) if (!(isChildOf(pops[i][0], getEventTarget(event)) || isChildOf(pops[i][1], getEventTarget(event)))) others.push(pops[i][0]); others.each(function (pop) { hide(pop); }); } function regAddressInternet(input, name, hiddenCode, hiddenName) { var solution = document.getElementById('solution'); if (solution && solution.value && (solution.value.toUpperCase().indexOf('PRO') == -1)) { railsBaseUrl = "//rails.uat.qa.nt.ctripcorp.com/" } var noticeAddress = $(input).regMod('address', '1.0', { name: name, jsonpFilter: railsBaseUrl + "international/Ajax/PTPCityHandler.ashx?value={\"key\":\"${key}\",\"type\":\"3\"}", relate: { 1: $(hiddenName), 2: $(hiddenCode) }, source: { suggestion: { "欧洲热门": [{ display: "巴黎", data: "Paris|巴黎|FRPAR" }, { display: "佛罗伦萨", data: "Florence|佛罗伦萨|ITFLR" }, { display: "威尼斯", data: "Venezia|威尼斯|ITVCE" }, { display: "罗马", data: "Rome|罗马|ITRMA" }, { display: "伦敦", data: "LONDON|伦敦|GBLON" }, { display: "米兰", data: "Milano|米兰|ITMIL" }, { display: "尼斯", data: "NICE|尼斯|FRNCE" }, { display: "马德里", data: "Madrid|马德里|ESMAD" }, { display: "巴塞罗那", data: "Barcelona|巴塞罗那|ESBCN" }, { display: "日内瓦", data: "GENEVA|日内瓦|CHGVA" }, { display: "亚维侬TGV", data: "AVIGNONTGV|亚维侬TGV|FRAVG" }, { display: "布鲁塞尔", data: "Brussel|布鲁塞尔|BEBRU" }, { display: "苏黎世", data: "Zurich|苏黎世|CHZRH" }, { display: "阿姆斯特丹", data: "Amsterdam|阿姆斯特丹|NLAMS" }, { display: "法兰克福", data: "Frankfurt|法兰克福|DEFRA" }, { display: "慕尼黑", data: "Mucich|慕尼黑|DEMUC" }, { display: "维也纳", data: "Vienna|维也纳|ATVIE" }, { display: "里昂", data: "LYON|里昂|FRLYS" }, { display: "科隆", data: "COLOGNE|科隆|DECGN" }, { display: "马赛", data: "MARSEILLE|马赛|FRMRS" }, { display: "因特拉肯", data: "INTERLAKEN|因特拉肯|CHZTJ" }, { display: "琉森", data: "LUCERNE|琉森|CHQLJ" }, { display: "塞维利亚", data: "SEVILLA|塞维利亚|ESSVQ" }, { display: "安奈斯", data: "ANNECY|安奈斯|FRNCY"}], "英国": [{ display: "伦敦", data: "LONDON|伦敦|GBLON" }, { display: "爱丁堡", data: "EDINBURGH|爱丁堡|GBEDB" }, { display: "剑桥", data: "CAMBRIDGE|剑桥|GBCBG" }, { display: "曼彻斯特", data: "MANCHESTER|曼彻斯特|GBMHT" }, { display: "约克", data: "YORK|约克|GBYRK" },{ display: "牛津", data: "OXFORD|牛津|GBOXF" },{ display: "利物浦", data: "LIVERPOOL|利物浦|GBAAB" },{ display: "温德米尔", data: "WINDERMERE|温德米尔|GBALJ" }, { display: "比斯特", data: "BICESTER|比斯特|GBMDF" }, { display: "温莎", data: "WINDSOR|温莎|GBMFL" }, { display: "伯明翰", data: "BIRMINGHAM|伯明翰|GBBIR" }, { display: "巴斯", data: "BATH|巴斯|GBBTH" }, { display: "布莱尔", data: "BLAIR|布莱尔|GBAEU" }, { display: "奥尔顿", data: "ALTON|奥尔顿|GBAXX" }, { display: "奥萨格", data: "ALSAGER|奥萨格|G1760" }, { display: "波士顿", data: "BOSTON|波士顿|GBBTN" }], "法国": [{ display: "巴黎", data: "Paris|巴黎|FRPAR" }, { display: "尼斯", data: "NICE|尼斯|FRNCE" }, { display: "里昂", data: "LYON|里昂|FRLYS" }, { display: "亚维侬TGV", data: "AVIGNONTGV|亚维侬TGV|FRAVG" }, { display: "亚维侬", data: "AVIGNON|亚维侬|FRAVN" }, { display: "马赛", data: "MARSEILLE|马赛|FRMRS" }, { display: "波尔多", data: "BORDEAUX|波尔多|FRBOD" }, { display: "安奈斯", data: "ANNECY|安奈斯|FRNCY" }, { display: "斯特拉斯堡", data: "STRASBOURG|斯特拉斯堡|FRSXB" }, { display: "南特", data: "NANTES|南特|FRNTE" }, { display: "戛纳", data: "CANNES|戛纳|FRJCA" }, { display: "雷恩", data: "RENNES|雷恩|FRRNS" }, { display: "普罗旺斯", data: "AIXENPROVENCE|普罗旺斯|FRAIE" }, { display: "图卢兹", data: "TOULOUSE|图卢兹|FRTLS" }, { display: "布尔日", data: "BOURGES|布尔日|FRBOU" }, { display: "博埃", data: "BOE|博埃|FRBOE" }], "德国": [{ display: "柏林", data: "BERLIN|柏林|DEBHX" }, { display: "法兰克福", data: "Frankfurt|法兰克福|DEFRA" }, { display: "慕尼黑", data: "MUNICH|慕尼黑|DEMUC" }, { display: "科隆", data: "COLOGNE|科隆|DECGN" }, { display: "汉堡", data: "HAMBURG|汉堡|DEHAM" }, { display: "曼海姆", data: "MANNHEIM|曼海姆|DEBEF" }, { display: "斯图加特", data: "STUTTGART|斯图加特|DESTT" }, { display: "里尔", data: "LEER|里尔|DEANW" }, { display: "杜塞尔多夫", data: "DUSSELDORF|杜塞尔多夫|DEDUS" }, { display: "埃森", data: "ESSEN|埃森|DEESS" }, { display: "美因茨", data: "MAINZ|美因茨|DEQMZ" }, { display: "不来梅", data: "BREMEN|不来梅|DEBRE" }, { display: "迪森", data: "DIESSEN|迪森|DEAGI" }, { display: "汉诺威", data: "HANNOVER|汉诺威|DEHAJ" }, { display: "基恩", data: "KIRN|基恩|DEAMH" }, { display: "兰茨贝格", data: "LANDSBERG|兰茨贝格|DELNS" }], "意大利": [{ display: "罗马", data: "Rome|罗马|ITRMA" }, { display: "佛罗伦萨", data: "Florence|佛罗伦萨|ITFLR" }, { display: "威尼斯", data: "Venezia|威尼斯|ITVCE" }, { display: "米兰", data: "Milano|米兰|ITMIL" }, { display: "那不勒斯", data: "NAPLES|那不勒斯|ITNAP" }, { display: "比萨", data: "PISA|比萨|ITPSA" }, { display: "拉斯佩齐亚", data: "LASPEZIA|拉斯佩齐亚|ITAKA" }, { display: "博洛尼亚", data: "BOLOGNA|博洛尼亚|ITBLQ" }, { display: "科摩", data: "COMO|科摩|ITQCM" }, { display: "多纳", data: "DONNAZ|多纳|ITAKI" }, { display: "热那亚", data: "GENOA|热那亚|ITGOA" }, { display: "马萨", data: "MASSA|马萨|ITAKN" }, { display: "帕多瓦", data: "PADUA|帕多瓦|ITQPA" }, { display: "萨勒诺", data: "SALERNO|萨勒诺|ITARY" }, { display: "锡耶纳", data: "SIENA|锡耶纳|ITALI" }, { display: "都灵", data: "TURIN|都灵|ITTRN" }], "西班牙": [{ display: "马德里", data: "Madrid|马德里|ESMAD" }, { display: "巴塞罗那", data: "Barcelona|巴塞罗那|ESBCN"}, { display: "塞维利亚", data: "SEVILLA|塞维利亚|ESSVQ" }, { display: "瓦伦西亚", data: "VALENCIA|瓦伦西亚|ESVSS" }, { display: "格拉纳达", data: "GRANADA|格拉纳达|ESGRX" }, { display: "科尔多瓦", data: "CORDOBA|科尔多瓦|ESODB" }, { display: "托莱多", data: "TOLEDO|托莱多|ESACT" }, { display: "伦达", data: "RONDA|伦达|ESAEB" }, { display: "马拉加", data: "MALAGA|马拉加|ESAGP" }, { display: "坎普", data: "CAMP|坎普|ESTAA" }], "台湾": [{ display: "台北", data: "taibei|台北|TWTB" }, { display: "台中", data: "taizhong|台中|TWTZ" }, { display: "高雄", data: "gaoxiong|高雄|TWGX" }, { display: "台南", data: "tainan|台南|TWTN" }, { display: "嘉义", data: "jiayi|嘉义|TWJY" }, { display: "桃园", data: "taoyuan|桃园|TWTY" }, { display: "新北", data: "xinbei|新北|TWXB" }, { display: "新竹", data: "xinzu|新竹|TWXZ" }, { display: "彰化", data: "zhanghua|彰化|TWZH" }, { display: "云林", data: "yunlin|云林|TWYL" }, { display: "苗栗", data: "miaoli|苗栗|TWML" }, { display: "花莲", data: "HUALIAN|花莲|TWHUALIAN" }, { display: "枋寮", data: "FANGLIAO|枋寮|TWFANGLIAO" }, { display: "瑞芳", data: "RUIFANG|瑞芳|TWRUIFANG" }, { display: "宜兰", data: "YILAN|宜兰|TWYILAN" }, { display: "屏东", data: "PINGDONG|屏东|TWPINGDONG"}], }, alias: ['pinyin', 'cityName', 'cityId'] }, message: { suggestion: '支持中文/英文 （欧洲28个国家及台湾地区）' }, template: { suggestion: '\
    \
${message.suggestion}
\
\
\ {{enum(key) data}}\
${key}\ {{/enum}}\
\ {{enum(key,arr) data}}\
\ {{each arr}}\
${display}\ {{/each}}\
\ {{/enum}}\
\
\ ', filter: '\
\
\
{{if hasResult}}{{tmpl message.filterResult}}{{else}}{{tmpl message.noFilterResult}}{{/if}}
\
\ {{each (i,item) list}}\ {{if cQuery.type(item)=="string"}}\ ${item}\ {{else}}\
${left}${right}
\ {{/if}}\ {{/each}}\
\ {{if page.max>-1}}\
\ {{if page.current>0}}\ <-\ {{/if}}\ {{if page.current<2}}\ {{loop(index) Math.min(5,page.max+1)}}\ ${index+1}\ {{/loop}}\ {{else page.current>page.max-2}}\ {{loop(index) Math.max(0,page.max-4),page.max+1}}\ ${index+1}\ {{/loop}}\ {{else}}\ {{loop(index) Math.max(0,page.current-2),Math.min(page.current+3,page.max+1)}}\ ${index+1}\ {{/loop}}\ {{/if}}\ {{if page.current->\ {{/if}}\
\ {{/if}}\
\
\ ', filterStyle:'\ .c_address_hd { height: 24px; border-color: #2C7ECF; border-style: solid; border-width: 1px 1px 0; background-color: #67A1E2; color: #fff; line-height: 24px; padding-left: 10px; }\ .c_address_bd { border-color: #999999; border-style: solid; border-width: 0 1px 1px; overflow: hidden; padding:10px; }\ .c_address_select { width:500px; height:355px; font-family: Arial, Simsun; font-size: 12px; }\ .c_address_wrap { width: 220px; height:349px; min-height: 305px; margin: 0; padding: 0 0 4px; border: 1px solid #969696; background:#fff; text-align: left; }\ .c_address_hd { margin:-1px; }\ .c_address_list { margin: 0; padding: 0; height:300px; }\ .c_address_list label { border-bottom: 1px solid #FFFFFF; border-top: 1px solid #FFFFFF; display: block; height: 22px; line-height: 22px; min-height: 22px; overflow: hidden; padding: 1px 9px 0; text-align: center; }\ .c_address_list span { float: right; font: 10px/22px verdana; margin: 0; overflow: hidden; text-overflow :ellipsis; padding: 0; text-align: right; white-space: nowrap; width: 110px; }\ .c_address_list a { border-bottom: 1px solid #FFFFFF; border-top: 1px solid #FFFFFF; color: #0055AA; cursor: pointer; display: block; height: 22px; line-height: 22px; min-height: 22px; overflow: hidden; text-overflow :ellipsis; white-space :nowrap; padding: 1px 9px 0; text-align: left; text-decoration: none; }\ .c_address_list a.hover { background: none repeat scroll 0 0 #E8F4FF; border-bottom: 1px solid #7F9DB9; border-top: 1px solid #7F9DB9; }\ .address_selected { background: none repeat scroll 0 0 #FFE6A6; color: #FFFFFF; height: 22px; }\ .c_address_pagebreak { line-height: 25px; margin: 0; padding: 0; text-align: center; }\ .c_address_pagebreak a { color: #0055AA; display: inline-block; font-family: Arial, Simsun, sans-serif; font-size: 14px; margin: 0; padding: 0 4px; text-align: center; text-decoration: underline; width: 15px; }\ a.address_current { color: #000; text-decoration: none; }\ ', suggestionStyle: '\ .c_address_box { width:380px;padding:10px;border:1px solid #999;background-color:#fff; }\ .c_address_box a { text-decoration: none; }\ .c_address_hd { margin-bottom:10px;color:#999;}\ .c_address_hd strong{color:#fff;}\ .c_address_bd { overflow: hidden; padding:10px; }\ .c_address_ol { margin:0; padding:0 0 20px; border-bottom: 1px solid #5DA9E2; }\ .c_address_ol li { color: #005DAA; cursor: pointer; overflow: hidden; text-overflow:ellipsis;white-space:nowrap; float: left; height: 20px; line-height: 20px; list-style-type: none; text-align: center; }\ .c_address_ol li span { padding:0 8px; white-space:nowrap; display:block; }\ .c_address_ol li .hot_selected { display:block; padding:0 7px; background-color: #FFFFFF; border-color: #5DA9E2; border-style: solid; border-width: 1px 1px 0; color: #000000; font-weight: bold; }\ .c_address_ul { width: 100%; margin:0; padding: 4px 0 0; }\ .c_address_ul li { float: left; height: 24px; overflow: bv; overflow: hidden;text-overflow:ellipsis;white-space:nowrap; width: 80px; }\ .c_address_ul li a { display: block; height: 22px; overflow: bv; text-overflow:ellipsis;white-space:nowrap; border: 1px solid #FFFFFF; color: #1148A8; line-height: 22px; padding-left: 5px; }\ .c_address_ul li a:hover { background-color:#2577E3;text-decoration:none;color:#fff; }\ ' } }); $(input).bind("keydown", function () { $(hiddenCode).value(""); $(hiddenName).value(""); }); $(input).bind("blur", function () { if ($(hiddenCode).value() == "") $(input).value(""); }); return noticeAddress; } function regAddressInternetCountry(input, name, hidden) { var solution = document.getElementById('solution'); if (solution && solution.value && (solution.value.toUpperCase().indexOf('PRO') == -1)) { railsBaseUrl = "//rails.uat.qa.nt.ctripcorp.com/" } var noticeAddress = $(input).regMod('address', '1.0', { name: name, jsonpFilter: railsBaseUrl + "international/Ajax/PassCountrySelector.ashx?Action=GetPassCountrySelector&value={\"key\":\"${key}\",\"type\":\"5\"}", jsonpSource: railsBaseUrl + "international/Ajax/PassCountrySelector.ashx?Action=HotCountry", message: { suggestion: '请从下列国家选择' }, relate: { 4: hidden }, isFocusNext: true, template: { suggestion: '\
\
${message.suggestion}
\
\
\ {{enum(key) data}}\
${key}\ {{/enum}}\
\ {{enum(key,arr) data}}\
\ {{each arr}}\
${display}\ {{/each}}\
\ {{/enum}}\
\
\ ', filterStyle: '\ .c_address_hd { height: 24px; border-color: #2C7ECF; border-style: solid; border-width: 1px 1px 0; background-color: #67A1E2; color: #fff; line-height: 24px; padding-left: 10px; }\ .c_address_bd { border-color: #999999; border-style: solid; border-width: 0 1px 1px; overflow: hidden; padding:10px; }\ .c_address_select { width:500px; height:355px; font-family: Arial, Simsun; font-size: 12px; }\ .c_address_wrap { width: 220px; height:349px; min-height: 305px; margin: 0; padding: 0 0 4px; border: 1px solid #969696; background:#fff; text-align: left; }\ .c_address_hd { margin:-1px; }\ .c_address_list { margin: 0; padding: 0; height:300px; }\ .c_address_list label { border-bottom: 1px solid #FFFFFF; border-top: 1px solid #FFFFFF; display: block; height: 22px; line-height: 22px; min-height: 22px; overflow: hidden; padding: 1px 9px 0; text-align: center; }\ .c_address_list span { float: right; font: 10px/22px verdana; margin: 0; overflow: hidden; text-overflow :ellipsis; padding: 0; text-align: right; white-space: nowrap; width: 110px; }\ .c_address_list a { border-bottom: 1px solid #FFFFFF; border-top: 1px solid #FFFFFF; color: #0055AA; cursor: pointer; display: block; height: 22px; line-height: 22px; min-height: 22px; overflow: hidden; text-overflow :ellipsis; white-space :nowrap; padding: 1px 9px 0; text-align: left; text-decoration: none; }\ .c_address_list a.hover { background: none repeat scroll 0 0 #E8F4FF; border-bottom: 1px solid #7F9DB9; border-top: 1px solid #7F9DB9; }\ .address_selected { background: none repeat scroll 0 0 #FFE6A6; color: #FFFFFF; height: 22px; }\ .c_address_pagebreak { line-height: 25px; margin: 0; padding: 0; text-align: center; }\ .c_address_pagebreak a { color: #0055AA; display: inline-block; font-family: Arial, Simsun, sans-serif; font-size: 14px; margin: 0; padding: 0 4px; text-align: center; text-decoration: underline; width: 15px; }\ a.address_current { color: #000; text-decoration: none; }\ ', suggestionStyle: '\ .c_address_box { width:380px;padding:10px;border:1px solid #999;background-color:#fff; }\ .c_address_box a { text-decoration: none; }\ .c_address_hd { margin-bottom:10px;color:#999;}\ .c_address_hd strong{color:#fff;}\ .c_address_bd { overflow: hidden; padding:10px; }\ .c_address_ol { margin:0; padding:0 0 20px; border-bottom: 1px solid #5DA9E2; }\ .c_address_ol li { color: #005DAA; cursor: pointer; float: left; height: 20px; line-height: 20px; list-style-type: none; text-align: center; }\ .c_address_ol li span { padding:0 8px; white-space:nowrap; display:block; }\ .c_address_ol li .hot_selected { display:block; padding:0 7px; background-color: #FFFFFF; border-color: #5DA9E2; border-style: solid; border-width: 1px 1px 0; color: #000000; font-weight: bold; }\ .c_address_ul { width: 100%; margin:0; padding: 4px 0 0; }\ .c_address_ul li { float: left; height: 24px; overflow: hidden; width: 85px; }\ .c_address_ul li a { display: block; height: 22px; border: 1px solid #FFFFFF; color: #1148A8; line-height: 22px; padding-left: 5px; }\ .c_address_ul li a:hover { background-color:#2577E3;text-decoration:none;color:#fff; }\ ' } }); $(input).bind("keydown", function () { $(hidden).value(""); }); $(input).bind("blur", function () { if ($(hidden).value() == "") $(input).value(""); }); noticeAddress.method('bind', 'change', function (e, data) { if (data && data.items && data.items.length > 4) { $(input).value(data.items[1]); $(hidden).value = (data.items[4]); } else { $(hidden).value = ""; } }); return noticeAddress; } var CtripHomePage = window.CtripHomePage || {}, jsonFilterUrl, tagFromCitys = "", tagToCitys = ""; CtripHomePage.Train = (function () { return { ControlElement: { noticeFromAddress: null, noticeToAddress: null, noticeHubAddress: null } }; })() function format(data) { var obj = {}; for (var key in data) { obj[key] = {}; if (key.search(/[A-Z]/i) != -1) { for (var i = 0; i < data[key].length; i++) { var groupBy = data[key][i]['data'].split('|')[2].substr(0, 1).toUpperCase(); if (obj[key][groupBy]) { obj[key][groupBy].push(data[key][i]); } else { obj[key][groupBy] = []; obj[key][groupBy].push(data[key][i]); } } } else { for (var i = 0; i < data[key].length; i++) { if (obj[key]['']) { obj[key][''].push(data[key][i]); } else { obj[key][''] = []; obj[key][''].push(data[key][i]); } } } } return obj; } function regAddress(input, name, hidden, jsonFilterUrl, tagHistory) { var noticeAddress = $(input).regMod('address', '1.0', { name: name, jsonpSource: jsonFilterUrl, sort: ['^0$', '^1$', '^3+$', '^0', '^1', '^3+'], message: { suggestion: '请从下列城市选择' }, relate: { 'name_py1': hidden }, isFocusNext: false, isAutoCorrect: true, template: { suggestion: '{{if (data = format(data))}}{{/if}}' + '
' + '
×支持中文/拼音/简拼输入

' + (!!tagHistory ? ( '
搜索历史

' + '
' + tagHistory + '
') : '') + '
{{enum(key) data}}
${key}{{/enum}}
' + '{{enum(key,objs) data}}' + '
' + '{{enum(k,arr) objs}}' + '
' + '${k}' + '{{each(index, item) arr}}${item.display}{{/each}}' + '
' + '{{/enum}}' + '
' + '{{/enum}}' + '
', suggestionIpad: '{{if (data = format(data))}}{{/if}}' + '
' + '
×支持中文/拼音/简拼输入

' + (!!tagHistory ? ( '
搜索历史

' + '
' + tagHistory + '
') : '') + '
{{enum(key) data}}
${key}{{/enum}}
' + '{{enum(key,objs) data}}' + '
' + '{{enum(k,arr) objs}}' + '
' + '${k}' + '{{each(index, item) arr}}${item.display}{{/each}}' + '
' + '{{/enum}}' + '
' + '{{/enum}}' + '
', suggestionStyle: '.city_select_lhsl{width:408px;padding:10px;border:1px solid #999;background-color:#fff;}' + '.city_select_lhsl .close{float:right;width:20px;height:20px;color:#666;text-align:center;font:bold 16px/20px Simsun;}' + '.city_select_lhsl .close:hover{text-decoration:none;color:#FFA800;}' + '.city_select_lhsl .title{margin-bottom:10px;color:#999;}' + '.city_select_lhsl .tab_box{width:100%;height:22px;margin-bottom:6px;margin-top:0;border-bottom:2px solid #ccc;}' + '.city_select_lhsl .tab_box li{position:relative;float:left;display:inline;margin-right:2px;line-height:22px;cursor:pointer;}' + '.city_select_lhsl .tab_box li b{display:none;}' + '.city_select_lhsl .tab_box li span{padding:0 8px;}' + '.city_select_lhsl .tab_box .hot_selected{border-bottom:2px solid #06c;margin-bottom:-2px;font-weight:bold;color:#06c;}' + '.city_select_lhsl .tab_box .hot_selected b{position:absolute;top:23px;left:50%;display:block;width:0;height:0;margin-left:-5px;overflow:hidden;font-size:0;line-height:0;border-color:#06c transparent transparent transparent;border-style:solid dashed dashed dashed;border-width:5px;}' + '.city_select_lhsl .city_item, .city_select_lhsl .search_history_box {display:inline-block;*zoom:1;overflow:hidden;}' + '.city_select_lhsl .city_item{width:408px;}' + '.city_select_lhsl .city_item a, .city_select_lhsl .search_history_box a {float:left;display:inline;width:52px;height:22px;margin:0 2px 2px 0;padding-left:8px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;line-height:22px;color:#333;}' + '.city_select_lhsl .city_item a:hover,.city_select_lhsl .search_history_box a:hover{background-color:#2577E3;text-decoration:none;color:#fff;}' + '.city_item .city_item_in{width:378px;padding-left:30px;*zoom:1;}' + '.city_item .city_item_in:after,.city_select_lhsl .search_history_box:after{display:block;height:0;visibility:hidden;overflow:hidden;content:".";clear:both;}' + '.city_item .city_item_letter{float:left;width:30px;height:22px;margin-left:-30px;line-height:22px;text-align:center;color:#E56700;}' + '.city_select_lhsl .sarch_history_title{margin-bottom:2px;font-weight:bold;color:#06c;}' + '.city_select_lhsl .search_history_box{margin-bottom:6px;}', suggestionStyleIpad: '.city_select_lhsl{width:408px;padding:10px;border:1px solid #999;background-color:#fff;}' + '.city_select_lhsl .close{float:right;width:20px;height:20px;color:#666;text-align:center;font:bold 16px/20px Simsun;}' + '.city_select_lhsl .close:hover{text-decoration:none;color:#FFA800;}' + '.city_select_lhsl .title{margin-bottom:10px;color:#999;}' + '.city_select_lhsl .tab_box{width:100%;height:22px;margin-bottom:6px;margin-top:0;border-bottom:2px solid #ccc;}' + '.city_select_lhsl .tab_box li{position:relative;float:left;display:inline;margin-right:2px;line-height:22px;cursor:pointer;}' + '.city_select_lhsl .tab_box li b{display:none;}' + '.city_select_lhsl .tab_box li span{padding:0 8px;}' + '.city_select_lhsl .tab_box .hot_selected{border-bottom:2px solid #06c;margin-bottom:-2px;font-weight:bold;color:#06c;}' + '.city_select_lhsl .tab_box .hot_selected b{position:absolute;top:23px;left:50%;display:block;width:0;height:0;margin-left:-5px;overflow:hidden;font-size:0;line-height:0;border-color:#06c transparent transparent transparent;border-style:solid dashed dashed dashed;border-width:5px;}' + '.city_select_lhsl .city_item, .city_select_lhsl .search_history_box {display:inline-block;*zoom:1;overflow:hidden;}' + '.city_select_lhsl .city_item{width:408px;}' + '.city_select_lhsl .city_item a, .city_select_lhsl .search_history_box a {float:left;display:inline;width:52px;height:22px;margin:0 2px 2px 0;padding-left:8px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;line-height:22px;color:#333;}' + '.city_select_lhsl .city_item a:hover,.city_select_lhsl .search_history_box a:hover{background-color:#2577E3;text-decoration:none;color:#fff;}' + '.city_item .city_item_in{width:378px;padding-left:30px;*zoom:1;}' + '.city_item .city_item_in:after,.city_select_lhsl .search_history_box:after{display:block;height:0;visibility:hidden;overflow:hidden;content:".";clear:both;}' + '.city_item .city_item_letter{float:left;width:30px;height:22px;margin-left:-30px;line-height:22px;text-align:center;color:#E56700;}' + '.city_select_lhsl .sarch_history_title{margin-bottom:2px;font-weight:bold;color:#06c;}' + '.city_select_lhsl .search_history_box{margin-bottom:6px;}', suggestionInit: function (el) { suggestInit(el); }, suggestionInitIpad: function (el) { suggestInit(el); } } }); function suggestInit(a) { $(".tab_box li", a[0]).bind("mousedown", function () { $(".tab_box li", a[0]).removeClass("hot_selected"); $(this).addClass("hot_selected"); $(".city_item", a[0]).css("display", "none"); var keywords = $("span", $(this)[0])[0].innerHTML; if (keywords.trim() == '热门') { $(".city_item:eq(0)", a[0]).css("display", ""); } else { $(".city_item").each(function (c) { var letter = $(".city_item_letter", c[0])[0].innerHTML; if (letter != '' && keywords.indexOf(letter) > -1) { $(c).css("display", ""); } }); } }); $(".search_history_box a", a[0]).bind("mousedown", function () { $(input).value(this.innerHTML); noticeAddress.method("hidden"); }); $(".title .close", a[0]).bind("mousedown", function () { noticeAddress.method("hidden"); }); $(".tab_box li:eq(0)", a[0]).trigger("mousedown"); }; noticeAddress.method('bind', 'change', function (e, data) { if (!data.items || !data.items.name) { return; } if (trainConf.noFocusNext) { return; } if (name == "notice01") { $("#notice02")[0].focus(); } else if (name == "notice02") { $("#DdateObj")[0].focus(); } }); return noticeAddress; } var ChangeDate = function (id) { if (id == "1") { var chufaDate = $("#DdateObj")[0].value.trim(); var fanhuiDate = $("#AdateObj")[0].value.trim(); var nextD = new Date().addDays(0).toFormatString("yyyy-MM-dd"); if (chufaDate != "yyyy-mm-dd" && chufaDate != "") { nextD = new Date(chufaDate.replace(/\-/g, '/')).toFormatString('yyyy-MM-dd') } $("#AdateObj").data('minDate', nextD); if (document.getElementById("roundTrip").checked) { if (chufaDate != "yyyy-mm-dd" && chufaDate != "") { if (fanhuiDate != "yyyy-mm-dd" && chufaDate != "") { if (fanhuiDate != "yyyy-mm-dd" && new Date(chufaDate.replace(/\-/g, '/')).getTime() > new Date(fanhuiDate.replace(/\-/g, '/')).getTime()) { if (new Date(chufaDate.replace(/\-/g, '/')).addDays(2).getTime() > new Date().addDays(maxDay).getTime()) { $("#AdateObj")[0].value = new Date().addDays(maxDay).toFormatString('yyyy-MM-dd'); } else { $("#AdateObj")[0].value = new Date(chufaDate.replace(/\-/g, '/')).addDays(2).toFormatString('yyyy-MM-dd'); } } else if (fanhuiDate == "yyyy-mm-dd") { if (new Date(chufaDate.replace(/\-/g, '/')).addDays(2).getTime() > new Date().addDays(maxDay).getTime()) { $("#AdateObj")[0].value = new Date().addDays(maxDay).toFormatString('yyyy-MM-dd'); } else { $("#AdateObj")[0].value = new Date(chufaDate.replace(/\-/g, '/')).addDays(2).toFormatString('yyyy-MM-dd'); } } } } } } else if (id == "3") { var chufaDate = $("#txtDateFrom")[0].value.trim(); var fanhuiDate = $("#txtDateTo")[0].value.trim(); var nextD = new Date().addDays(0).toFormatString("yyyy-MM-dd"); if (chufaDate != "yyyy-mm-dd" && chufaDate != "") { nextD = new Date(chufaDate.replace(/\-/g, '/')).toFormatString('yyyy-MM-dd') } $("#txtDateTo").data('minDate', nextD); if (document.getElementById("roundTrip").checked) { if (chufaDate != "yyyy-mm-dd" && chufaDate != "") { if (fanhuiDate != "yyyy-mm-dd" && chufaDate != "") { if (fanhuiDate != "yyyy-mm-dd" && new Date(chufaDate.replace(/\-/g, '/')).getTime() > new Date(fanhuiDate.replace(/\-/g, '/')).getTime()) { if (new Date(chufaDate.replace(/\-/g, '/')).addDays(2).getTime() > new Date().addDays(19).getTime()) { $("#txtDateTo")[0].value = new Date().addDays(19).toFormatString('yyyy-MM-dd'); } else { $("#txtDateTo")[0].value = new Date(chufaDate.replace(/\-/g, '/')).addDays(2).toFormatString('yyyy-MM-dd'); } } else if (fanhuiDate == "yyyy-mm-dd") { if (new Date(chufaDate.replace(/\-/g, '/')).addDays(2).getTime() > new Date().addDays(19).getTime()) { $("#txtDateTo")[0].value = new Date().addDays(19).toFormatString('yyyy-MM-dd'); } else { $("#txtDateTo")[0].value = new Date(chufaDate.replace(/\-/g, '/')).addDays(2).toFormatString('yyyy-MM-dd'); } } } } } } else if (id == "4") { if ($("#txtDateTo")[0].value.trim() != "yyyy-mm-dd") { } } else { if ($("#AdateObj")[0].value.trim() != "yyyy-mm-dd") { document.getElementById("roundTrip").checked = true; SelectTrip(); } } } var searchReturn = function () { var temp = document.getElementById("notice01").value.trim(); document.getElementById("notice01").value = document.getElementById("notice02").value.trim(); document.getElementById("notice02").value = temp; var color = $("#notice01").css("color"); $("#notice01").css("color", $("#notice02").css("color")); $("#notice02").css("color", color); var temp2 = document.getElementById("from").value.trim(); document.getElementById("from").value = document.getElementById("to").value.trim(); document.getElementById("to").value = temp2; } var searchReturnOutie = function () { var temp = document.getElementById("txtCityFrom").value.trim(); document.getElementById("txtCityFrom").value = document.getElementById("txtCityTo").value.trim(); document.getElementById("txtCityTo").value = temp; var temp2 = document.getElementById("hiddenStartCityCode").value.trim(); document.getElementById("hiddenStartCityCode").value = document.getElementById("hiddenDestCityCode").value.trim(); document.getElementById("hiddenDestCityCode").value = temp2; var temp3 = document.getElementById("hiddenStartCityName").value.trim(); document.getElementById("hiddenStartCityName").value = document.getElementById("hiddenDestCityName").value.trim(); document.getElementById("hiddenDestCityName").value = temp3; if (document.getElementById("hiddenStartCity").value.trim() != '') $("#txtCityFrom").removeClass("inputSel"); else $("#txtCityFrom").addClass("inputSel"); if (document.getElementById("hiddenDestCity").value.trim() != '') $("#txtCityTo").removeClass("inputSel"); else $("#txtCityTo").addClass("inputSel"); } var tipComm = function (nameStr, tipInfo) { nameStr.regMod("notice", PluginsVersion.notice, { name: nameStr, selClass: "inputSel", tips: tipInfo }, true); } var calendarCommContry = function (dateStr, startDate, endDate) { dateStr.regMod('calendar', PluginsVersion.calendar, { options: { minDate: startDate, maxDate: endDate, autoShow: true, showWeek: false }, listeners: { onChange: function (input, value) { if (input.id == "DdateObj") { var traintype = $("input[name='traintype']:checked")[0].value; if (traintype == "Double") { $("#AdateObj")[0].focus(); } else if (traintype == "Hub") { $("#notice03")[0].focus(); } } } } }); } var cityCommCountry = function (cityName, param) { var addressMod; if (param == "#hub") { addressMod = cityName.regMod('address', '1.0', { name: 'barSearch_CityName', jsonpSource: jsonFilterUrl, source: { suggestion: { "正在查询中转站，请稍等...": [] } }, sort: ['^0$', '^1$', '^3+$', '^0', '^1', '^3+'], relate: { 'name_py1': param }, isFocusNext: true, isAutoCorrect: true }); } else { addressMod = cityName.regMod('address', '1.0', { name: 'barSearch_CityName', jsonpSource: jsonFilterUrl, sort: ['^0$', '^1$', '^3+$', '^0', '^1', '^3+'], relate: { 'name_py1': param }, isFocusNext: true, isAutoCorrect: true }); } return addressMod; } function changeColor(nameStr) { $(nameStr).css("color", "black"); } function changeColorLeave(nameStr) { if ($(nameStr)[0].value.toString().trim() == "") { $(nameStr).css("color", "gray"); } } function SelectTrip() { if (document.getElementById("singleTrip").checked) { $("#ArraveDate").addClass("s_disable"); $("#ArraveDate").css("color", "gray"); $("#AdateObj").css("color", "gray"); $("#ArraveDate").css("display", ""); $("#HubStation").css("display", "none"); } else if (document.getElementById("roundTrip").checked) { $("#AdateObj").removeClass("inputSel"); $("#ArraveDate").removeClass("s_disable"); $("#ArraveDate").css("color", "#333"); if ($("#AdateObj")[0].value.toString().trim() == "yyyy-mm-dd") { if ($("#DdateObj")[0].value.trim() != "yyyy-mm-dd") { if (new Date($("#DdateObj")[0].value.trim().replace(/\-/g, '/')).addDays(2).getTime() > new Date().addDays(maxDay).getTime()) { $("#AdateObj")[0].value = new Date().addDays(maxDay).toFormatString('yyyy-MM-dd'); } else { $("#AdateObj")[0].value = new Date($("#DdateObj")[0].value.trim().replace(/\-/g, '/')).addDays(2).toFormatString('yyyy-MM-dd'); } $("#AdateObj").css("color", "#333"); } } else { $("#AdateObj").css("color", "#333"); } $("#ArraveDate").css("display", ""); $("#HubStation").css("display", "none"); } else if (document.getElementById("hubTrip").checked) { $("#ArraveDate").css("display", "none"); $("#HubStation").css("display", ""); } } // bus js function formatBusData(data) { var obj = {}; for (var key in data) { obj[key] = {}; if (key.search(/[A-Z]/i) != -1) { for (var i = 0; i < data[key].length; i++) { var groupBy = data[key][i]['data'].split('|')[2].substr(0, 1).toUpperCase(); if (obj[key][groupBy]) { obj[key][groupBy].push(data[key][i]); } else { obj[key][groupBy] = []; obj[key][groupBy].push(data[key][i]); } } } else { for (var i = 0; i < data[key].length; i++) { if (obj[key]['']) { obj[key][''].push(data[key][i]); } else { obj[key][''] = []; obj[key][''].push(data[key][i]); } } } } return obj; } function regBusAddress(input, name, tagHistory) { var noticeAddress = $(input).regMod('address', '1.0', { name: name, message: { suggestion: '请从下列城市选择', noFilterResult: "抱歉，找不到：'${val}' 请手动输入" }, isFocusNext: false, template: { suggestion: '{{if (data = formatBusData(data))}}{{/if}}' + '
' + '
×支持中文/拼音/简拼输入

' + (!!tagHistory ? ( '
搜索历史

' + '
' + tagHistory + '
') : '') + '
{{enum(key) data}}
${key}{{/enum}}
' + '{{enum(key,objs) data}}' + '
' + '{{enum(k,arr) objs}}' + '
' + '${k}' + '{{each(index, item) arr}}${item.display}{{/each}}' + '
' + '{{/enum}}' + '
' + '{{/enum}}' + '
', suggestionIpad: '{{if (data = formatBusData(data))}}{{/if}}' + '
' + '
×支持中文/拼音/简拼输入

' + (!!tagHistory ? ( '
搜索历史

' + '
' + tagHistory + '
') : '') + '
{{enum(key) data}}
${key}{{/enum}}
' + '{{enum(key,objs) data}}' + '
' + '{{enum(k,arr) objs}}' + '
' + '${k}' + '{{each(index, item) arr}}${item.display}{{/each}}' + '
' + '{{/enum}}' + '
' + '{{/enum}}' + '
', suggestionStyle: '.city_select_lhsl{width:408px;padding:10px;border:1px solid #999;background-color:#fff;}' + '.city_select_lhsl .close{float:right;width:20px;height:20px;color:#666;text-align:center;font:bold 16px/20px Simsun;}' + '.city_select_lhsl .close:hover{text-decoration:none;color:#FFA800;}' + '.city_select_lhsl .title{margin-bottom:10px;color:#999;}' + '.city_select_lhsl .tab_box{width:100%;height:22px;margin-bottom:6px;margin-top:0;border-bottom:2px solid #ccc;}' + '.city_select_lhsl .tab_box li{position:relative;float:left;display:inline;margin-right:2px;line-height:22px;cursor:pointer;}' + '.city_select_lhsl .tab_box li b{display:none;}' + '.city_select_lhsl .tab_box li span{padding:0 8px;}' + '.city_select_lhsl .tab_box .hot_selected{border-bottom:2px solid #06c;margin-bottom:-2px;font-weight:bold;color:#06c;}' + '.city_select_lhsl .tab_box .hot_selected b{position:absolute;top:23px;left:50%;display:block;width:0;height:0;margin-left:-5px;overflow:hidden;font-size:0;line-height:0;border-color:#06c transparent transparent transparent;border-style:solid dashed dashed dashed;border-width:5px;}' + '.city_select_lhsl .city_item, .city_select_lhsl .search_history_box {display:inline-block;*zoom:1;overflow:hidden;}' + '.city_select_lhsl .city_item{width:408px;}' + '.city_select_lhsl .city_item a, .city_select_lhsl .search_history_box a {float:left;display:inline;width:52px;height:22px;margin:0 2px 2px 0;padding-left:8px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;line-height:22px;color:#333;}' + '.city_select_lhsl .city_item a:hover,.city_select_lhsl .search_history_box a:hover{background-color:#2577E3;text-decoration:none;color:#fff;}' + '.city_item .city_item_in{width:378px;padding-left:30px;*zoom:1;}' + '.city_item .city_item_in:after,.city_select_lhsl .search_history_box:after{display:block;height:0;visibility:hidden;overflow:hidden;content:".";clear:both;}' + '.city_item .city_item_letter{float:left;width:30px;height:22px;margin-left:-30px;line-height:22px;text-align:center;color:#E56700;}' + '.city_select_lhsl .sarch_history_title{margin-bottom:2px;font-weight:bold;color:#06c;}' + '.city_select_lhsl .search_history_box{margin-bottom:6px;}', suggestionInit: function (el) { suggestInit(el); } } }); function suggestInit(a) { cQuery(".tab_box li", a[0]).bind("mousedown", function () { cQuery(".tab_box li", a[0]).removeClass("hot_selected"); cQuery(this).addClass("hot_selected"); cQuery(".city_item", a[0]).css("display", "none"); var keywords = cQuery("span", $(this)[0])[0]; if (keywords) { keywords = keywords.innerHTML; } else { keywords = ''; } if (keywords.trim() == '热门') { cQuery(".city_item:eq(0)", a[0]).css("display", ""); } else { cQuery(".city_item").each(function (c) { var letter = cQuery(".city_item_letter", c[0])[0]; if (letter) { if (letter.innerHTML != '' && keywords.indexOf(letter.innerHTML) > -1) { cQuery(c).css("display", ""); } } }); } }); cQuery(".search_history_box a", a[0]).bind("mousedown", function () { cQuery(input).value(this.innerHTML); noticeAddress.method("hidden"); }); cQuery(".title .close", a[0]).bind("mousedown", function () { noticeAddress.method("hidden"); }); cQuery(".tab_box li:eq(0)", a[0]).trigger("mousedown"); }; noticeAddress.method('bind', 'change', function () { if (name == "busFrom") { cQuery("#busTo")[0].focus(); } else if (name == "busTo") { cQuery("#busDate")[0].focus(); } }); return noticeAddress; } function getBusFromCity() { cQuery.jsonp(busBaseUrl + '/agent/index.php?param=/data/cityList&callback=busFromCityCallback', { onload: function () { } }); } function busFromCityCallback(data) { if (data['code'] == 1 && busFromAddress) { busFromAddress.method("source_set", { suggestion: data['return']['suggestion'], data: data['return']['data'] }); } } function getBusToCity(fromCity) { if (fromCity != '' && fromCity != '中文/拼音/首字母') { cQuery.jsonp(busBaseUrl + '/agent/index.php?param=/data/toCityList&fromCity=' + fromCity + '&callback=busToCityCallback', { onload: function () { } }); } } function busToCityCallback(data) { if (data['code'] == 1 && busToAddress) { busToAddress.method("source_set", { suggestion: data['return']['suggestion'], data: data['return']['data'] }); } } function getBusMaxPreSaleDate() { cQuery.jsonp(busBaseUrl + '/agent/index.php?param=/data/getBusMaxPreSaleDate&callback=busMaxPreSaleDateCallback', { onload: function () { } }); } function busMaxPreSaleDateCallback(data) { if (data['code'] == 1 && busMaxDays) { busMaxDays = data['return']['max_pre_sale_date']; } } function searchLoading(ele) { $(ele)[0].value = "搜索中..."; $(ele).addClass("s_btn_ing"); } /*****$endoflist$*****//*****$endoflist$*****/