var G_OnlineAdContentConfig={"allyesId":[{"adid":"542925","link":"http://pages.c-ctrip.com/commerce/promote/201712/other/wu1/index20.html?pushcode=YX_hny57","src":"https://dimg04.c-ctrip.com/images/700c0o000000fd4su7653_1920_340_17.jpg","width":1920,"height":340,"clickTrackUrl":null,"onloadTrackUrl":null,"onloadVTrackUrl":null,"onloadTrackUrl3rd":"","code":"success","placeid":"100046","placeindex":1,"sitetype":"","siteid":"","adtype":3,"dyindex":"","bidcount":""},{"adid":"537299","link":"http://pages.ctrip.com/dstweb/201712/erds/index.html","src":"https://dimg04.c-ctrip.com/images/70030n000000ecgs0CAF7_1920_340_17.jpg","width":1920,"height":340,"clickTrackUrl":null,"onloadTrackUrl":null,"onloadVTrackUrl":null,"onloadTrackUrl3rd":"","code":"success","placeid":"100047","placeindex":2,"sitetype":"","siteid":"","adtype":2,"dyindex":"","bidcount":""},{"adid":"543574","link":"http://pages.ctrip.com/dstweb/201801/ls/index.html","src":"https://dimg04.c-ctrip.com/images/700h0p000000fl6q405B5_1920_340_17.jpg","width":1920,"height":340,"clickTrackUrl":null,"onloadTrackUrl":null,"onloadVTrackUrl":null,"onloadTrackUrl3rd":"","code":"success","placeid":"100048","placeindex":3,"sitetype":"","siteid":"","adtype":2,"dyindex":"","bidcount":""},{"adid":"543411","link":"http://pages.c-ctrip.com/commerce/promote/201709/other/cj/index2.html","src":"https://dimg04.c-ctrip.com/images/700b0p000000fl4zrA0E7_1920_340_17.jpg","width":1920,"height":340,"clickTrackUrl":null,"onloadTrackUrl":null,"onloadVTrackUrl":null,"onloadTrackUrl3rd":"","code":"success","placeid":"100049","placeindex":4,"sitetype":"","siteid":"","adtype":3,"dyindex":"","bidcount":""},{"adid":"540261","link":"http://piao.ctrip.com/dest/t76436.html","src":"https://dimg04.c-ctrip.com/images/700d0m000000dvkuf9CFA_1920_340_17.jpg","width":1920,"height":340,"clickTrackUrl":null,"onloadTrackUrl":null,"onloadVTrackUrl":null,"onloadTrackUrl3rd":"","code":"success","placeid":"100050","placeindex":5,"sitetype":"","siteid":"","adtype":3,"dyindex":"","bidcount":""},{"adid":"543460","link":"http://pages.ctrip.com/destinationad/201802/indonesia/index.html","src":"https://dimg04.c-ctrip.com/images/700s0p000000fq16s26A6_1920_340_17.jpg","width":1920,"height":340,"clickTrackUrl":null,"onloadTrackUrl":null,"onloadVTrackUrl":null,"onloadTrackUrl3rd":"","code":"success","placeid":"100051","placeindex":6,"sitetype":"","siteid":"","adtype":2,"dyindex":"","bidcount":""},{"adid":"538446","link":"http://hotels.ctrip.com/events/dhjtdongyounuanxinjiajiudian5zheqi.html","src":"https://dimg04.c-ctrip.com/images/700r0p000000feb3g3DA1_1920_340_17.jpg","width":1920,"height":340,"clickTrackUrl":null,"onloadTrackUrl":null,"onloadVTrackUrl":null,"onloadTrackUrl3rd":"","code":"success","placeid":"100052","placeindex":7,"sitetype":"","siteid":"","adtype":103,"dyindex":"","bidcount":""},{"adid":"539565","link":"http://pages.c-ctrip.com/commerce/promote/common/tpl4.0/index.html?promoteid=209","src":"https://dimg04.c-ctrip.com/images/700c0n000000e31hd21E1_1920_340_17.jpg","width":1920,"height":340,"clickTrackUrl":null,"onloadTrackUrl":null,"onloadVTrackUrl":null,"onloadTrackUrl3rd":"","code":"success","placeid":"100053","placeindex":8,"sitetype":"","siteid":"","adtype":103,"dyindex":"","bidcount":""},{"adid":"533501","link":"http://hotels.ctrip.com/events/pinpailiansuojiudian85qi.html","src":"https://dimg04.c-ctrip.com/images/700v0k000000c3iacAF22_1920_340_17.jpg","width":1920,"height":340,"clickTrackUrl":null,"onloadTrackUrl":null,"onloadVTrackUrl":null,"onloadTrackUrl3rd":"","code":"success","placeid":"100054","placeindex":9,"sitetype":"","siteid":"","adtype":103,"dyindex":"","bidcount":""}]};G_OnlineAdContentConfig.adstyletype=1;G_OnlineAdContentConfig.addyrequesturl="http://crm.ws.ctrip.com/Customer-Market-Proxy/Ajax/DyRequest.aspx";G_OnlineAdContentConfig.addatalist=[{"domID":"allyesId","adIDs":null,"pagecode":"1","type":"0"}];G_OnlineAdContentConfig.adbiztype="0";G_OnlineAdContentConfig.adstyle="@charset \"utf-8\";@-webkit-keyframes fadeIn{0{opacity:.8}100%{opacity:1}}@-moz-keyframes fadeIn{0{opacity:.8}100%{opacity:1}}@-ms-keyframes fadeIn{0{opacity:.8}100%{opacity:1}}@keyframes fadeIn{0{opacity:.8}100%{opacity:1}}.market-banner-wrap{overflow:hidden;width:100%;min-width:980px;height:100%}.market-banner-wrap .slide-banner{overflow:hidden;position:relative;width:100%;height:100%;z-index:0}.market-banner-wrap .slide-banner .slide-banner-cont{position:absolute;width:100%;height:100%;margin:0 auto;background-repeat:repeat no-repeat}.market-banner-wrap .slide-banner-cont a{display:block;width:1920px;height:100%;margin:0 auto}.market-banner-wrap .slide-banner-cont .slide-pic{background:url(https://pic.c-ctrip.com/common/bg_loading.gif) 66% 50% no-repeat;-webkit-transition:margin-left 400ms ease-out;-moz-transition:margin-left 400ms ease-out;-ms-transition:margin-left 400ms ease-out;-o-transition:margin-left 400ms ease-out;transition:margin-left 400ms ease-out}.market-banner-wrap .slide-banner-cont .fade-in{-webkit-animation:fadeIn .2s ease-in;-moz-animation:fadeIn .2s ease-in;-ms-animation:fadeIn .2s ease-in;-o-animation:fadeIn .2s ease-in;animation:fadeIn .2s ease-in}.market-banner-wrap .dot-wrap{width:1180px;height:12px;margin:0 auto;z-index:1}.market-banner-wrap .dot-wrap .dot-group{width:600px;float:right;margin-top:-32px;text-align:center;line-height:0;font-size:0;z-index:5}.market-banner-wrap .dot-group .dot{overflow:hidden;position:relative;display:inline-block;width:8px;height:8px;margin:0 4px;border:2px solid #fff;border-radius:6px;line-height:99em;background-color:rgba(0,0,0,.2);filter:progid:DXImageTransform.Microsoft.gradient(enabled=&#39;true&#39;,startColorstr=&#39;#33000000&#39;,endColorstr=&#39;#33000000&#39;);background-image:url(###)\\9;-webkit-transition:background .3s ease;transition:background .3s ease}:root .market-banner-wrap .dot-group .dot{filter:none;background-color:rgba(0,0,0,.2)}.market-banner-wrap .dot-group .dot:hover{background-color:rgba(0,0,0,.5);filter:progid:DXImageTransform.Microsoft.gradient(enabled=&#39;true&#39;,startColorstr=&#39;#7F000000&#39;,endColorstr=&#39;#7F000000&#39;)}:root .market-banner-wrap .dot-group .dot:hover{filter:none;background-color:rgba(0,0,0,.5)}.market-banner-wrap .dot-group .dot.dot-current,.market-banner-wrap .dot-group .dot.dot-current:hover{filter:none;background-color:#FFF;cursor:default}:root .market-banner-wrap .dot-group .dot.dot-current,:root .market-banner-wrap .dot-group .dot.dot-current:hover{filter:none;background-color:#FFF}.market-banner-wrap .dot-group .dot::after{content:&#39;&#39;;position:absolute;bottom:0;height:0;left:0;width:100%;background-color:#fff;box-shadow:0 0 1px #fff;-webkit-transition:height .5s ease;-moz-transition:height .5s ease;-ms-transition:height .5s ease;-o-transition:height .5s ease;transition:height .5s ease}.market-banner-wrap .dot-group .dot.dot-current::after{height:100%}@media screen and (max-width:1840px){.market-banner-wrap .slide-banner-cont .slide-pic{margin-left:-40px}}@media screen and (max-width:1760px){.market-banner-wrap .slide-banner-cont .slide-pic{margin-left:-80px}}@media screen and (max-width:1680px){.market-banner-wrap .slide-banner-cont .slide-pic{margin-left:-120px}}@media screen and (max-width:1600px){.market-banner-wrap .slide-banner-cont .slide-pic{margin-left:-160px}}@media screen and (max-width:1520px){.market-banner-wrap .slide-banner-cont .slide-pic{margin-left:-200px}}@media screen and (max-width:1440px){.market-banner-wrap .slide-banner-cont .slide-pic{margin-left:-240px}}@media screen and (max-width:1366px){.market-banner-wrap .slide-banner-cont .slide-pic{margin-left:-277px}}@media screen and (max-width:1280px){.market-banner-wrap .slide-banner-cont .slide-pic{margin-left:-320px}}@media screen and (max-width:1200px){.market-banner-wrap .slide-banner-cont .slide-pic{margin-left:-370px}.market-banner-wrap .dot-wrap{width:980px}.market-banner-wrap .dot-wrap .dot-group{width:400px}}"; 
 (function () {
    //通用方法类
    function Common() { }

    //是否数组
    Common.IsArray = function (obj) {
        return typeof (obj) == "object" && obj.length >= 0;
    };

    //是否函数
    Common.IsFunction = function (fn) {
        return typeof (fn) == "function";
    };

    //是否对象
    Common.IsObject = function (obj) {
        if (obj == null || obj == undefined) {
            return false;
        }
        return typeof (obj) == "object" && Object.prototype.toString.call(obj).toLowerCase() == "[object object]" && !obj.length;
    };

    //是否空对象
    Common.IsEmptyObject = function (obj) {
        if (obj === null || obj === undefined) {
            return true;
        }
        if (typeof (obj) == "object" && obj.length > 0) {
            return false;
        }
        if (typeof (obj) == "object") {
            var blExists = false;
            for (var key in obj) {
                blExists = true;
                break;
            }
            return !blExists;
        }
        return false;
    };

    //字符串去掉空格
    Common.StringTrim = function (str) {
        return (str === undefined || str === null) ? "" : str.replace(/(^\s*)|(\s*$)/g, "").replace(/(^　*)|(　*$)/g, "");
    };

    //字符串格式化
    Common.StringFormat = function (str, array) {
        if (Common.StringIsNullOrEmpty(str)) {
            return "";
        }
        if (Common.IsArray(array)) {
            for (var i = 0; i < array.length; i++) {
                array[i] = Common.StringIsNullOrEmpty(array[i]) ? "" : array[i].toString();
                str = str.replace(new RegExp("\\{" + i.toString() + "\\}", "g"), array[i]);
            }
        }
        return str;
    };

    //字符串是否为空
    Common.StringIsNullOrEmpty = function (value) {
        return (value === null || value === undefined) || Common.StringTrim(value.toString()) == "";
    };

    //创建GUID
    Common.CreateGuid = function () {
        var guid = "";
        for (var i = 1; i <= 32; i++) {
            var n = Math.floor(Math.random() * 16.0).toString(16);
            guid += n;
            if ((i == 8) || (i == 12) || (i == 16) || (i == 20)) {
                guid += "-";
            }
        }
        return guid;
    };

    //JSON字符串转化成对象
    Common.JsonToObject = function (jsonString) {
        if (Common.StringIsNullOrEmpty(jsonString) || typeof (jsonString) != "string") {
            return null;
        }
        jsonString = Common.StringTrim(jsonString);
        try {
            return eval("(" + jsonString + ")");
        }
        catch (ex) {
        }
        return null;
    };

    //将对象转换成JSON字符串
    Common.JsonToString = function (obj) {
        if (obj === null || obj === undefined || Common.IsFunction(obj)) {
            return "";
        }
        return ValueToString("", obj);

        function ValueToString(key, value) {
            var vs = "";
            if (value == null) {
                vs = "null";
            }
            else if (typeof (value) == "number") {
                vs = value.toString();
            }
            else if (typeof (value) == "boolean") {
                vs = value.toString().toLowerCase();
            }
            else if (Common.IsArray(value)) {
                var jsons = [];
                for (var i = 0; i < value.length; i++) {
                    jsons.push(ValueToString("", value[i]));
                }
                vs = "[" + jsons.join(",") + "]";
            }
            else if (Common.IsObject(value)) {
                var jsons = [];
                for (var k in value) {
                    if (!Common.IsFunction(value[k])) {
                        jsons.push(ValueToString(k, value[k]));
                    }
                }
                vs = "{" + jsons.join(",") + "}";
            }
            else {
                vs = "\"" + value.toString().replace(/\\/g, "\\\\").replace(/"/g, "\\\"") + "\"";
            }
            return Common.StringIsNullOrEmpty(key) ? vs : Common.StringFormat("\"{0}\":{1}", [key, vs]);
        }
    };

    //克隆对象
    Common.Clone = function (obj) {
        if (Common.IsEmptyObject(obj)) {
            return obj;
        }
        if (Common.IsArray(obj)) {
            var list = [];
            for (var i = 0; i < obj.length; i++) {
                list.push(Common.Clone(obj[i]));
            }
            return list;
        }
        else if (Common.IsObject(obj)) {
            var cloneObj = {};
            for (var key in obj) {
                if (Common.IsArray(obj[key]) || Common.IsObject(obj[key])) {
                    cloneObj[key] = Common.Clone(obj[key]);
                }
                else {
                    cloneObj[key] = obj[key];
                }
            }
            return cloneObj;
        }
        return obj;
    };

    //获取Cookie
    Common.GetCookie = function (name) {
        var cookieValue = null;
        if (document.cookie && document.cookie != '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = Common.StringTrim(cookies[i]);
                if (cookie.substring(0, name.length + 1) == (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    };

    //查询数组
    Common.ArrayWhereToList = function (list, fn) {
        var wList = [];
        for (var i = 0; i < list.length; i++) {
            if (fn(list[i], i)) {
                wList.push(list[i]);
            }
        }
        return wList;
    };

    //数组遍历
    Common.ArrayForeach = function (list, fn) {
        for (var i = 0; i < list.length; i++) {
            if (fn(list[i], i) === false) {
                break;
            }
        }
    };

    //加载CSS
    Common.LoadCss = function (id, content) {
        var newStyle = document.createElement("style");
        newStyle.type = "text/css";
        newStyle.id = id;
        if (typeof newStyle.styleSheet != "undefined") {
            newStyle.styleSheet.cssText = content;
        }
        else {
            newStyle.innerHTML = content;
        }
        document.getElementsByTagName("head")[0].appendChild(newStyle);
    };

    //加载CSS引用
    Common.LoadLink = function (url) {
        var link = document.createElement("link");
        link.type = "text/css";
        link.rel = "stylesheet";
        link.href = url;
        document.getElementsByTagName("head")[0].appendChild(link);
    };

    //加载js引用
    Common.LoadJs = function (url,callback) {
        var newJs = document.createElement("script");
        newJs.type = "text/javascript";
        newJs.async = true;
        newJs.src = url
        newJs.onload=newJs.onreadystatechange=function(){  
           if(!this.readyState||this.readyState=='loaded'||this.readyState=='complete'){  
                if(callback)callback();
            }  
        }
        document.getElementsByTagName('head')[0].appendChild(newJs);
    };

    //获取查询字符串
    Common.GetPageQueryString = function () {
        var args = {};
        var query = location.search.substring(1);
        var pairs = query.split("&");
        for (var i = 0; i < pairs.length; i++) {
            var pos = pairs[i].indexOf('=');
            if (pos == -1) continue;
            var argname = pairs[i].substring(0, pos);
            var value = pairs[i].substring(pos + 1);
            args[argname] = unescape(value);
        }
        return args;
    };

    Common.AddUrlRandom = function (url) {
        if (Common.StringIsNullOrEmpty(url)) {
            return;
        }
        url += url.indexOf("?") > 0 ? "&" : "?";
        url += Common.StringFormat("_r{0}={1}", [Common.GetRandomChars(), Math.random()]);
        return url;
    };

    Common.GetRandomChars = function (len) {
        len = len || 10;
        var chars = "ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz";
        var str = [];
        for (var i = 0; i < len; i++) {
            str.push(chars.charAt(Math.floor(Math.random() * chars.length)));
        }
        return str.join("");
    };
    //HTML标签类
    function HtmlTag() { }

    HtmlTag.GetById = function (id) {
        return document.getElementById(id);
    };

    HtmlTag.GetValue = function (id) {
        var ele = typeof (id) == "string" ? HtmlTag.GetById(id) : id;
        if (ele != null && ele.value != undefined) {
            return ele.value;
        }
        return "";
    };

    HtmlTag.SetHtml = function (ele, html) {
        if (ele != null && html !== undefined) {
            ele.innerHTML = html;
        }
    };

    HtmlTag.AppendHtml = function (ele, html) {
        var div = document.createElement("div");
        HtmlTag.SetHtml(div, html);
        while (div.childNodes.length > 0) {
            ele.appendChild(div.childNodes[0]);
        }
    };

    HtmlTag.GetElementsByTagName = function (ele, tagName) {
        return ele != null && ele.getElementsByTagName(tagName);
    };

    HtmlTag.SetHide = function (ele) {
        if (ele != null && ele.style != undefined) {
            ele.style.display = "none";
        }
    };

    HtmlTag.SetShow = function (ele) {
        if (ele != null && ele.style != undefined) {
            ele.style.display = "";
        }
    };

    HtmlTag.GetScreenWidth = function () {
        return window.innerWidth * (window.devicePixelRatio || 1);
    };

    HtmlTag.GetScreenHeight = function () {
        return window.innerHeight * (window.devicePixelRatio || 1);
    };

    HtmlTag.GetBodyWidth = function () {
        return document.body.offsetWidth;
    };

    HtmlTag.GetBodyHeight = function () {
        return document.body.offsetHeight;
    };

    HtmlTag.GetWidth = function (ele) {
        if (ele != null && ele.style != undefined) {
            if (ele.style.width == "") {
                if (ele.parentNode != null) {
                    return HtmlTag.GetWidth(ele.parentNode);
                }
                else {
                    return HtmlTag.GetBodyWidth();
                }
            }
            else if (ele.style.width.indexOf("%") > 0) {
                var parentWidth = HtmlTag.GetWidth(ele.parentNode);
                var rate = parseFloat(ele.style.width);
                return parentWidth * rate / 100;
            }
            else {
                return parseFloat(ele.style.width);
            }
        }
        return ele.body != undefined ? HtmlTag.GetBodyWidth() : 0;
    };

    HtmlTag.SetWidth = function (ele, width) {
        if (ele != null && ele.style != undefined) {
            var w = parseFloat(width);
            if (!isNaN(w)) {
                ele.style.width = w.toString() + "px";
            }
        }
    };

    HtmlTag.GetHeight = function (ele) {
        if (ele != null && ele.style != undefined) {
            if (ele.style.height == "") {
                if (ele.parentNode != null) {
                    return HtmlTag.GetHeight(ele.parentNode);
                }
                else {
                    return HtmlTag.GetBodyHeight();
                }
            }
            else if (ele.style.width.indexOf("%") > 0) {
                var parentHeight = HtmlTag.GetHeight(ele.parentNode);
                var rate = parseFloat(ele.style.height);
                return parentHeight * rate / 100;
            }
            else {
                return parseFloat(ele.style.height);
            }
        }
        return ele.body != undefined ? HtmlTag.GetBodyHeight() : 0;
    };

    HtmlTag.SetHeight = function (ele, height) {
        if (ele != null && ele.style != undefined) {
            var h = parseFloat(height);
            if (!isNaN(h)) {
                ele.style.height = h.toString() + "px";
            }
        }
    };

    HtmlTag.SetStyle = function (ele, style) {
        if (ele != null && ele.style != undefined) {
            if (Common.IsObject(style)) {
                for (var key in style) {
                    ele.style[key] = style[key];
                }
            }
        }
    };

    HtmlTag.SetStyleValue = function (ele, key, value) {
        if (ele != null && ele.style != undefined) {
            ele.style[key] = value;
        }
    };

    HtmlTag.RemoveClass = function (ele, className) {
        if (ele != null && ele.className != undefined) {
            ele.className = Common.StringTrim(ele.className.replace(className, "").replace("  ", ""));
        }
    };

    HtmlTag.AddClass = function (ele, className) {
        if (ele != null && ele.className != undefined) {
            className = Common.StringTrim(ele.className) + " " + className;
            ele.className = Common.StringTrim(className);
        }
    };

    HtmlTag.BindEvent = function (ele, eventName, fn) {
        HtmlTag.RemoveEvent(ele, eventName, fn);
        HtmlTag.AddEvent(ele, eventName, fn);
    };

    HtmlTag.AddEvent = function (ele, eventName, fn) {
        if (ele.attachEvent) {
            ele.attachEvent('on' + eventName, fn);
        }
        else if (ele.addEventListener) {
            ele.addEventListener(eventName, fn, false);
        }
        else {
            ele["on" + eventName] = fn;
        }
    };

    HtmlTag.RemoveEvent = function (ele, eventName, fn) {
        if (ele.attachEvent) {
            ele.detachEvent('on' + eventName, fn);
        }
        else if (ele.addEventListener) {
            ele.removeEventListener(eventName, fn, false);
        }
        else {
            ele["on" + eventName] = null;
        }
    };

    HtmlTag.RemoveElement = function (ele) {
        if (typeof (ele) == "string") {
            ele = HtmlTag.GetById(ele);
        }
        ele && ele.parentNode && ele.parentNode.removeChild(ele);
    }
    //外部接口类
    function OutInterface() { }

    //获取_bfa Cookie值，取其第二、三项值作为VId值
    OutInterface.GetVId = function () {
        var _bfa = Common.GetCookie("_bfa");
        if (_bfa != null) {
            var _bfa_Values = _bfa.toString().split('.');
            if (_bfa_Values.length > 2) {
                return _bfa_Values[1] + "." + _bfa_Values[2];
            }
        }
        return "";
    };

    //获取uid
    OutInterface.GetUId = function () {
        var uid = Common.GetCookie("login_uid");
        return Common.StringIsNullOrEmpty(uid) ? "" : uid;
    };

    OutInterface.SetUBTTrackLog = function (type, value) {
        window.__bfi = window.__bfi || [];
        var key = type == 2 ? "pcadpv" : type == 3 ? "pcadclick" : type == 1 ? "sumadpv" : "";
        key != "" && window.__bfi.push(["_tracklog", key, value]);
    };
	

//广告Slider控件
function SliderControl(slider) {
    this.Slider = slider;
    this.Id = Common.CreateGuid();
    this.DataList = [];
    this.ItemChange = function (item) { };
    this.ItemClick = function (item) { };
    this.Width = 0;
    this.Height = 0;
    this.IsSlider = false;
    this.TagObject = null;
    this.SelectData = null;
    this.IsVisible = false;

    this.Load = function (dataList) {
        this.DataList = dataList;
        if (dataList.length > 0) {
            Common.ArrayForeach(this.DataList, function (item, index) {
                item.Id = Common.CreateGuid();
                item.IsLoad = false;
                item.IsShow = false;
                item.Index = index;
            });
            this.Width = this.DataList[0].width;
            this.Height = this.DataList[0].height;
           
            this.TagObject = this.Slider.TagObject;

            //获取HTML
            if (this.Slider.AdStyleType == 1) {
                HtmlTag.SetHtml(this.TagObject, GetHtml.call(this));
            }
            else if (this.Slider.AdStyleType == 2) {
                HtmlTag.SetHtml(this.TagObject, GetHtml2.call(this));
            }
            //判断是否可视
            JudgeVisible.call(this);
            //加载图片列表
            LoadImageList.call(this);
            //事件加载
            EventLoad.call(this);						
        }
    };

    this.ReLoad = function () {
        this.Stop();
        this.IsSlider = false;
        this.LastSelectData = null;
        HtmlTag.SetHtml(this.TagObject, "");
        this.Load(this.DataList);
    };

    this.Play = function () {
        var $this = this;
        this.Stop();
        if (this.IsSlider) {
            this.TimeoutId = window.setInterval(function () {
                SetNext.call($this);
            }, 5000);
        }
    };

    this.Stop = function () {
        if (this.TimeoutId != null) {
            window.clearInterval(this.TimeoutId);
            this.TimeoutId = null;
        }
    };
    this.SetIndex=function(adid) {
        var $this = this;
        var selectData = null;
        //取当前索引下一帧
        Common.ArrayForeach(this.DataList, function (item) {
            if ($this.SelectData != null && item.adid == adid) {
                selectData = item;
                return false;
            }
        });
        var blFirst = false;
        //未取到当前索引下一帧，取第一帧
        if (selectData == null) {
            Common.ArrayForeach(this.DataList, function (item) {
                if (item.IsShow) {
                    selectData = item;
                    return false;
                }
            });
        }
        //设置选择索引
        if (selectData != null) {
            SetSelectIndex.call(this, selectData);
        }
    };
    this.LoadImage = function (item) {
        var $this = this;
        if (!Common.StringIsNullOrEmpty(item.src)) {
            var img = new Image();
            img.src = MaterialToHttps(item.src);
            img.onload = function () {
                var tagObj = HtmlTag.GetById("a_" + item.Id);
                if (tagObj == null) {
                    return;
                }
                item.IsLoad = true;
                item.IsRequest = true;

                HtmlTag.SetHtml(tagObj, "");
                if ($this.Slider.AdStyleType == 1) {
                    this.className = "slide-pic";
                }
                if (!item.IsDy) {
                    this.width = item.width;
                    this.height = item.height;
                }
                tagObj.appendChild(this);

                //动态广告加载CSS
                if (item.IsDy && !Common.StringIsNullOrEmpty(item.style)) {
                    HtmlTag.GetById("dyadStyle" + item.Id) == null && Common.LoadCss("dyadStyle" + item.Id, item.style);
                }

                //动态广告内容
                if (item.IsDy && !Common.StringIsNullOrEmpty(item.content)) {
                    HtmlTag.AppendHtml(tagObj, item.content);
                }

                item.TagObject = tagObj;
                //图片显示设置
                SetShowImage(item);
            };
            img.onerror = function () {
                item.IsLoad = false;
                item.IsRequest = true;
                //图片显示设置
                SetShowImage(item);
            };
        }
		function MaterialToHttps(src){
                var protocal=window.location.protocol;
                if(protocal=='https:'&&(src.indexOf('http://dimg04.c-ctrip.com/images/')==0||src.indexOf('http://dimg.uat.qa.nt.ctripcorp.com/images/')==0)){
                        return "https:"+src.substring(5);
                }

                return src;
        }
        //图片显示设置
        function SetShowImage(imageItem) {
            var blShow = true;
            //前面图片未显示，当前图片则不显示
            if (imageItem.BeforeImage) {
                if (!imageItem.BeforeImage.IsRequest) {
                    blShow = false;
                }
                else if (imageItem.BeforeImage.IsLoad && !imageItem.BeforeImage.IsShow) {
                    blShow = false;
                }
            }

            if (blShow && imageItem.IsLoad) {
                imageItem.IsShow = true;
                SetNavPosition.call($this);

                if (!$this.Slider.IsLoadComplete) {
                    $this.Slider.IsLoadComplete = true;
                    !Common.StringIsNullOrEmpty($this.Slider.BackupImageId) && HtmlTag.RemoveElement($this.Slider.BackupImageId);
                    SetSelectIndex.call($this, imageItem);
                    HtmlTag.SetShow($this.TagObject);
                }
                else {
                    SetSelectIndex.call($this);
                }

                HtmlTag.SetShow(HtmlTag.GetById("nav_" + imageItem.Id));
            }

            //设置后面图片显示
            if (blShow && imageItem.AfterImage && imageItem.AfterImage.IsRequest) {
                SetShowImage(imageItem.AfterImage);
            }
        }
    };

    //获取广告数据
    function GetHtml() {
        var $this = this;
        HtmlTag.AddClass(this.TagObject, "market-banner-wrap");
        var html = [];
        html.push(Common.StringFormat("<div class=\"slide-banner\" id=\"{0}\">", [this.Id]));

        Common.ArrayForeach(this.DataList, function (item) {
            html.push(GetItemHtml.call($this, item));
        });

        html.push("</div>");

        //导航点图标
        if (this.DataList.length > 1) {
            html.push(Common.StringFormat("<div class=\"dot-wrap\" id=\"nav_{0}\" style=\"display:none;\">", [this.Id]));
            html.push("<div class=\"dot-group\">");
            Common.ArrayForeach(this.DataList, function (item) {
                html.push(GetNavItemHtml.call($this, item));
            });
            html.push("</div></div>");
        }
        return html.join("");

        //获取广告帧HTML
        function GetItemHtml(item) {
            var html = [];
            html.push(Common.StringFormat("<div class=\"slide-banner-cont\" id=\"{0}\" style=\"z-index:0;display:none;\">", [item.Id]));
			if(item.link==''||item.link.indexOf('javascript:')==0||item.link=='#'){
				html.push(Common.StringFormat("<a href=\"{0}\" id=\"a_{1}\" ></a>", [item.link, item.Id]));
			}else{
				html.push(Common.StringFormat("<a href=\"{0}\" target=\"_blank\" id=\"a_{1}\" ></a>", [item.link, item.Id]));
			}
            html.push("</div>");
            return html.join("");
        }

        //获取导航点图标项HTML
        function GetNavItemHtml(item) {
            var html = [];
            html.push(Common.StringFormat("<a href=\"javascript:void(0);\" class=\"dot\" id=\"nav_{0}\" style=\"display:none;\"></a>", [item.Id]));
            return html.join("");
        }
    }

    //获取广告数据
    function GetHtml2() {
        var $this = this;
        HtmlTag.AddClass(this.TagObject, "jmkt-picsroller");
        var html = [];

        Common.ArrayForeach(this.DataList, function (item) {
            html.push(GetItemHtml.call($this, item));
        });

        //导航点图标
        if (this.DataList.length > 1) {
            html.push(Common.StringFormat("<div class=\"jmkt-picsroller-numbox\" id=\"nav_{0}\" style=\"display:none;\">", [this.Id]));
            html.push("<ul class=\"jmkt-picsroller-num\">");
            Common.ArrayForeach(this.DataList, function (item) {
                html.push(GetNavItemHtml.call($this, item));
            });
            html.push("</ul></div>");
        }
        return html.join("");

        //获取广告帧HTML
        function GetItemHtml(item) {
            var html = [];
            html.push(Common.StringFormat("<div class=\"jmkt-picsroller-pics\" id=\"{0}\" style=\"z-index:0;display:none;\">", [item.Id]));
			if(item.link==''||item.link.indexOf('javascript:')==0||item.link=='#'){
				 html.push(Common.StringFormat("<a href=\"{0}\" id=\"a_{1}\" ></a>", [item.link, item.Id]));
			}else{
				 html.push(Common.StringFormat("<a href=\"{0}\" target=\"_blank\" id=\"a_{1}\" ></a>", [item.link, item.Id]));
			}
           
            html.push("</div>");
            return html.join("");
        }

        //获取导航点图标项HTML
        function GetNavItemHtml(item) {
            var html = [];
            html.push(Common.StringFormat("<li id=\"nav_{0}\" style=\"display:none;\"></li>", [item.Id]));
            return html.join("");
        }
    }

    //事件加载
    function EventLoad() {
        var $this = this;

        //窗体改变
        HtmlTag.BindEvent(window, "resize", function () { JudgeVisible.call($this); });
        //滚动
        HtmlTag.BindEvent(window, "scroll", function () { JudgeVisible.call($this); });

        var ele = null, tagName = "";

        if (this.Slider.AdStyleType == 1) {
            ele = HtmlTag.GetById(this.Id);
            tagName = "a";
        }
        else if (this.Slider.AdStyleType == 2) {
            ele = this.TagObject;
            tagName = "li";
        }
        if (ele == null) {
            return;
        }

        //导航点击事件
        var tagList = HtmlTag.GetElementsByTagName(HtmlTag.GetById("nav_" + this.Id), tagName);
        if (Common.IsArray(tagList)) {
            Common.ArrayForeach(tagList, function (item) {
                item.onmouseover = function () {
                    var id = this.id.replace("nav_", "");
                    SetSelectIndex.call($this, GetItemData.call($this, id));
                };
            });
        }

        //点击事件
        tagList = HtmlTag.GetElementsByTagName(ele, "a");
        if (Common.IsArray(tagList)) {
            Common.ArrayForeach(tagList, function (item) {
                item.onclick = function () {
                    var id = this.id.replace("a_", "");
                    $this.ItemClick(GetItemData.call($this, id));
                };
            });
        }

        var stop = function () { $this.Stop(); };
        var play = function () { $this.Play(); };

        //鼠标mouseover
        HtmlTag.BindEvent(ele, "mouseover", stop);
        //鼠标mouseout
        HtmlTag.BindEvent(ele, "mouseout", play);
    }

    //重置尺寸
    function JudgeVisible() {
        var winSize = {};
        winSize.left = (window.navigator.userAgent.indexOf("Chrome") != -1 || window.navigator.userAgent.indexOf('Safari') != -1) ? document.body.scrollLeft : document.documentElement.scrollLeft;
        winSize.right = winSize.left + (window.navigator.userAgent.indexOf("MSIE") === -1 ? window.innerWidth : document.documentElement.offsetWidth);
        winSize.top = (window.navigator.userAgent.indexOf("Chrome") != -1 || window.navigator.userAgent.indexOf('Safari') != -1) ? document.body.scrollTop : document.documentElement.scrollTop;
        winSize.bottom = winSize.top + (window.navigator.userAgent.indexOf("MSIE") === -1 ? window.innerHeight : document.documentElement.offsetHeight);

        var img = {};
        img.left = this.TagObject.offsetLeft;
        img.top = this.TagObject.offsetTop;
        if (this.TagObject.offsetParent) {
            if (this.TagObject.offsetParent.offsetLeft > 0) {
                img.left += this.TagObject.offsetParent.offsetLeft;
            }
            if (this.TagObject.offsetParent.offsetTop > 0) {
                img.top += this.TagObject.offsetParent.offsetTop;
            }
        }
        img.right = img.left + this.Width;
        img.bottom = img.top + this.Height;

        var is_seen = false;
        if (img.right < winSize.left) {
            //左侧不可见区域
            is_seen = false;
        }
        else if (img.left > winSize.right) {
            //右侧不可见区域
            is_seen = false;
        }
        else if (img.right - img.left > 500 && img.bottom + 100 < winSize.top) {
            //大广告上侧不可见区域
            is_seen = false;
        }
        else if (img.right - img.left < 200 && img.bottom < winSize.top) {
            //底部广告上侧不可见区域
            is_seen = false;
        }
        else if (img.top > winSize.bottom) {
            //下侧不可见区域
            is_seen = false;
        }
        else {
            is_seen = true;
        }
        this.IsVisible = is_seen;
    }

    //获取数据
    function GetItemData(id) {
        var data = null;
        Common.ArrayForeach(this.DataList, function (item) {
            if (item.Id == id) {
                data = item;
                return false;
            }
        });
        return data;
    }

    
    //设置下一帧
    function SetNext() {
        var $this = this;
        var selectData = null;
        //取当前索引下一帧
        Common.ArrayForeach(this.DataList, function (item) {
            if (item.IsShow && $this.SelectData != null && item.Index > $this.SelectData.Index) {
                selectData = item;
                return false;
            }
        });
        var blFirst = false;
        //未取到当前索引下一帧，取第一帧
        if (selectData == null) {
            Common.ArrayForeach(this.DataList, function (item) {
                if (item.IsShow) {
                    selectData = item;
                    return false;
                }
            });
        }
        //设置选择索引
        if (selectData != null) {
            SetSelectIndex.call(this, selectData);
        }
    }

    //设置选择索引 
    function SetSelectIndex(selectData) {
        if (selectData != undefined) {
            this.LastSelectData = this.SelectData;
            this.SelectData = selectData;
        }

        this.SelectData != null && SetSelectItem.call(this);
        if (this.SelectData != null) {
            this.IsVisible && this.ItemChange(this.SelectData);
            this.Play();
        }

        //设置选择项
        function SetSelectItem() {
            var selectElement = HtmlTag.GetById(this.SelectData.Id);
            if (selectElement == null) {
                this.SelectData = null;
                this.Stop();
                return;
            }
            if (this.LastSelectData == null || this.LastSelectData.Id != this.SelectData.Id) {
                if (this.LastSelectData != null) {
                    var ele = HtmlTag.GetById(this.LastSelectData.Id);
                    HtmlTag.SetStyle(ele, { zIndex: 0 });
                    HtmlTag.SetHide(ele);
                }

                selectElement = HtmlTag.GetById(this.SelectData.Id);
                HtmlTag.SetStyle(selectElement, { zIndex: 1 });
                HtmlTag.SetShow(selectElement);
            }

            if (this.IsSlider) {
                SetSelectNavCss(this.SelectData.Id, this.Slider.AdStyleType);
            }
        }

        //设置选择导航css
        function SetSelectNavCss(id, type) {
            var className = "", tagName = "";
            if (type == 1) {
                className = "dot-current";
                tagName = "a";
            }
            else if (type == 2) {
                className = "jmkt-num-current";
                tagName = "li";
            }
            var ele = HtmlTag.GetById("nav_" + id);
            if (ele == null) {
                return;
            }
            var tagList = HtmlTag.GetElementsByTagName(ele.parentNode, tagName);
            if (Common.IsArray(tagList)) {
                Common.ArrayForeach(tagList, function (item) {
                    HtmlTag.RemoveClass(item, className);
                });
            }
            HtmlTag.AddClass(ele, className);
        }
    }

    //设置导航位置
    function SetNavPosition() {
        var len = GetLoadLength.call(this);
        var ele = HtmlTag.GetById("nav_" + this.Id);
        var blSlider = false;
        if (!this.IsSlider) {
            blSlider = len > 1;
        }
        if (blSlider) {
            this.IsSlider = true;
            this.Play();
            HtmlTag.SetShow(ele);
        }
    }

    function GetLoadLength() {
        var dataList = Common.ArrayWhereToList(this.DataList, function (item) {
            return item.IsLoad;
        });
        return dataList.length;
    }

    //加载图片列表
    function LoadImageList() {
        var $this = this;
        Common.ArrayForeach(this.DataList, function (item, index) {
            if (index - 1 >= 0) {
                item.BeforeImage = $this.DataList[index - 1];
            }
            if (index + 1 < $this.DataList.length) {
                item.AfterImage = $this.DataList[index + 1];
            }
        });

        Common.ArrayForeach(this.DataList, function (item, index) {
            $this.LoadImage(item);
        });
    }
}
    

//广告Slider类
function AdSlider() {
    this.PageId = "";
    this.BizType = "";
    this.SliderControl = null;
    this.DataList = [];
    this.TagId = "";
    this.AdStyleType = 0;
    this.ConfigData = {};
    this.BidDataList=[];
    this.BidCount=0;
    this.TagObject = {};

    //广告加载
    this.Load = function (options) {
        try {
            if (!Common.IsObject(options)) {
                return;
            }
            for (var key in options) {
                this[key] = options[key];
            }

            this.TagObject = HtmlTag.GetById(this.TagId);
            if (this.TagObject == null) {
                return;
            }

            //保底
            SetBackupImage.call(this);

            //绑定数据
            BandData.call(this);

            //请求动态广告
            RequestDyAd.call(this);
			
        }
        catch (ex) {
        }

        return this;
    };

    //动态广告加载
    this.DyLoad = function (data) {  
        var $this=this;  
        this.executed=true;    
        if (!data.AID) {
            LoadNoBidAD.call(this);
            return;
        }
        var bidplaceindex = GetBidPlaceIndex(this.DataList,this.BidDataList);
        if(bidplaceindex<0&&this.DataList.length>0){
            LoadNoBidAD.call(this);
            return;
        }

        var dyData = {};
        dyData.adid = data.AID;
        dyData.placeid = data.PlaceID;
        dyData.placeindex = bidplaceindex;//data.Index;
        dyData.src = data.Src;
        dyData.link = data.Link;
        dyData.content = data.Content;
        dyData.style = data.Style;
        dyData.width = data.Width;
        dyData.height = data.Height;
        dyData.IsDy = true;
        dyData.adtype=100;
        dyData.Id = Common.CreateGuid();
        dyData.bidcount=GetBidCount(this.DataList,this.BidDataList)-this.DataList.length;

        if (data.Extension && data.Extension.length > 0) {
            Common.ArrayForeach(data.Extension, function (item) {
                dyData[item.Name] = item.Value;
            });
        }

        var i = 0;
        if (this.DataList.length > 0 && dyData.placeindex > this.DataList[this.DataList.length - 1].placeindex) {
            i = -2;
        }
        else {
            Common.ArrayForeach(this.DataList, function (item, index) {
                if (item.placeindex == dyData.placeindex) {
                    i = -1;
                    return false;
                }
                else if (parseInt(item.placeindex) > dyData.placeindex) {
                    i = index;
                    return false;
                }
            });
        }

        if (i >= 0 || i == -2) {
            if (i == -2) {
                this.DataList.push(dyData);
                dyData.bidcount=dyData.bidcount-1;
            }
            else {
                this.DataList.splice(i, 0, dyData);
                dyData.bidcount=dyData.bidcount-1;
            }           
        }
        if(dyData.bidcount<=0){
            this.SliderControl.ReLoad();
            if(dyData.adtype>=100)
            this.SliderControl.SetIndex(dyData.adid);
            //动态广告曝光
            this.SetAdSumPv(dyData);
        }else{
            //竞价逻辑
            LoadBidAD.call(this,dyData.bidcount,dyData);       
        } 
    };
    //不含动态竞价逻辑
    function LoadNoBidAD(){
        var $this=this;
        Common.ArrayForeach(this.BidDataList, function (item, index) {
            $this.DataList.splice(item.placeindex-1, 0, item);
        });
        this.SliderControl.ReLoad();
        if(this.BidDataList.length>0){
            this.SliderControl.SetIndex(this.BidDataList[0].adid);
        }
        //竞价广告曝光   
        Common.ArrayForeach(this.BidDataList,function(item,index){
            $this.SetAdSumPv(item);
        });
    }
    //含动态竞价逻辑
    function LoadBidAD(bidcount,dyData){
        var $this=this;        
        var bidads=[];
        
        Common.ArrayForeach(this.BidDataList,function(item,index){
            if(index==bidcount)return false;
            if(item.placeindex==dyData.placeindex){
                dyData.placeid=item.placeid;
            }
            if(dyData.placeindex>item.placeindex){
                //动态广告前
                $this.DataList.splice($this.BidDataList[index].placeindex-1, 0, item);
                bidads.push(item);
            }else if(index+1<$this.BidDataList.length){
                //动态广告后,广告位ID前移动一个位置
                $this.BidDataList[index].placeid=$this.BidDataList[index+1].placeid;
                $this.DataList.splice($this.BidDataList[index+1].placeindex-1, 0, item);
                bidads.push(item);
            }else{
                $this.DataList.push(item);
            }
        });

        //重新加载
        this.SliderControl.ReLoad();
        if(bidads[0].placeindex<dyData.placeindex&&bidads.length>0){
            this.SliderControl.SetIndex(bidads[0].adid);
        }else
        {
            this.SliderControl.SetIndex(dyData.adid);
        }
        //动态广告曝光
        this.SetAdSumPv(dyData);
        //竞价广告曝光   bidads
        Common.ArrayForeach(bidads,function(item,index){
            $this.SetAdSumPv(item);
        });        
    }
    function GetBidPlaceIndex(datalist,biddatalist){
        try{
            if(datalist.length>0){
                if(!Common.StringIsNullOrEmpty(datalist[0].dyindex))
                return datalist[0].dyindex;
            }
            else
            if(biddatalist.length>0){
                if(!Common.StringIsNullOrEmpty(biddatalist[0].dyindex))
                return biddatalist[0].dyindex;
            }
            else  return -9999;
        }catch(err){}
        return -9999;
    }
    function GetBidCount(datalist,biddatalist){
        try{
            if(datalist.length>0){
                if(!Common.StringIsNullOrEmpty(datalist[0].bidcount))
                return datalist[0].bidcount;
            }
            else 
            if(biddatalist.length>0){
                if(!Common.StringIsNullOrEmpty(biddatalist[0].bidcount))
                return biddatalist[0].bidcount;
            }
            else return 0;
        }catch(err){}
        return 0;
    }
    function BandData() {
        var $this = this;
        this.SliderControl = new SliderControl(this);

        this.SliderControl.ItemChange = function (item) {
            //有效一次
            if (item && !item.IsVisible) {
                item.IsVisible = true;
                SetTrackLog.call($this, 2, item);
            }
        };

        this.SliderControl.ItemClick = function (item) {
            item && SetTrackLog.call($this, 3, item);
        };

        //广告sumadpv
        this.SetAdSumPv = function (item) {
            item && SetTrackLog.call(this, 1, item);
        };

        //广告曝光
        this.SetAdSumPv(GetSumAdPvItem(this.DataList));

        this.SliderControl.Load(this.DataList);

        //第三方曝光
        SetThridAdPv(this.DataList);

        //设置日志
        function SetTrackLog(type, item) {
            //H5取VID
            var userId = OutInterface.GetVId();

            //PageId
            if (Common.StringIsNullOrEmpty(this.PageId)) {
                this.PageId = HtmlTag.GetValue("page_id");
            }
            if (Common.StringIsNullOrEmpty(this.PageId)) {
                return;
            }

            //UBT TrackLog Key Value
            var value = "UserId=" + userId + "&PageId=" + this.PageId;

            //曝光
            if (type == 1) {
                value += "&PositionIdVSAdId=" + item.placeid;
                if (item.adtype>=100||item.IsDy) {
                    value += ":" + item.adid;
                }
            }
            else {
                value += "&PositionId=" + item.placeid + "&AdId=" + item.adid + "&src=" + item.src;
            }

            if (item.IsDy) {
                value += "&uid=" + OutInterface.GetUId();
                value += "&vid=" + userId;

                if (!Common.StringIsNullOrEmpty(item.BITraceLog)) {
                    value += "&" + item.BITraceLog;
                }
            }
            //增加PC站点埋点跟站点类型埋点(站点=城市)
            var siteid = item.siteid || "";
            var sitetype = item.sitetype || "";
            value += "&SiteID=" + siteid;
            value += "&SiteType=" + sitetype;

            OutInterface.SetUBTTrackLog(type, value);
        }

        //曝光广告位ID集合
        function GetSumAdPvItem(adList) {
            var siteid = "";
            var sitetype = "";
            var placeIds = [];
            Common.ArrayForeach(adList, function (t) {
                if (!siteid || siteid == "") {
                    siteid = t.siteid || "";
                    sitetype = t.sitetype || "";
                }

                if (!t.IsDy && t.placeid && t.adid) {
                    placeIds.push(t.placeid + ":" + t.adid);
                }
            });

            return placeIds.length > 0 ? { placeid: placeIds.join("-"), siteid: siteid, sitetype: sitetype } : null;
        }

        function SetThridAdPv(adList) {
            Common.ArrayForeach(adList, function (t) {
                if (!Common.StringIsNullOrEmpty(t.onloadTrackUrl3rd)) {
                    var img = new Image();
                    img.src = Common.AddUrlRandom(t.onloadTrackUrl3rd);
                }
            });
        }
    }

    //设置保底图片
    function SetBackupImage() {
        var $this = this;
        HtmlTag.SetHtml(this.TagObject, "");

        this.DataList.length == 0 && parseInt(this.ConfigData.type) == 1 && HtmlTag.SetHide(this.TagObject);
        if (Common.IsObject(this.ConfigData.BackData) && !this.IsLoadComplete) {
            this.BackupImageId = Common.CreateGuid();
            var src= this.ConfigData.BackData.src;
            var img = new Image();
            img.src = src;
            img.onload = function () {
                LoadBackHtml.call($this, img.width, img.height);
            };
        }

        function LoadBackHtml(width, height) {
            if (!this.IsLoadComplete) {
                var src = this.ConfigData.BackData.src;
                var link = this.ConfigData.BackData.link;
                var html = Common.StringFormat("<a href=\"{0}\" id=\"{1}\" target=\"_blank\">", [link, this.BackupImageId]);
                html += Common.StringFormat("<img src=\"{0}\" width=\"{1}\" height=\"{2}\"/></a>", [src, width, height]);
                HtmlTag.AppendHtml(this.TagObject, html);
                HtmlTag.SetShow(this.TagObject);
            }
        }
    }

    //请求动态广告
    function RequestDyAd() {
        var url = this.DyRequestUrl;
        if(window.location.protocol == 'https:'){
            url=url.replace(/http/,'https');
        }
        if (!Common.StringIsNullOrEmpty(url)) {
            var $this=this;
            url += "?v2=true&biztype=" + this.BizType + "&pageid=" + this.ConfigData.pagecode +"&callback=G_Ad_DyLoad_"+this.ConfigData.pagecode+ ".DyLoad&_rm=" + Math.random();
            Common.LoadJs(url,function(){  
                var dyobj=window['G_Ad_DyLoad_'+$this.ConfigData.pagecode];
                if(!dyobj.executed)dyobj.DyLoad();
            });
        }
    }
}

	
	//广告6_AdBusiness类
function AdBusiness() {
    this.PageId = "";
    this.AdSliderList = [];
    this.AdConfig = {};
    this.DyAdUrl = "";
    this.AdStyleType = 0;
    this.BackAdList = [];
    this.AdDataList = [];
    this.BizType = "";
    this.DyRequestUrl = "";
    this.PcadstyleID=Common.CreateGuid();//pcadStyle
    this.BidTagIDs=[];
	var $this = this;
    //广告加载
    this.Load = function (config) {
        try {
            
            if (!Common.IsObject(config)) {
                return;
            }

            this.AdConfig = config;
            this.PageId = HtmlTag.GetValue("page_id");
            this.BackAdList = this.AdConfig.backadlist || [];
            this.AdStyleType = this.AdConfig.adstyletype || 1;
            this.AdDataList = this.AdConfig.addatalist || [];
            this.BizType = this.AdConfig.adbiztype || "";
            this.DyRequestUrl = this.AdConfig.addyrequesturl || "";

            //加载样式
            if (!Common.StringIsNullOrEmpty(this.AdConfig.adstyle)) {
                HtmlTag.GetById(this.PcadstyleID) == null && Common.LoadCss(this.PcadstyleID, this.AdConfig.adstyle);
            }

            Common.ArrayForeach(this.AdDataList, function (item) {
                if ($this.AdConfig[item.domID] == undefined) {
                    $this.AdConfig[item.domID] = [];
                }
                InitSlider.call($this, item);
				window["G_Ad_DyLoad_"+item.pagecode]=$this;
            });
        }
        catch (ex) {
        }
        return this;
    };

    function InitSlider(item) {
        var datalistNormal=[];
        var dataListBid=[];
        Common.ArrayForeach(this.AdConfig[item.domID], function (item) {
            if(item.adtype&&item.adtype>=100){
                dataListBid.push(item);
            }else{
                datalistNormal.push(item);
            }
        });
        if(dataListBid.length>0){
            this.BidTagIDs.push(item.domID);
        }
        this.AdSliderList.push(new AdSlider().Load({
            DataList: datalistNormal,
            PageId: this.PageId,
            BizType: this.BizType,
            DyRequestUrl: this.DyRequestUrl,
            TagId: item.domID,
            AdStyleType: this.AdStyleType,
            ConfigData: GetConfigData.call(this, item),
            BidDataList:dataListBid
        }));
    }

    //动态广告加载
    this.DyLoad= function (data) {
        try {       
            this.executed=true;     
            var bidtagids=$this.BidTagIDs;
            if (!Common.IsObject(data)) {
                Common.ArrayForeach($this.AdSliderList, function (item) {
                    for (tagId in bidtagids){
                        if (item.TagId == bidtagids[tagId]) {
                            item.DyLoad({});
                            break;
                        }
                    }
                });
                return;
            }    
            var adSlider = null;
            Common.ArrayForeach($this.AdDataList,function(item){
                    if(item.pagecode==data.PageCode){
                        data.TagId=item.domID;
                    }
            });
            Common.ArrayForeach($this.AdSliderList, function (item) {
                if (item.TagId == data.TagId) {
                    adSlider = item;
                    return false;
                }
            });
            if (adSlider != null) {
                adSlider.DyLoad(data);
            }
        }
        catch (ex) {
        }
    };

    function GetConfigData(data) {
        Common.ArrayForeach(this.BackAdList, function (item) {
            if (item.pagecode == data.pagecode) {
                data.BackData = item;
                return false;
            }
        });
        return data
    }
    }

    AdBusiness.Init = function (config) {
        config.OnlineAdBusiness = new AdBusiness().Load(config);
    };
    var OnlineAdBusiness = AdBusiness;
	G_OnlineAdContentConfig.backadlist = typeof (ads_mkt_globalbakAdList) != "undefined" ? ads_mkt_globalbakAdList : [];
	OnlineAdBusiness.Init(G_OnlineAdContentConfig);
})();


