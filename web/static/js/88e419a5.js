/**
 * Created by Administrator on 2018/2/9.
 */
/* * 1. Description : ctrip index page: SSH Search Box v2 * 2. Created Date : 2015-08-19 Created User Name : [ Chenxg ] * 3. Modified Date : 2016-04-11 Modified User Name : [ Chenxg ] */ /** * CHANGE LOGS * - 2015-08-19 Chenxg: * - 1. 添加海外酒店 * - 2. resetValue TODO * * - 2015-08-31 Chenxg: * - 1. 大首页dropMenu位置js手动添加到body根目录 * * - 2015-09-07 Chenxg: * - 1. 关键词（地址）选择器数据源接口改用景酒的 * * - 2015-09-08 Chenxg: * - 1. 去除目的地选择器筛选结果中非城市的选项 * * - 2015-09-09 Chenxg: * - 1. 默认目的地数据请求需要跨域，改用jsonp * * - 2015-09-10 Chenxg: * - 1. 清理冗余的废代码 * - 2. 修正关键词选择器模板报错 * * - 2015-11-25 Chenxg: * - 1. CR2418 海外目的地选择器城市数据临时由景酒提供 * * - 2015-12-09 Chenxg: * - 1. 修正之前代码环境判断导致的跳转错误 * * - 2015-12-15 Chenxg: * - 1. 修正埋点错误 * * - 2016-04-11 Chenxg: * - 1. 海外目的地选择器数据接口更改 * - 2. 去除海外目的地选择器suggestion层的输入提示 */ ;(function(w, d, $) { w.SSHMod = {}; /* 当前的发布环境 */ var solution = document.getElementById('solution') && document.getElementById('solution').value; /* 地址筛选区域是否为国内 */ var IsDomestic = true; /* 页面初始化flag */ var isPageInit = true; /* 酒店fat接口不稳定，这里一律采用线上接口 */ var ENV = "//hotels.ctrip.com"; var SSH = "//taocan.ctrip.com"; /* PRO: 生产, UAT_NT：UAT, FAT: 测试 */ if (/^FAT/i.test(solution)) { SSH = "//taocan.fat64.qa.nt.ctripcorp.com"; } else if (/^UAT_NT/i.test(solution)) { SSH = "//taocan.ctrip.uat.qa.nt.ctripcorp.com"; } var $isPad = /pad/.test(navigator.userAgent.toLowerCase()); var CURRENTCITY = {id: '', py: '', cityName: '', isIntl: true, url: '', isAddressSelected: false, keyName: '', itemId: ''}; var CITYENTER = true; /* 大首页已有PluginsVersion的定义，此处方便调试 */ if (typeof PluginsVersion === "undefined") { var PluginsVersion = { "address": "1.0", "calendar": "6.0", "notice": "1.0", "validate": "1.1" }; } /* 跨城市的景区 */ var ScenicData = { "D10264_21001": { "pic": "//pic.c-ctrip.com/hotels_seo/scenic_bs.jpg", "top": 76, "left": 250, "name": "坝上，克什克腾旗" }, "D10072_7840": { "pic": "//pic.c-ctrip.com/hotels_seo/scenic_bs.jpg", "top": 192, "left": 155, "name": "坝上，沽源" }, "D10072_20914": { "pic": "//pic.c-ctrip.com/hotels_seo/scenic_bs.jpg", "top": 145, "left": 260, "name": "坝上，围场" }, "D10072_1474": { "pic": "//pic.c-ctrip.com/hotels_seo/scenic_bs.jpg", "top": 235, "left": 248, "name": "坝上，丰宁" }, "D10072_21790": { "pic": "//pic.c-ctrip.com/hotels_seo/scenic_bs.jpg", "top": 215, "left": 78, "name": "坝上，张北" }, "91": { "pic": "//pic.c-ctrip.com/hotels_seo/scenic_jzg.jpg", "top": 64, "left": 267, "name": "九寨沟，阿坝" }, "D25_1372": { "pic": "//pic.c-ctrip.com/hotels_seo/scenic_jzg.jpg", "top": 154, "left": 241, "name": "九寨沟，松潘" }, "D105_37": { "pic": "//pic.c-ctrip.com/hotels_seo/scenic_hgh.jpg", "top": 156, "left": 92, "name": "泸沽湖，丽江" }, "D10322_21433": { "pic": "//pic.c-ctrip.com/hotels_seo/scenic_ms.jpg", "top": 162, "left": 137, "name": "莽山，宜章" }, "D10322_612": { "pic": "//pic.c-ctrip.com/hotels_seo/scenic_ms.jpg", "top": 205, "left": 139, "name": "莽山，郴州" }, "D281_7807": { "pic": "//pic.c-ctrip.com/hotels_seo/scenic_qhh.jpg", "top": 74, "left": 204, "name": "青海湖，海北" }, "D281_7752": { "pic": "//pic.c-ctrip.com/hotels_seo/scenic_qhh.jpg", "top": 162, "left": 326, "name": "青海湖，海东" }, "D281_7794": { "pic": "//pic.c-ctrip.com/hotels_seo/scenic_qhh.jpg", "top": 234, "left": 115, "name": "青海湖，海南" }, "D10215_3886": { "pic": "//pic.c-ctrip.com/hotels_seo/scenic_cbs.jpg", "top": 118, "left": 238, "name": "长白山池西，白山" }, "D10216_1466": { "pic": "//pic.c-ctrip.com/hotels_seo/scenic_cbs.jpg", "top": 174, "left": 214, "name": "长白山池北，安图" }, "D2603_13": { "pic": "//pic.c-ctrip.com/hotels_seo/scenic_th.jpg", "top": 98, "left": 155, "name": "太湖，无锡" }, "D2603_14": { "pic": "//pic.c-ctrip.com/hotels_seo/scenic_th.jpg", "top": 158, "left": 181, "name": "太湖，苏州" } }; /* 国外地址选择器配置 */ SSHMod.langConf = { taiwan: '台湾', search_history: '搜索历史', hot_airport: '热门机场', city_sourceResult: '支持中文/英文/拼音输入', keyword_sourceResult: '支持中文/英文输入', filterResult: '${val},若需缩小范围，请输入更多条件。', noFilterResult: '找不到：${val}', city: '城市', airport: '机场', city_placeholder: '城市/机场/地标/酒店', city_placeholder_domestic: '中文/拼音', hotel: '酒店', name: '酒店', landmark: '地标', weizhi: '位置', keyword_placeholder: '酒店名称、景点名称、主题、人群…', IntTitle: '国际城市', Title: '国内城市', Location: '行政区', District: '景区', Station: '机场/车站', zone: '商圈', busArea: '商圈', notice: { city: "目的地不能为空", checkIn: '请选择入住日期', noExistCity: '目的地{city}不存在', dateErr: '日期格式为yyyy-mm-dd', too_early_in: '入住日期不能早于今天' }, buttonText: { defaults: '搜索酒店+景点套餐', loading: '搜索中...' }, url: { getDefaultData: SSH + "/sh/Ajax/AjaxGetSearchDestCity.aspx?isJsonp=1&callback=getDestCity", getDays: SSH + '/SH/Ajax/HomePage/AjaxGetDaysByCityId.aspx?cityId=${id}&callback=getDays', getOverseasCities: SSH + "/sh/Ajax/AjaxGetOverSeasCitys.aspx?jsoncallback=getOverseasCities" } }; // CR2418 海外数据应需求暂时用临时的少量数据填充，未来可能改回 w.overseasDesData = null; // CR2418 读取目的地选择器海外城市数据 getDefaultData(SSHMod.langConf.url.getOverseasCities, function() {}); /* 地址选择器参数配置 */ var SSH_Address_Config = { citySource: ENV + '/international/Tool/citySource_J.aspx?charset=utf-8', cityFilter: ENV + '/international/Tool/cityFilter_J.ashx?IsUseNewStyle=T&keyword=${key}', //keywordSource: ENV + '/international/Tool/keywordSource.aspx?cityId=${id}', //keywordSourceDomestic: ENV + '/international/Tool/keywordSourceDomestic.ashx?cityid=${id}', //keywordFilter: ENV + '/international/Tool/keywordFilter_new.aspx?cityId=${id}&keyword=${key}', //keywordFilterDomestic: ENV + '/international/Tool/keywordFilterDomestic.ashx?cityId=${id}&keyword=${key}', // 调用景酒的关键词筛选接口 keywordFilter: SSH + "/SH/Ajax/Common/AjaxGetKeywordsIndex.aspx?cityid=${id}&key=${key}", suggestion: '\ {{if (data.cities = overseasDesData)}}{{/if}}\
    \ ×\ {{if (searchDomestic && searchDomestic == "T") }}\
    \
{{tmpl SSHMod.langConf.IntTitle}}

\ {{/if}}\
    \ {{enum(key) data.cities}}
    ${key}{{/enum}}\
    \ {{enum(key,arr) data.cities}}\
    \ {{each arr}} 8)}} title="${display}"{{/if}}>${display}{{/each}}\
\ {{/enum}}\ {{if (searchDomestic && searchDomestic == "T") }}\
\ {{/if}}\ \ \ {{if (searchDomestic && searchDomestic == "T") }}\
\
{{tmpl SSHMod.langConf.Title}}

\
\ {{enum(key) data.domesticCitys}}
${key}{{/enum}}\
\ {{enum(key,arr) data.domesticCitys}}\
\ {{each arr}} 8)}} title="${display}"{{/if}}>${display}{{/each}}\
\ {{/enum}}\
\ {{/if}}\
', suggestionIpad: '\
\ ×\
显示键盘
\ {{if (d = $data.data)}}{{/if}}\ {{if (d.history.length)}}\
{{tmpl SSHMod.langConf.search_history}}

\
\ {{each(index, item) d.history}}${item.display}{{/each}}\
\ {{/if}}\
\ {{enum(key) d.cities}}
${key}{{/enum}}\
\ {{enum(key,arr) d.cities}}\
\ {{each(index, item) arr}}${item.display}{{/each}}\
\ {{/enum}}\ {{if (d.airport.length)}}\
${SSHMod.langConf.hot_airport}

\
\ {{each(index, item) d.airport}}${item.display}{{/each}}\
\ {{/if}}\
', suggestionStyle: '\ .city_select_lhsl { position:relative; width:378px; padding:6px 10px 10px; border:1px solid #999; background-color:#fff; } \ .city_select_lhsl .search_history_title{ margin-bottom:2px; font-weight:bold; } \ .city_select_lhsl .close { float:right; margin-right: -5px; width:20px; height:20px; color:#666; text-align:center; font:bold 16px/20px Simsun; } \ .city_select_lhsl .close:hover { text-decoration:none; color:#FFA800; } \ .city_select_lhsl .ico_key,\ .city_select_lhsl .ico_unkey { display:none; } \ .city_select_lhsl .title { color:#999; margin-bottom: 10px;} \ .city_select_lhsl .tab_box { width:100%; height:22px; margin-bottom:6px; border-bottom:2px solid #ccc; } \ .city_select_lhsl .tab_box li { position:relative; float:left; display:inline; margin-right:10px; line-height:22px; cursor:pointer; } \ .city_select_lhsl .tab_box li b { display:none; } \ .city_select_lhsl .tab_box li span { padding:0 3px; } \ .city_select_lhsl .tab_box li span:hover,.city_select_lhsl .tab_box .li_hover{ color: #06c;} \ .city_select_lhsl .tab_box .selected { border-bottom:2px solid #06c; margin-bottom:-2px; font-weight:bold; color:#06c; } \ .city_select_lhsl .tab_box .selected b { display: none; position:absolute; top:23px; left:50%; display:block; width:0; height:0; margin-left:-5px; overflow:hidden; font-size:0; line-height:0; border-color:#06c transparent transparent transparent; border-style: solid dashed dashed dashed; border-width:5px; } \ .city_select_lhsl .search_history_box{ display:inline-block; margin-bottom: 10px;} \ .city_select_lhsl .search_history_box,.city_select_lhsl .city_item {display:block;overflow:hidden;*zoom:1;} \ .city_select_lhsl .search_history_box a,.city_select_lhsl .city_item a { float:left; width:54px; height:24px; padding-left:5px; border:1px solid #fff; overflow:hidden; text-overflow:ellipsis; line-height:24px; color: #333; white-space: nowrap;} \ .city_select_lhsl .search_history_box a:hover,.city_select_lhsl .city_item a:hover{ text-decoration: none; color: #fff; background: #2577e3;} \ .city_select_lhsl .hot_airport_title{ font-weight: bold; margin-bottom: 8px; clear:both;} \ .city_select_lhsl .airport_item{ overflow: hidden;} \ .city_select_lhsl .airport_item a{ float:left; width:100px; height:24px; margin-right: 20px; border:1px solid #fff; overflow:hidden; white-space:nowrap; text-overflow:ellipsis; line-height:24px; color: #333;} \ .city_select_lhsl .airport_item a:hover{ text-decoration: none; color: #fff; background: #2577e3;} \ .city_select_pad { padding-top:5px; } \ .city_select_pad .title { margin:0 0 0 30px; } \ .city_select_pad .ico_key,\ .city_select_pad .ico_unkey { position:absolute; top:1px; left:1px; display:block; width:39px; height:25px; background:url(//pic.c-ctrip.com/ctripOnPad/un_key.png) no-repeat; -webkit-transform:scale(.7); } \ .city_select_pad .ico_unkey { background-position:0 -28px; } \ .city_select_pad .close,\ .city_select_pad .close:hover { font-family:helvetica,Simsun; color:#666; } \ .city_group_header{background-color:#eeeeef; padding:0 10px; margin:0 -10px; border-top:1px solid #e1e1e1;border-bottom:1px solid #e1e1e1; line-height:21px; font-weight:bolder; cursor:pointer;} \ .ico_arrow{width:0; height:0; border-width:0 5px 5px; border-style:dashed dashed solid; border-color:transparent transparent #9a9a9a; position:absolute; right:10px; vertical-align:middle; margin-top:8px; overflow:hidden;} \ .city_select_lhsl .tab_box .selected b{display:none;} \ .city_group{background-color:#fbfbfb; margin:0 -10px; padding:0 10px; overflow:hidden; *zoom:1;} \ .city_group .city_item a{border-color:#fbfbfb;} \ .tab_box{margin-top:10px;} \ .city_group{border-top:2px solid #d1d9de;} \ .city_group .ico_arrow{border-width:5px 5px 0; border-style:solid dashed dashed; border-color:#9a9a9a transparent transparent;} \ .sta_unfold .tab_box,.sta_unfold .city_item{display:none;} \ .sta_unfold .ico_arrow{border-style:dashed dashed solid; border-color:transparent transparent #9a9a9a; border-width:0 5px 5px; } \ .sta_unfold{border-top-width:1px;} \ .city_select_lhsl .hot_airport_title{margin-top:10px; clear:both;} \ .city_select_lhsl .city_item a{white-space: nowrap;} \ .city_suggestion_pop .item_list_areaadmin .sug_category{background-position: right -404px;}\ .city_suggestion_pop .item_list_areaadmin .hover .sug_category{background-position: right -441px;}\ .city_suggestion_pop .item_list_areaadmin a:hover .sug_category{background-position: right -441px;}\ .city_suggestion_pop .item_list_areaadmin a:hover .sug_category{background-position: right -441px;}\ .city_suggestion_pop .item_list_business .sug_category{background-position: right -551px;}\ .city_suggestion_pop .item_list_business .hover .sug_category{background-position: right -590px;}\ .city_suggestion_pop .item_list_business a:hover .sug_category{background-position: right -590px;}\ ', suggestionStyleIpad: '\ .city_select_lhsl { position:relative; width:520px; padding:10px; border:1px solid #999; background-color:#fff; }\ .city_select_lhsl .search_history_title{ margin-bottom:2px; font-weight:bold; font-size:16px;}\ .city_select_lhsl .close { float:right; width:30px; height:30px; color:#666; text-align:center; font:bold 22px/30px "Heiti SC","Heiti SC light",STHeiti,STXihei,sans-serif;}\ .city_select_lhsl .title {display:none;}\ .city_select_lhsl .tab_box { width:100%; height:30px; margin-bottom:6px; border-bottom:2px solid #ccc; } \ .city_select_lhsl .tab_box li { position:relative; float:left; display:inline; margin-right:10px; line-height:30px; cursor:pointer; }\ .city_select_lhsl .tab_box li b { display:none; }\ .city_select_lhsl .tab_box li span { padding:0 8px; }\ .city_select_lhsl .tab_box .selected { border-bottom:2px solid #06c; margin-bottom:-2px; font-weight:bold; color:#06c; }\ .city_select_lhsl .tab_box .selected b { display: none; position:absolute; top:23px; left:50%; display:block; width:0; height:0; margin-left:-5px; overflow:hidden; font-size:0; line-height:0; border-color:#06c transparent transparent transparent; border-style: solid dashed dashed dashed; border-width:5px; }\ .city_select_lhsl .city_item,.city_select_lhsl .search_history_box {display:block;overflow:hidden;*zoom:1;}\ .city_select_lhsl .city_item a,.city_select_lhsl .search_history_box a { float:left; width:75px; height:30px; padding-left:5px; overflow:hidden; text-overflow:ellipsis; line-height:30px; color: #333; text-decoration:none; margin: 0 6px 10px 0;}\ .city_select_lhsl .hot_airport_title{ font-weight: bold; margin-bottom: 8px; clear:both;}\ .city_select_lhsl .airport_item{ overflow: hidden;}\ .city_select_lhsl .airport_item a{ float:left; width:150px; height:30px; margin:0 20px 10px 0; border:1px solid #fff; overflow:hidden; white-space:nowrap; text-overflow:ellipsis; line-height:30px; color: #333; text-decoration:none;}\ .city_group_header{background-color:#eeeeef; padding:0 10px; margin:0 -10px; border-top:1px solid #e1e1e1;border-bottom:1px solid #e1e1e1; line-height:30px; font-weight:bolder; cursor:pointer;}\ .ico_arrow{width:0; height:0; border-width:0 5px 5px; border-style:dashed dashed solid; border-color:transparent transparent #9a9a9a; position:absolute; right:20px; vertical-align:middle; margin-top:14px; overflow:hidden;}\ .city_select_lhsl .tab_box .selected b{display:none;}\ .city_group{background-color:#fbfbfb; margin:0 -10px; padding:0 10px; overflow:hidden; *zoom:1;}\ .city_group .city_item a{border-color:#fbfbfb;}\ .tab_box{margin-top:10px;}\ .city_group{border-top:2px solid #d1d9de;}\ .city_group .ico_arrow{border-width:5px 5px 0; border-style:solid dashed dashed; border-color:#9a9a9a transparent transparent;}\ .sta_unfold .tab_box,.sta_unfold .city_item{display:none;}\ .sta_unfold .ico_arrow{border-style:dashed dashed solid; border-color:transparent transparent #9a9a9a; border-width:0 5px 5px; }\ .sta_unfold{border-top-width:1px;}\ .city_select_lhsl .hot_airport_title{margin-top:10px; clear:both;}\ .city_select_lhsl .city_item a{white-space: nowrap;}\ .key_word_key{height:48px; display:block;}\ .ico_key, .ico_unkey{width:92px;height:43px;padding-left:65px;background:url(//pic.c-ctrip.com/ctripOnPad/un_key20131012.png) 10px 11px no-repeat;cursor:pointer;line-height:40px;font-size:18px;border-width:1px;border-style:solid;border-radius:3px;}\ .ico_key{border-color:#f0f0f0 #cfcfcf #707070;box-shadow:0 1px 0 #cfcfcf,1px 0 0 0 #f0f0f0 inset,-1px 0 0 0 #f0f0f0 inset,0 -1px 0 0 #f0f0f0 inset;}\ .ico_unkey{border-color:#898989 #e2e2e2 #e2e2e2;background-color:#f5f5f5;box-shadow:0 -1px 0 #e2e2e2,0 1px 0 #d1d1d1 inset;}\ .city_select_lhsl .history_item, .city_select_lhsl .city_item { display:inline-block; margin-bottom: 10px; }\ .city_select_lhsl .history_item, .city_select_lhsl .city_item { display:block; overflow:hidden; *zoom:1;}\ .city_select_lhsl .history_item a, .city_select_lhsl .city_item a { float:left; width:54px; height:24px; padding-left:5px; border:1px solid #fff; overflow:hidden; white-space:nowrap; text-overflow:ellipsis; line-height:24px; color: #333; }\ .city_select_lhsl .history_item a:hover, .city_select_lhsl .city_item a:hover { text-decoration: none; color: #fff; background: #2577e3;}\ ', filter: '\ {{if (SSHMod.tmplFn.sentBFI())}}{{/if}}\ {{if hasResult}}\
\
\ ×\ {{tmpl SSHMod.langConf.filterResult}}\

\ {{if (group=SSHMod.tmplFn.groupList(list))}}{{/if}}\ {{if (city = group.city).length}}\
\ {{each (i, item) city}}\ \ {{if (i==0)}}
    ${SSHMod.langConf.city}
    {{/if}}\ \ {{tmpl SSHMod.tmplFn.HighLightAddressResult(right, val)}}\ ({{tmpl SSHMod.tmplFn.HighLightAddressResult(left, val)}})\ \ \ \ {{/each}}\
\ {{/if}}\ \ {{if (_landmark = group.landmark).length == -1}}\
\ {{each (i, item) _landmark}}\ \ {{if (i==0)}}
    {{tmpl SSHMod.langConf.landmark}}
    {{/if}}\ {{if (left!="")}}\ \ {{else}}\ \ {{/if}}\ {{tmpl SSHMod.tmplFn.HighLightAddressResult(right, val)}}\ {{if (left!="")}}({{tmpl SSHMod.tmplFn.HighLightAddressResult(left, val)}}){{/if}}\ \ \ \ {{/each}}\
\ {{/if}}\ \ {{if (_zone = group.zone).length == -1}}\
\ {{each (i, item) _zone}}\ \ {{if (i==0)}}
    {{tmpl SSHMod.langConf.zone}}
    {{/if}}\ \ {{tmpl SSHMod.tmplFn.HighLightAddressResult(right, val)}}\ ({{tmpl SSHMod.tmplFn.HighLightAddressResult(left, val)}})\ \ \ \ {{/each}}\
\ {{/if}}\ \ {{if (airport = group.airport).length == -1}}\
\ {{each (i, item) airport}}\ \ {{if (i==0)}}
    {{tmpl SSHMod.langConf.airport}}
    {{/if}}\ \ {{tmpl SSHMod.tmplFn.HighLightAddressResult(right, val)}}\ ({{tmpl SSHMod.tmplFn.HighLightAddressResult(left, val)}})\ \ \ \ {{/each}}\
\ {{/if}}\ \ {{if (_location = group.location).length == -1}}\
\ {{each (i, item) _location}}\ \ {{if (i==0)}}
    {{tmpl SSHMod.langConf.Location}}
    {{/if}}\ \ {{tmpl SSHMod.tmplFn.HighLightAddressResult(right, val)}}\ \ \ \ {{/each}}\
\ {{/if}}\ \ {{if (district = group.district).length == -1}}\
\ {{each (i, item) district}}\ \ {{if (i==0)}}
    {{tmpl SSHMod.langConf.District}}
    {{/if}}\ \ {{tmpl SSHMod.tmplFn.HighLightAddressResult(right, val)}}\ \ \ \ {{/each}}\
\ {{/if}}\ \ {{if (hotel = group.hotel).length == -1}}\
\ {{each (i, item) hotel}}\ \ {{if (i==0)}}
    {{tmpl SSHMod.langConf.hotel}}
    {{/if}}\ \ {{tmpl SSHMod.tmplFn.HighLightAddressResult(right, val)}}\ ({{tmpl SSHMod.tmplFn.HighLightAddressResult(left, val)}})\ \ \ {{/each}}\
\ {{/if}}\
\ {{else}}\
\
\ ×{{tmpl SSHMod.langConf.noFilterResult}}\

\
\ {{/if}}', filterIpad: '\ {{if(SSHMod.tmplFn.sentBFI())}}{{/if}}\ {{if $data.hasResult}}\ {{if (group=SSHMod.tmplFn.groupList($data.list), v=$data.val)}}{{/if}}\
\
\ ×\ ${v},若需缩小范围，请输入更多条件。\

\ {{if (city = group.city || []).length}}\
\ {{each (i, item) city}}\ \ {{if (i==0)}}
    城市
    {{/if}}\ \ {{tmpl SSHMod.tmplFn.HighLightAddressResult(item.right, v)}}\ ({{tmpl SSHMod.tmplFn.HighLightAddressResult(item.left, v)}})\ \ \ \ {{/each}}\
\ {{/if}}\ \ {{if (_landmark = group.landmark || []).length == -1}}\
\ {{each (i, item) _landmark}}\ \ {{if (i==0)}}
    地标
    {{/if}}\ \ {{tmpl SSHMod.tmplFn.HighLightAddressResult(item.right, v)}}\ ({{tmpl SSHMod.tmplFn.HighLightAddressResult(item.left, v)}})\ \ \ \ {{/each}}\
\ {{/if}}\ \ {{if (_zone = group.zone || []).length == -1}}\
\ {{each (i, item) _zone}}\ \ {{if (i==0)}}
    商圈
    {{/if}}\ \ {{tmpl SSHMod.tmplFn.HighLightAddressResult(item.right, v)}}\ ({{tmpl SSHMod.tmplFn.HighLightAddressResult(item.left, v)}})\ \ \ \ {{/each}}\
\ {{/if}}\ \ {{if (airport = group.airport || []).length == -1}}\
\ {{each (i, item) airport}}\ \ {{if (i==0)}}
    机场
    {{/if}}\ \ {{tmpl SSHMod.tmplFn.HighLightAddressResult(item.right, v)}}\ ({{tmpl SSHMod.tmplFn.HighLightAddressResult(item.left, v)}})\ \ \ \ {{/each}}\
\ {{/if}}\ \ {{if (_location = group.location || []).length == -1}}\
\ {{each (i, item) _location}}\ \ {{if (i==0)}}
    行政区
    {{/if}}\ \ {{tmpl SSHMod.tmplFn.HighLightAddressResult(item.right, v)}}\ \ \ \ {{/each}}\
\ {{/if}}\ \ {{if (district = group.district || []).length == -1}}\
\ {{each (i, item) district}}\ \ {{if (i==0)}}
    景区
    {{/if}}\ \ {{tmpl SSHMod.tmplFn.HighLightAddressResult(item.right, v)}}\ \ \ \ {{/each}}\
\ {{/if}}\ \ {{if (hotel = group.hotel || []).length == -1}}\
\ {{each (i, item) hotel}}\ \ {{if (i==0)}}
    酒店
    {{/if}}\ \ {{tmpl SSHMod.tmplFn.HighLightAddressResult(item.right, v)}}\ ({{tmpl SSHMod.tmplFn.HighLightAddressResult(item.left, v)}})\ \ \ {{/each}}\
\ {{/if}}\
\ {{else}}\
\
\ ×找不到：${v}\

\
\ {{/if}}', filterStyle: '\ .city_suggestion_pop { width:496px; border:1px solid #ccc; background-color:#fff; } \ .city_suggestion_pop .title { height:26px; margin:0 10px 4px; padding:0 2px; border-bottom:1px dotted #ccc; line-height:26px; color:#999; } \ .city_suggestion_pop .close { float:right; width:26px; height:26px; font:bold 14px/26px Simsun; color:#666; text-align:center; } \ .notfound_pop{ padding-bottom: 4px;} \ .notfound_pop .title{ line-height:26px; overflow: hidden; margin:0 10px 4px; padding:0 2px; color: #c01111; border-bottom: 0 none; word-break:break-all;} \ .notfound_pop .close{ margin-top: 2px;} \ .city_suggestion_pop .text_input { float:left; max-width:210px; _width:210px; overflow:hidden; white-space:nowrap; text-overflow:ellipsis; } \ .city_suggestion_pop .close:hover { text-decoration:none; color:#FFA800; } \ .city_suggestion_pop .sug_item{ overflow: hidden;} \ .city_suggestion_pop .sug_item a { display:block; overflow: hidden; padding-left:10px; color:#000; font-family:Tahoma; line-height:28px; cursor:pointer; *zoom:1;} \ .city_suggestion_pop .sug_item a:after{ clear:both; content:"."; display:block; height:0; overflow:hidden; } \ .city_suggestion_pop .sug_item .num { float:left; width: 80px; overflow: hidden; color:#999; text-align: right;} \ .city_suggestion_pop .sug_item .city { display:block; float: left; width:315px; max-height:56px; _height:28px; padding-right:4px; overflow:hidden; } \ .city_suggestion_pop .sug_item .en { color:#999; } \ .keywords_pop .sug_item .en { color:#333; } \ .city_suggestion_pop .sug_item b { font-weight:bold; color:#06c; } \ .city_suggestion_pop .sug_item a:hover, .city_suggestion_pop .sug_item .hover { background-color:#2577e3; color:#fff; text-decoration:none; } \ .city_suggestion_pop .sug_item a:hover span, .city_suggestion_pop .sug_item .hover span, .city_suggestion_pop .sug_item a:hover b, .city_suggestion_pop .sug_item .hover b { color:#fff; } \ .city_suggestion_pop .sug_category{ float: right; padding-left: 6px; width: 60px; height: 28px; line-height: 28px; background-image:url(//pic.c-ctrip.com/hotelinternational121211/ico_search_box_5.png); background-repeat: no-repeat;} \ .city_suggestion_pop .item_list_city, .city_suggestion_pop .item_list_hotel{ padding-bottom: 5px; border-bottom: 1px solid #ccc;} \ .city_suggestion_pop .sug_category_hover{ color: #fff; background-color: #2577e3; background-position: right 6px; background-color:#2577e3; } \ .city_suggestion_pop .item_list_airport, .city_suggestion_pop .item_list_landmarks{ padding: 4px 0 6px;} \ .city_suggestion_pop .item_list_city .sug_category{background-position: right -29px;} \ .city_suggestion_pop .item_list_city .hover .sug_category{background-position: right 6px;} \ .city_suggestion_pop .item_list_city a:hover .sug_category{background-position: right 6px;} \ .city_suggestion_pop .item_list_airport .sug_category{background-position: right -99px;} \ .city_suggestion_pop .item_list_airport .hover .sug_category{background-position: right -62px;} \ .city_suggestion_pop .item_list_airport a:hover .sug_category{background-position: right -62px;} \ .city_suggestion_pop .item_list_hotel .sug_category{background-position: right -165px;} \ .city_suggestion_pop .item_list_hotel .hover .sug_category{background-position: right -133px;} \ .city_suggestion_pop .item_list_hotel a:hover .sug_category{background-position: right -133px;} \ .city_suggestion_pop .item_list_landmarks .sug_category{background-position: right -198px;} \ .city_suggestion_pop .item_list_landmarks .hover .sug_category{background-position: right -232px;} \ .city_suggestion_pop .item_list_landmarks a:hover .sug_category{background-position: right -232px;} \ .city_suggestion_pop .item_list_scenic .sug_category{background-position: right -265px;} \ .city_suggestion_pop .item_list_scenic .hover .sug_category{background-position: right -297px;} \ .city_suggestion_pop .item_list_scenic a:hover .sug_category{background-position: right -297px;} \ .city_suggestion_pop .sug_item .city{width:290px;} \ .city_suggestion_pop .sug_category{width:55px; padding-right:20px; padding-left:0; text-align:right;}\ .city_suggestion_pop .sug_item a{padding-right:10px; line-height:1.5; padding-top:4px; padding-bottom:4px;} \ .city_suggestion_pop .sug_item{padding: 4px 0 4px; border-bottom:1px solid #ccc; margin-bottom:-1px;} \ .city_suggestion_pop .sug_item a.sug_item_header{line-height:28px; padding-top:0; padding-bottom:0; } \ .city_suggestion_pop .item_list_traffic .sug_category{background-position: right -330px; padding-right:40px;} \ .city_suggestion_pop .item_list_traffic .city{width:} \ .city_suggestion_pop .item_list_traffic .hover .sug_category{background-position: right -366px;padding-right: 40px;} \ .city_suggestion_pop .item_list_traffic a:hover .sug_category{background-position: right -366px;} \ .city_suggestion_pop .item_list_areaadmin .sug_category{background-position: right -404px;}\ .city_suggestion_pop .item_list_areaadmin .hover .sug_category{background-position: right -441px;}\ .city_suggestion_pop .item_list_areaadmin a:hover .sug_category{background-position: right -441px;}\ .city_suggestion_pop .item_list_business .sug_category{background-position: right -551px;}\ .city_suggestion_pop .item_list_business .hover .sug_category{background-position: right -590px;}\ .city_suggestion_pop .item_list_business a:hover .sug_category{background-position: right -590px;}\ .city_suggestion_pop .item_list_hotel .city {width:395px;}', // ===================== Domestic Config 页面HTML中已有这部分的模板，不过如果和重构后的代码集成，就得修改重写 ================== citySourceDomestic: ENV + '/Domestic/Tool/AjaxGetCitySuggestion.aspx', cityFilterDomestic: SSH + '/SH/Ajax/AjaxGobalCity.aspx?isctrip=1&inland=1&keyword=${key}', suggestionDomestic: '\ {{if (data = SSHMod.tmplFn.format(data))}}{{/if}}\
    \ ×\
支持中文/拼音/简拼输入

\
{{enum(key) data}}
        ${key}{{/enum}}
\ {{enum(key,objs) data}}\
    \ {{enum(k,arr) objs}}\ {{if (k)}}\
    \ ${k}\ {{else}}\
    \ {{/if}}\ {{each(index, item) arr}}${item.display}{{/each}}\
    \ {{/enum}}\
    \ {{/enum}}\
', suggestionIpadDomestic: '\ {{if (data = SSHMod.tmplFn.format($data.data))}}{{/if}}\
    \
    \ ×

    \
显示键盘
\
    \ {{enum(key) data}}\
        ${key}\ {{/enum}}\
    \ {{enum(key,objs) data}}\
    \ {{enum(k,arr) objs}}\ {{if (k)}}\
    \ ${k}\ {{else}}\
    \ {{/if}}\ {{each(index, item) arr}}${item.display}{{/each}}\
    \ {{/enum}}\
    \ {{/enum}}\
', suggestionStyleDomestic: '\ .city_select_lhsl{width:408px;padding:10px;border:1px solid #999;background-color:#fff;}\ .city_select_lhsl .close{float:right;width:20px;height:20px;color:#666;text-align:center;font:bold 16px/20px Simsun;}\ .city_select_lhsl .close:hover{text-decoration:none;color:#FFA800;}\ .city_select_lhsl .title{margin-bottom:10px;color:#999;}\ .city_select_lhsl .tab_box{width:100%;height:22px;margin-bottom:6px;margin-top:0;border-bottom:2px solid #ccc;}\ .city_select_lhsl .tab_box li{position:relative;float:left;display:inline;margin-right:2px;line-height:22px;cursor:pointer;}\ .city_select_lhsl .tab_box li b{display:none;}\ .city_select_lhsl .tab_box li span{padding:0 8px;}\ .city_select_lhsl .tab_box li span:hover,.city_select_lhsl .tab_box .li_hover{ color: #06c;} \ .city_select_lhsl .tab_box .selected{ border-bottom:2px solid #06c; margin-bottom:-2px; font-weight:bold; color:#06c; } \ .city_select_lhsl .tab_box .selected b{ display: none; position:absolute; top:23px; left:50%; display:block; width:0; height:0; margin-left:-5px; overflow:hidden; font-size:0; line-height:0; border-color:#06c transparent transparent transparent; border-style: solid dashed dashed dashed; border-width:5px; }\ .city_select_lhsl .city_item, .city_select_lhsl .search_history_box {display:inline-block;*zoom:1;overflow:hidden;}\ .city_select_lhsl .city_item{width:408px;}\ .city_select_lhsl .city_item a, .city_select_lhsl .search_history_box a {float:left;display:inline;width:52px;height:22px;margin:0 2px 2px 0;padding-left:8px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;line-height:22px;color:#333;}\ .city_select_lhsl .city_item a:hover,.city_select_lhsl .search_history_box a:hover{background-color:#2577E3;text-decoration:none;color:#fff;}\ .city_item .city_item_in{width:378px;padding-left:30px;*zoom:1;}\ .city_item .city_item_in:after,.city_select_lhsl .search_history_box:after{display:block;height:0;visibility:hidden;overflow:hidden;content:".";clear:both;}\ .city_item .city_item_letter{float:left;width:30px;height:22px;margin-left:-30px;line-height:22px;text-align:center;color:#E56700;}\ .city_select_lhsl .sarch_history_title{margin-bottom:2px;font-weight:bold;color:#06c;}\ .city_select_lhsl .search_history_box{margin-bottom:6px;}', suggestionStyleIpadDomestic: '\ .city_select_lhsl{position:relative;width:520px;padding:10px;border:1px solid #999;background-color:#fff;font-size:16px;}\ .key_word_key{height:48px;}\ .ico_key,.ico_unkey{width:92px;height:43px;padding-left:65px;background:url(//pic.c-ctrip.com/ctripOnPad/un_key20131012.png) 10px 11px no-repeat;cursor:pointer;line-height:40px;font-size:18px;border-width:1px;border-style:solid;border-radius:3px;}\ .ico_key{border-color:#f0f0f0 #cfcfcf #707070;box-shadow:0 1px 0 #cfcfcf,1px 0 0 0 #f0f0f0 inset,-1px 0 0 0 #f0f0f0 inset,0 -1px 0 0 #f0f0f0 inset;}\ .ico_unkey{border-color:#898989 #e2e2e2 #e2e2e2;background-color:#f5f5f5;box-shadow:0 -1px 0 #e2e2e2,0 1px 0 #d1d1d1 inset;}\ .city_select_lhsl .close{float:right;width:30px;height:30px;line-height:30px;text-align:center;color:#666;font:bold 22px/30px "Heiti SC","Heiti SC light",STHeiti,STXihei,sans-serif;}\ .city_select_lhsl .title{position:absolute;z-index:1;top:10px;right:10px;color:#999;}\ .city_select_lhsl .tab_box{height:30px;margin-bottom:10px;margin-top:0;border-bottom:2px solid #ccc;}\ .city_select_lhsl .tab_box li{position:relative;z-index:1;float:left;display:inline;margin-right:10px;line-height:30px;cursor:pointer;}\ .city_select_lhsl .tab_box li span{padding:0 8px;}\ .city_select_lhsl .tab_box .hot_selected{border-bottom:2px solid #06c;margin-bottom:-2px;font-weight:bold;color:#06c;}\ .city_select_lhsl .city_item{display:inline-block;width:520px;}\ .city_select_lhsl .city_item a,.city_select_lhsl .search_history_box a{float:left;display:inline;width:70px;height:30px;margin:0 2px 10px 0;padding-left:8px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;line-height:30px;color:#333;}\ .city_item .city_item_in{width:490px;padding-left:30px;min-height:40px;}\ .city_item .city_item_in:after{display:block;height:0;visibility:hidden;overflow:hidden;content:".";clear:both;}\ .city_item .city_item_letter{float:left;width:30px;height:30px;margin-left:-30px;line-height:30px;text-align:center;color:#E56700;}\ .city_select_lhsl .sarch_history_title{margin-bottom:10px;font-weight:bold;color:#06c;}\ .city_select_lhsl .search_history_box{margin-bottom:10px;}\ .city_select_lhsl .search_history_box:after{display:block;clear:both;visibility:hidden;overflow:hidden;height:0;content:".";}\ .city_select_lhsl .search_history_box a{margin-bottom:0;}', filterDomestic: '\ {{if $data.hasResult}}\
        \
        \ ×\ ${$data.val}，若需缩小范围，请输入更多条件。\

        \ {{if (obj = SSHMod.tmplFn.groupCityFilterData($data.list))}}{{/if}}\ {{if (city = obj.City || []).length}}\
        \ {{each (i,item) city}}\ \ {{if (i == 0)}}
            城市
            {{/if}}\ {{if (arr=item.data.split("|"))}}{{/if}}\ {{tmpl SSHMod.tmplFn.HighLightAddressResult(arr[1], $data.val)}}\ \ \ {{/each}}\
        \ {{/if}}\ {{if (district = obj.District || []).length == -1}}\
        \ {{each (i,item) district}}\ \ {{if (arr=item.data.split("|"))}}{{/if}}\ {{if (i == 0)}}
            景区
            {{/if}}\ {{tmpl SSHMod.tmplFn.HighLightAddressResult(arr[1], $data.val)}}\ \ \ {{/each}}\
        \ {{/if}}\ {{if (sight = obj.Sight || []).length == -1}}\
        \ {{each (i,item) sight}}\ \ {{if (i == 0)}}
            景点
            {{/if}}\ {{if (arr=item.data.split("|"))}}{{/if}}\ {{tmpl SSHMod.tmplFn.HighLightAddressResult(arr[5], $data.val)}}\ \ \ {{/each}}\
        \ {{/if}}\ {{if (loc = obj.Location || []).length == -1}}\
        \ {{each (i,item) loc}}\ \ {{if (i == 0)}}
            行政区
            {{/if}}\ {{if (arr=item.data.split("|"))}}{{/if}}\ {{tmpl SSHMod.tmplFn.HighLightAddressResult(arr[7] + arr[5], $data.val)}}\ \ \ {{/each}}\
        \ {{/if}}\ {{if (domesticZone = obj.DomesticZone || []).length == -1}}\
        \ {{each (i,item) domesticZone}}\ \ {{if (i == 0)}}
            商业区
            {{/if}}\ {{if (arr=item.data.split("|"))}}{{/if}}\ {{tmpl SSHMod.tmplFn.HighLightAddressResult(arr[7] + arr[5], $data.val)}}\ \ \ {{/each}}\
        \ {{/if}}\ {{if (airport = obj.Airport || []).length == -1}}\
        \ {{each (i,item) airport}}\ \ {{if (i == 0)}}
            机场
            {{/if}}\ {{if (arr=item.data.split("|"))}}{{/if}}\ {{tmpl SSHMod.tmplFn.HighLightAddressResult(arr[7] + arr[5], $data.val)}}\ \ \ {{/each}}\
        \ {{/if}}\ {{if (railwayStation = obj.RailwayStation || []).length == -1}}\
        \ {{each (i,item) railwayStation}}\ \ {{if (i == 0)}}
            火车站
            {{/if}}\ {{if (arr=item.data.split("|"))}}{{/if}}\ {{tmpl SSHMod.tmplFn.HighLightAddressResult(arr[7] + arr[5], $data.val)}}\ \ \ {{/each}}\
        \ {{/if}}\ {{if (Hotel = obj.Hotel || []).length == -1}}\
        \ {{each (i,item) Hotel}}\ \ {{if (i == 0)}}
            名称
            {{/if}}\ {{if (arr=item.data.split("|"))}}{{/if}}\ {{tmpl SSHMod.tmplFn.HighLightAddressResult(arr[7], $data.val)}}\ \ {{/each}}\
        \ {{/if}}\ {{if $data.page.max>0}}\
        \ {{if $data.page.current>0}}\ <-\ {{/if}}\ {{if $data.page.current<2}}\ {{loop(index) Math.min(5,$data.page.max+1)}}\ ${index+1}\ {{/loop}}\ {{else $data.page.current>$data.page.max-2}}\ {{loop(index) Math.max(0,$data.page.max-4),$data.page.max+1}}\ ${index+1}\ {{/loop}}\ {{else}}\ {{loop(index) Math.max(0,$data.page.current-2),Math.min($data.page.current+3,$data.page.max+1)}}\ ${index+1}\ {{/loop}}\ {{/if}}\ {{if $data.page.current<$data.page.max}}\ ->\ {{/if}}\
        \ {{/if}}\ {{if (scenicList = SSHMod.tmplFn.getScenic(district))}}{{/if}}\ {{if scenicList && scenicList.length}}\ \ {{each (i,item) scenicList}}\ {{if (i==0)}}{{/if}}\ \
        \ \
            ${item.name}
        \
        \ \ {{/each}}\ \ {{/if}}\
        \ {{else}}\
        \
        ×对不起，找不到：${$data.val}

        \
        \ {{/if}}', filterStyleDomestic: '\ .keyword_prompting_lhsl{width:398px; border:1px solid #999; background-color:#fff;}\ .keyword_prompting_lhsl .title{height:26px; margin:0 10px 4px; padding:0 2px; border-bottom:1px dotted #ccc; line-height:26px; color:#999;}\ .keyword_prompting_lhsl .close{float:right; width:26px; height:26px; font:bold 14px/26px Simsun; color:#666; text-align:center;}\ .keyword_prompting_lhsl .close:hover { text-decoration:none; color:#FFA800; }\ .keyword_prompting_lhsl .sug_item{padding-bottom: 5px; padding-top:5px; border-bottom: 1px solid #ccc; position:relative;*zoom:1;}\ .keyword_prompting_lhsl .sug_item a{display:block; overflow:hidden; padding:5px 7px 5px 10px; color:#333; line-height:18px; cursor:pointer;*zoom:1;}\ .keyword_prompting_lhsl .sug_item .hover { background-color:#2577e3; color:#fff; text-decoration:none;}\ .keyword_prompting_lhsl .sug_item .hover span, .keyword_prompting_lhsl .sug_item .hover b{color:#fff;}\ .notfound_pop{ padding-bottom: 4px;}\ .notfound_pop .title{ line-height:26px; overflow: hidden; margin:0 10px 4px; padding:0 2px; color: #c01111; border-bottom: 0 none;}\ .notfound_pop .close{ margin-top: 2px;}\ .keyword_prompting_lhsl .text_input { float:left; max-width:160px; _width:160px; overflow:hidden; white-space:nowrap; text-overflow:ellipsis; }\ .keyword_prompting_lhsl .sug_item a:after{ clear:both; content:"."; display:block; height:0; overflow:hidden; }\ .keyword_prompting_lhsl .sug_item .num { float:left; width:75px; overflow: hidden; color:#999; text-align: right;}\ .keyword_prompting_lhsl .sug_item .city { display:block; float: left; width:270px; padding-right:4px; overflow:hidden;}\ .city_suggestion_pop .sug_item .city {width:195px; height:18px; white-space:nowrap; text-overflow:ellipsis;}\ .keyword_prompting_lhsl .sug_item b{font-weight:bold; color:#06c; }\ .keyword_prompting_lhsl .sug_category{ float:right; height:18px; line-height:18px; background-image:url(//pic.c-ctrip.com/hotels121118/ico_search_box_2.png); background-repeat: no-repeat;width:62px; padding-right:20px; padding-left:0; text-align:right;}\ .keyword_prompting_lhsl .sug_category_hover{ color: #fff; background-color: #2577e3; background-position: right 6px; background-color:#2577e3; }\ .keyword_prompting_lhsl .item_list_city .sug_category{background-position: right -33px;}\ .keyword_prompting_lhsl .item_list_city .hover .sug_category{background-position: right 2px;}\ .keyword_prompting_lhsl .item_list_airport .sug_category{background-position: right -105px;}\ .keyword_prompting_lhsl .item_list_airport .hover .sug_category{background-position: right -67px;}\ .keyword_prompting_lhsl .item_list_hotel .sug_category{background-position: right -165px;}\ .keyword_prompting_lhsl .item_list_hotel .hover .sug_category{background-position: right -133px;}\ .keyword_prompting_lhsl .item_list_landmarks .sug_category{background-position: right -204px;}\ .keyword_prompting_lhsl .item_list_landmarks .hover .sug_category{background-position: right -238px;}\ .keyword_prompting_lhsl .item_list_scenic .sug_category{background-position: right -271px;}\ .keyword_prompting_lhsl .item_list_scenic .hover .sug_category{background-position: right -303px;}\ .keyword_prompting_lhsl .item_list_traffic .sug_category{background-position: right -336px; padding-right:40px;}\ .keyword_prompting_lhsl .item_list_traffic .hover .sug_category{background-position: right -372px;}\ .keyword_prompting_lhsl .item_list_areaadmin .sug_category{background-position: right -410px;}\ .keyword_prompting_lhsl .item_list_areaadmin .hover .sug_category{background-position: right -447px;}\ \ .keyword_prompting_lhsl .item_list_train .sug_category{background-position: right -482px;}\ .keyword_prompting_lhsl .item_list_train .hover .sug_category{background-position: right -518px;}\ \ .keyword_prompting_lhsl .item_list_business .sug_category{background-position: right -557px;}\ .keyword_prompting_lhsl .item_list_business .hover .sug_category{background-position: right -596px;}\ \ .keyword_prompting_lhsl .item_list_attractions .sug_category{background-position: right -635px;}\ .keyword_prompting_lhsl .item_list_attractions .hover .sug_category{background-position: right -674px;}\ \ .city_suggestion_pop .sug_item .num {float:left; width:80px; overflow:hidden; color:#999; text-align:right;}\ .city_suggestion_pop .city_scenic_pic{position:absolute; border:1px solid #999; display:none;}\ .city_suggestion_pop .city_scenic_pic img{display:block;}\ .city_suggestion_pop .scenic_mark{padding-left:21px;padding-top:1px;height:27px;overflow:hidden;cursor:default;white-space:nowrap; cursor:pointer;}\ .city_suggestion_pop .scenic_mark .scenic_map_num{position:absolute;top:0;left:0;width:21px;height:27px;z-index:3;background: url(//pic.c-ctrip.com/hotels_seo/scenic_mark.png) no-repeat;_background: url(//pic.c-ctrip.com/hotels_seo/scenic_mark_ie6.png) no-repeat;}\ .city_suggestion_pop .scenic_mark .scenic_map_num_hover{background: url(//pic.c-ctrip.com/hotels_seo/scenic_mark_hover.png) no-repeat;_background: url(//pic.c-ctrip.com/hotels_seo/scenic_mark_hover_ie6.png) no-repeat;}\ .city_suggestion_pop .scenic_mark_inner{background-color:#fff;height:22px;line-height:22px;padding:0 10px 0 15px;;border:1px solid #A1A19D;border-left:0 none; border-top:none; border-top-right-radius:13px;border-bottom-right-radius:13px;box-shadow:2px 2px 2px 0 #ccc;position:relative;z-index:2;left:-10px;_display:inline; *zoom:1; color:#0f66cd; font-size:12px;}\ .keyword_prompting_lhsl .c_page_mini a {display: inline-block; margin: 0;color: #06c;padding: 0 6px;font:14px/1.5 Tahoma, Arial, Simsun, sans-serif;text-decoration: underline;}\ .keyword_prompting_lhsl .c_page_mini .c_page_mini_current{ color: #666;text-decoration: none;cursor: default;}' }; /* 关键字选择器参数配置 */ var SSH_Keyword_Config = { suggestion: '\ {{if !cQuery.isEmptyObject(data)}}\ {{if (!IsDomestic)}}\
            \ ×\
{{tmpl SSHMod.langConf.keyword_sourceResult}}

\ {{enum(key,arr) data}}\
                ${key}

            \
            \ {{each arr}}\ 16)}} title="${display}"{{/if}}>${display}\ {{/each}}\
        \ {{/enum}}\
        \ {{else}}\
        \ ×\
支持中文/英文输入

\
        \
        \
        \ {{enum(key, item) data}}\ {{if key==="subCity"}}\
        \ ${item.cnname}：{{if (item.data)}}{{each item.data}}${name}{{/each}}{{/if}}\
        \ {{else}}\
            ${item.cnname}

        \
        \ {{if (item.data)}}\ {{each item.data}}\ ${name}\ {{/each}}\ {{/if}}\
        \ {{/if}}\ {{/enum}}\
        \ {{/if}}\ {{/if}}\ ', suggestionIpad: '\ {{if (d = $data.data)}}{{/if}}\
        \
        ×

        \
显示键盘
\ {{if !cQuery.isEmptyObject(d)}}\ {{enum(key,arr) d}}\
            ${key}

        \
        \ {{each(index, item) arr}}\ 16)}} title="${item.display}"{{/if}}>${item.display}\ {{/each}}\
    \ {{/enum}}\ {{/if}}\
    \ ', suggestionStyle: '\ .choice_classification{ padding: 6px 10px 10px; width:476px; border:1px solid #ccc; background-color:#fff;}\ .choice_classification .close{ float:right; margin-right: -5px; width:20px; height:20px; color:#666; text-align:center; font:bold 16px/20px Simsun; }\ .choice_classification .close:hover{ text-decoration:none; color:#FFA800; }\ .choice_classification .title{ color: #999; }\ .choice_classification .choice_item_title{ margin-top: 15px; font-weight: bold;}\ .choice_classification .choice_item_list{ *zoom:1;}\ .choice_classification .choice_item_list:after{ clear:both; content:"."; display:block; height:0; overflow:hidden; }\ .choice_classification .choice_item_list a{ float:left; width:134px; height:24px; margin-right: 20px; border:1px solid #fff; overflow:hidden; white-space:nowrap; text-overflow:ellipsis; line-height:24px; color: #333;}\ .choice_classification .choice_item_list a:hover{text-decoration: none; color: #fff; background: #2577e3;}\ ', suggestionStyleIpad: '\ .choice_classification{ padding: 6px 10px 10px; width:476px; border:1px solid #ccc; background-color:#fff;}\ .choice_classification .close{ float:right; margin-right: -5px; width:20px; height:20px; color:#666; text-align:center; font:bold 16px/20px Simsun; }\ .choice_classification .close:hover{ text-decoration:none; color:#FFA800; }\ .choice_classification .title{ color: #999; }\ .choice_classification .choice_item_title{ margin-top: 15px; font-weight: bold;}\ .choice_classification .choice_item_list{ *zoom:1;}\ .choice_classification .choice_item_list:after{ clear:both; content:"."; display:block; height:0; overflow:hidden; }\ .choice_classification .choice_item_list a{ float:left; width:134px; height:24px; margin-right: 20px; border:1px solid #fff; overflow:hidden; white-space:nowrap; text-overflow:ellipsis; line-height:24px; color: #333;}\ .choice_classification .choice_item_list a:hover{text-decoration: none; color: #fff; background: #2577e3;}\ .key_word_key{height:48px; display:block;}\ .ico_key, .ico_unkey{width:92px;height:43px;padding-left:65px;background:url(//pic.c-ctrip.com/ctripOnPad/un_key20131012.png) 10px 11px no-repeat;cursor:pointer;line-height:40px;font-size:18px;border-width:1px;border-style:solid;border-radius:3px;}\ .ico_key{border-color:#f0f0f0 #cfcfcf #707070;box-shadow:0 1px 0 #cfcfcf,1px 0 0 0 #f0f0f0 inset,-1px 0 0 0 #f0f0f0 inset,0 -1px 0 0 #f0f0f0 inset;}\ .ico_unkey{border-color:#898989 #e2e2e2 #e2e2e2;background-color:#f5f5f5;box-shadow:0 -1px 0 #e2e2e2,0 1px 0 #d1d1d1 inset;}\ ', filter: '\ {{if (SSHMod.tmplFn.sentBFI())}}{{/if}}\ {{if hasResult}}\
        \
        \ ×\ {{tmpl SSHMod.langConf.filterResult}}\

        \ {{if (group=SSHMod.tmplFn.groupKeywordList(list))}}{{/if}}\ {{if (hotel = group.hotel || []).length}}\
        \ {{each (i, item) hotel}}\ \ {{if (i==0)}}
            {{tmpl (IsDomestic?SSHMod.langConf.name:SSHMod.langConf.hotel)}}
            {{/if}}\ \ {{tmpl SSHMod.tmplFn.HighLightAddressResult(left, val)}}\ {{if (right !="" && !IsDomestic)}}\ ({{tmpl SSHMod.tmplFn.HighLightAddressResult(right, val)}})\ {{/if}}\ \ \ {{/each}}\
        \ {{/if}}\ \ {{if (station = group.station || []).length}}\
        \ {{each (i, item) station}}\ \ {{if (i==0)}}
            {{tmpl SSHMod.langConf.Station}}
            {{/if}}\ {{if (left != "") }}\ \ {{else}}\ \ {{/if}}\ {{tmpl SSHMod.tmplFn.HighLightAddressResult(right, val)}}\ {{if (left != "" && !IsDomestic)}}\ ({{tmpl SSHMod.tmplFn.HighLightAddressResult(left, val)}})\ {{/if}}\ \ {{if (data.split("|")[4] != "-1")}}{{tmpl data.split("|")[4]}}{{/if}}\ \ {{/each}}\
        \ {{/if}}\ \ {{if ((landmark = group.landmark || []).length || (airport = group.airport || []).length)}}\
        \ {{if (airport = group.airport || []).length}}\ {{each (i, item) airport}}\ \ {{if (i==0)}}
            {{tmpl (IsDomestic?SSHMod.langConf.weizhi:SSHMod.langConf.landmark)}}
            {{/if}}\ {{if (left != "")}}\ \ {{else}}\ \ {{/if}}\ {{tmpl SSHMod.tmplFn.HighLightAddressResult(right, val)}}\ {{if (left != "" && !IsDomestic)}}\ ({{tmpl SSHMod.tmplFn.HighLightAddressResult(left, val)}})\ {{/if}}\ \ {{if (data.split("|")[4] != "-1")}}{{tmpl data.split("|")[4]}}{{/if}}\ \ {{/each}}\ {{/if}}\ {{each (i, item) landmark}}\ \ {{if (i==0 && !airport.length)}}
            {{tmpl (IsDomestic?SSHMod.langConf.weizhi:SSHMod.langConf.landmark)}}
            {{/if}}\ {{if (left != "" && right!="")}}\ \ {{else}}\ {{if (left != "" && right=="")}}\ \ {{else}}\ \ {{/if}}\ {{/if}}\ {{tmpl SSHMod.tmplFn.HighLightAddressResult(right, val)}}\ {{if (left != "" && !IsDomestic)}}\ ({{tmpl SSHMod.tmplFn.HighLightAddressResult(left, val)}})\ {{/if}}\ \ {{if (data.split("|")[4] != "-1")}}{{tmpl data.split("|")[4]}}{{/if}}\ \ {{/each}}\
        \ {{/if}}\ \ {{if ((busArea = group.zone || []).length)}}\
        \ {{each (i, item) busArea}}\ \ {{if (i==0)}}
            {{tmpl (IsDomestic?SSHMod.langConf.weizhi:SSHMod.langConf.busArea)}}
            {{/if}}\ {{if (left != "" && right!="")}}\ \ {{else}}\ {{if (left != "" && right=="")}}\ \ {{else}}\ \ {{/if}}\ {{/if}}\ {{tmpl SSHMod.tmplFn.HighLightAddressResult(right, val)}}\ {{if (left != "" && !IsDomestic)}}\ ({{tmpl SSHMod.tmplFn.HighLightAddressResult(left, val)}})\ {{/if}}\ \ {{if (data.split("|")[4] != "-1")}}{{tmpl data.split("|")[4]}}{{/if}}\ \ {{/each}}\
        \ {{/if}}\
        \ {{else}}\
        \
        \ ×{{tmpl SSHMod.langConf.noFilterResult}}\

        \
        \ {{/if}}\
        \
        \ 为您展示更多城市下和{{tmpl SSHMod.tmplFn.getKeywordsVal()}}相关的结果\
        \ {{if (city = group.city_recom || []).length}}\
        \ {{each (i, item) city}}\ \ {{if (i==0)}}
            {{tmpl SSHMod.langConf.city}}
            {{/if}}\ \ {{tmpl SSHMod.tmplFn.HighLightAddressResult(left, val)}}\ ({{tmpl SSHMod.tmplFn.HighLightAddressResult(right, val)}})\ \ {{if (data.split("|")[4] != "-1")}}{{tmpl data.split("|")[4]}}{{/if}}\ \ {{/each}}\
        \ {{/if}}\ \ {{if ((landmark = group.landmark_recom || []).length || (airport = group.airport_recom || []).length)}}{{/if}}\ {{if (landmark = group.landmark_recom || []).length}}\
        \ {{each (i, item) landmark}}\ \ {{if (i==0)}}
            {{tmpl (IsDomestic?SSHMod.langConf.weizhi:SSHMod.langConf.landmark)}}
            {{/if}}\ {{if (left != "" && right!="")}}\ \ {{else}}\ {{if (left != "" && right=="")}}\ \ {{else}}\ \ {{/if}}\ {{/if}}\ {{tmpl SSHMod.tmplFn.HighLightAddressResult(left, val)}}\ {{if (left != "" && !IsDomestic)}}\ {{if (right != "")}}\ ({{tmpl SSHMod.tmplFn.HighLightAddressResult(right, val)}})\ {{/if}}\ {{/if}}\ \ {{if (data.split("|")[4] != "-1")}}{{tmpl data.split("|")[4]}}{{/if}}\ \ {{/each}}\
        \ {{/if}}\ {{if ((busArea = group.zone_recom || []).length)}}\
        \ {{each (i, item) busArea}}\ \ {{if (i==0)}}
            {{tmpl (IsDomestic?SSHMod.langConf.weizhi:SSHMod.langConf.busArea)}}
            {{/if}}\ {{if (left != "" && right!="")}}\ \ {{else}}\ {{if (left != "" && right=="")}}\ \ {{else}}\ \ {{/if}}\ {{/if}}\ {{tmpl SSHMod.tmplFn.HighLightAddressResult(left, val)}}\ {{if (left != "" && !IsDomestic)}}\ {{if (right != "")}}\ ({{tmpl SSHMod.tmplFn.HighLightAddressResult(right, val)}})\ {{/if}}\ {{/if}}\ \ {{if (data.split("|")[4] != "-1")}}{{tmpl data.split("|")[4]}}{{/if}}\ \ {{/each}}\
        \ {{/if}}\ {{if (airport = group.airport_recom || []).length}}\
        \ {{each (i, item) airport}}\ \ {{if (i==0)}}
            {{tmpl (IsDomestic?SSHMod.langConf.weizhi:SSHMod.langConf.airport)}}
            {{/if}}\ {{if (left != "" && right != "")}}\ \ {{else}}\ \ {{/if}}\ {{tmpl SSHMod.tmplFn.HighLightAddressResult(left, val)}}\ {{if (right != "" && !IsDomestic)}}\ ({{tmpl SSHMod.tmplFn.HighLightAddressResult(right, val)}})\ {{/if}}\ \ {{if (data.split("|")[4] != "-1")}}{{tmpl data.split("|")[4]}}{{/if}}\ \ {{/each}}\
        \ {{/if}}\ \ {{if (hotel = group.hotel_recom || []).length}}\
        \ {{each (i, item) hotel}}\ \ {{if (i==0)}}
            {{tmpl (IsDomestic?SSHMod.langConf.name:SSHMod.langConf.hotel)}}
            {{/if}}\ {{if (left != "" && right!="")}}\ \ {{else}}\ {{if (left != "" && right=="")}}\ \ {{else}}\ \ {{/if}}\ {{/if}}\ {{tmpl SSHMod.tmplFn.HighLightAddressResult(right, val)}}\ {{if (left !="" && !IsDomestic)}}\ ({{tmpl SSHMod.tmplFn.HighLightAddressResult(left, val)}})\ {{/if}}\ \ \ {{/each}}\
        \ {{/if}}\ \
        \ ', filterIpad: '\ {{if (SSHMod.tmplFn.sentBFI())}}{{/if}}\ {{if $data.hasResult}}\ {{if (group=SSHMod.tmplFn.groupKeywordList($data.list), v=$data.val)}}{{/if}}\
        \
        \ ×\ ${v},若需缩小范围，请输入更多条件。\

        \ {{if (hotel = group.hotel || []).length}}\
        \ {{each (i, item) hotel}}\ \ {{if (i==0)}}
            {{tmpl (IsDomestic?SSHMod.langConf.name:SSHMod.langConf.hotel)}}
            {{/if}}\ \ {{tmpl SSHMod.tmplFn.HighLightAddressResult(item.left, v)}}\ {{if (item.right !="" && !IsDomestic)}}\ ({{tmpl SSHMod.tmplFn.HighLightAddressResult(item.right, v)}})\ {{/if}}\ \ \ {{/each}}\
        \ {{/if}}\ \ {{if (station = group.station || []).length}}\
        \ {{each (i, item) station}}\ \ {{if (i==0)}}
            {{tmpl SSHMod.langConf.Station}}
            {{/if}}\ {{if (item.left != "") }}\ \ {{else}}\ \ {{/if}}\ {{tmpl SSHMod.tmplFn.HighLightAddressResult(item.right, v)}}\ {{if (item.left != "" && !IsDomestic)}}\ ({{tmpl SSHMod.tmplFn.HighLightAddressResult(item.left, v)}})\ {{/if}}\ \ {{if (item.data.split("|")[4] != "-1")}}{{tmpl item.data.split("|")[4]}}{{/if}}\ \ {{/each}}\
        \ {{/if}}\ \ {{if ((landmark = group.landmark || []).length || (airport = group.airport || []).length)}}\
        \ {{if (airport = group.airport || []).length}}\ {{each (i, item) airport}}\ \ {{if (i==0)}}
            {{tmpl (IsDomestic?SSHMod.langConf.weizhi:SSHMod.langConf.landmark)}}
            {{/if}}\ {{if (left != "")}}\ \ {{else}}\ \ {{/if}}\ {{tmpl SSHMod.tmplFn.HighLightAddressResult(right, val)}}\ {{if (left != "" && !IsDomestic)}}\ ({{tmpl SSHMod.tmplFn.HighLightAddressResult(left, val)}})\ {{/if}}\ \ {{if (data.split("|")[4] != "-1")}}{{tmpl data.split("|")[4]}}{{/if}}\ \ {{/each}}\ {{/if}}\ {{each (i, item) landmark}}\ \ {{if (i==0 && !airport.length)}}
            {{tmpl (IsDomestic?SSHMod.langConf.weizhi:SSHMod.langConf.landmark)}}
            {{/if}}\ {{if (left != "")}}\ \ {{else}}\ \ {{/if}}\ {{tmpl SSHMod.tmplFn.HighLightAddressResult(right, val)}}\ {{if (left != "" && !IsDomestic)}}\ ({{tmpl SSHMod.tmplFn.HighLightAddressResult(left, val)}})\ {{/if}}\ \ {{if (data.split("|")[4] != "-1")}}{{tmpl data.split("|")[4]}}{{/if}}\ \ {{/each}}\
        \ {{/if}}\ \ {{if ((busArea = group.zone || []).length)}}\
        \ {{each (i, item) busArea}}\ \ {{if (i==0)}}
            {{tmpl (IsDomestic?SSHMod.langConf.weizhi:SSHMod.langConf.busArea)}}
            {{/if}}\ {{if (left != "" && right!="")}}\ \ {{else}}\ {{if (left != "" && right=="")}}\ \ {{else}}\ \ {{/if}}\ {{/if}}\ {{tmpl SSHMod.tmplFn.HighLightAddressResult(right, val)}}\ {{if (left != "" && !IsDomestic)}}\ {{if (right != "")}}\ ({{tmpl SSHMod.tmplFn.HighLightAddressResult(left, val)}})\ {{else}}\ {{tmpl SSHMod.tmplFn.HighLightAddressResult(left, val)}}\ {{/if}}\ {{/if}}\ \ {{if (data.split("|")[4] != "-1")}}{{tmpl data.split("|")[4]}}{{/if}}\ \ {{/each}}\
        \ {{/if}}\
        \ {{else}}\
        \
        \ ×找不到：${v}\

        \
        \ {{/if}}\
        \
        \ 为您展示更多城市下和{{tmpl SSHMod.tmplFn.getKeywordsVal()}}相关的结果\
        \ {{if (city = group.city_recom || []).length}}\
        \ {{each (i, item) city}}\ \ {{if (i==0)}}
            {{tmpl SSHMod.langConf.city}}
            {{/if}}\ \ {{tmpl SSHMod.tmplFn.HighLightAddressResult(left, val)}}\ ({{tmpl SSHMod.tmplFn.HighLightAddressResult(right, val)}})\ \ {{if (data.split("|")[4] != "-1")}}{{tmpl data.split("|")[4]}}{{/if}}\ \ {{/each}}\
        \ {{/if}}\ \ {{if ((landmark = group.landmark_recom || []).length || (airport = group.airport_recom || []).length)}}{{/if}}\ {{if (landmark = group.landmark_recom || []).length}}\
        \ {{each (i, item) landmark}}\ \ {{if (i==0)}}
            {{tmpl (IsDomestic?SSHMod.langConf.weizhi:SSHMod.langConf.landmark)}}
            {{/if}}\ {{if (left != "" && right!="")}}\ \ {{else}}\ {{if (left != "" && right=="")}}\ \ {{else}}\ \ {{/if}}\ {{/if}}\ {{tmpl SSHMod.tmplFn.HighLightAddressResult(left, val)}}\ {{if (left != "" && !IsDomestic)}}\ {{if (right != "")}}\ ({{tmpl SSHMod.tmplFn.HighLightAddressResult(right, val)}})\ {{/if}}\ {{/if}}\ \ {{if (data.split("|")[4] != "-1")}}{{tmpl data.split("|")[4]}}{{/if}}\ \ {{/each}}\
        \ {{/if}}\ {{if ((busArea = group.zone_recom || []).length)}}\
        \ {{each (i, item) busArea}}\ \ {{if (i==0)}}
            {{tmpl (IsDomestic?SSHMod.langConf.weizhi:SSHMod.langConf.busArea)}}
            {{/if}}\ {{if (left != "" && right!="")}}\ \ {{else}}\ {{if (left != "" && right=="")}}\ \ {{else}}\ \ {{/if}}\ {{/if}}\ {{tmpl SSHMod.tmplFn.HighLightAddressResult(left, val)}}\ {{if (left != "" && !IsDomestic)}}\ {{if (right != "")}}\ ({{tmpl SSHMod.tmplFn.HighLightAddressResult(right, val)}})\ {{/if}}\ {{/if}}\ \ {{if (data.split("|")[4] != "-1")}}{{tmpl data.split("|")[4]}}{{/if}}\ \ {{/each}}\
        \ {{/if}}\ {{if (airport = group.airport_recom || []).length}}\
        \ {{each (i, item) airport}}\ \ {{if (i==0)}}
            {{tmpl (IsDomestic?SSHMod.langConf.weizhi:SSHMod.langConf.airport)}}
            {{/if}}\ {{if (left != "")}}\ \ {{else}}\ \ {{/if}}\ {{tmpl SSHMod.tmplFn.HighLightAddressResult(left, val)}}\ {{if (right != "" && !IsDomestic)}}\ ({{tmpl SSHMod.tmplFn.HighLightAddressResult(right, val)}})\ {{/if}}\ \ {{if (data.split("|")[4] != "-1")}}{{tmpl data.split("|")[4]}}{{/if}}\ \ {{/each}}\
        \ {{/if}}\ \ {{if (hotel = group.hotel_recom || []).length}}\
        \ {{each (i, item) hotel}}\ \ {{if (i==0)}}
            {{tmpl (IsDomestic?SSHMod.langConf.name:SSHMod.langConf.hotel)}}
            {{/if}}\ \ {{tmpl SSHMod.tmplFn.HighLightAddressResult(right, val)}}\ {{if (left !="" && !IsDomestic)}}\ ({{tmpl SSHMod.tmplFn.HighLightAddressResult(left, val)}})\ {{/if}}\ \ \ {{/each}}\
        \ {{/if}}\ \
        \ ', filterStyle: '\ .city_suggestion_pop { width:496px; border:1px solid #ccc; background-color:#fff; } \ .city_suggestion_pop .title { height:26px; margin:0 10px 4px; padding:0 2px; border-bottom:1px dotted #ccc; line-height:26px; color:#999; } \ .city_suggestion_pop .close { float:right; width:26px; height:26px; font:bold 14px/26px Simsun; color:#666; text-align:center; } \ .notfound_pop{ padding-bottom: 4px;} \ .notfound_pop .title{ line-height:26px; overflow: hidden; margin:0 10px 4px; padding:0 2px; color: #c01111; border-bottom: 0 none; word-break:break-all;} \ .notfound_pop .close{ margin-top: 2px;} \ .city_suggestion_pop .text_input { float:left; max-width:210px; _width:210px; overflow:hidden; white-space:nowrap; text-overflow:ellipsis; } \ .city_suggestion_pop .close:hover { text-decoration:none; color:#FFA800; } \ .city_suggestion_pop .sug_item{ overflow: hidden;} \ .city_suggestion_pop .sug_item a { display:block; overflow: hidden; padding-left:10px; color:#000; font-family:Tahoma; line-height:28px; cursor:pointer; *zoom:1;} \ .city_suggestion_pop .sug_item a:after{ clear:both; content:"."; display:block; height:0; overflow:hidden; } \ .city_suggestion_pop .sug_item .num { float:left; width: 80px; overflow: hidden; color:#999; text-align: right;} \ .city_suggestion_pop .sug_item .city { display:block; float: left; width:315px; max-height:56px; _height:28px; padding-right:4px; overflow:hidden; } \ .city_suggestion_pop .sug_item .en { color:#999; } \ .keywords_pop .sug_item .en { color:#333; } \ .city_suggestion_pop .sug_item b { font-weight:bold; color:#06c; } \ .city_suggestion_pop .sug_item a:hover, .city_suggestion_pop .sug_item .hover { background-color:#2577e3; color:#fff; text-decoration:none; } \ .city_suggestion_pop .sug_item a:hover span, .city_suggestion_pop .sug_item .hover span, .city_suggestion_pop .sug_item a:hover b, .city_suggestion_pop .sug_item .hover b { color:#fff; } \ .city_suggestion_pop .sug_category{ float: right; padding-left: 6px; width: 60px; height: 28px; line-height: 28px; background-image:url(//pic.c-ctrip.com/hotelinternational121211/ico_search_box_5.png); background-repeat: no-repeat;} \ .city_suggestion_pop .item_list_city, .city_suggestion_pop .item_list_hotel{ padding-bottom: 5px; border-bottom: 1px solid #ccc;} \ .city_suggestion_pop .sug_category_hover{ color: #fff; background-color: #2577e3; background-position: right 6px; background-color:#2577e3; } \ .city_suggestion_pop .item_list_airport, .city_suggestion_pop .item_list_landmarks{ padding: 4px 0 6px;} \ .city_suggestion_pop .item_list_city .sug_category{background-position: right -29px;} \ .city_suggestion_pop .item_list_city .hover .sug_category{background-position: right 6px;} \ .city_suggestion_pop .item_list_city a:hover .sug_category{background-position: right 6px;} \ .city_suggestion_pop .item_list_airport .sug_category{background-position: right -99px;} \ .city_suggestion_pop .item_list_airport .hover .sug_category{background-position: right -62px;} \ .city_suggestion_pop .item_list_airport a:hover .sug_category{background-position: right -62px;} \ .city_suggestion_pop .item_list_hotel .sug_category{background-position: right -165px;} \ .city_suggestion_pop .item_list_hotel .hover .sug_category{background-position: right -133px;} \ .city_suggestion_pop .item_list_hotel a:hover .sug_category{background-position: right -133px;} \ .city_suggestion_pop .item_list_landmarks .sug_category{background-position: right -198px;} \ .city_suggestion_pop .item_list_landmarks .hover .sug_category{background-position: right -232px;} \ .city_suggestion_pop .item_list_landmarks a:hover .sug_category{background-position: right -232px;} \ .city_suggestion_pop .item_list_scenic .sug_category{background-position: right -265px;} \ .city_suggestion_pop .item_list_scenic .hover .sug_category{background-position: right -297px;} \ .city_suggestion_pop .item_list_scenic a:hover .sug_category{background-position: right -297px;} \ .city_suggestion_pop .sug_item .city{width:290px;} \ .city_suggestion_pop .sug_category{width:55px; padding-right:20px; padding-left:0; text-align:right;}\ .city_suggestion_pop .sug_item a{padding-right:10px; line-height:1.5; padding-top:4px; padding-bottom:4px;} \ .city_suggestion_pop .sug_item{padding: 4px 0 4px; border-bottom:1px solid #ccc; margin-bottom:-1px;} \ .city_suggestion_pop .sug_item a.sug_item_header{line-height:28px; padding-top:0; padding-bottom:0; } \ .city_suggestion_pop .item_list_traffic .sug_category{background-position: right -330px; padding-right:40px;} \ .city_suggestion_pop .item_list_traffic .city{width:} \ .city_suggestion_pop .item_list_traffic .hover .sug_category{background-position: right -366px;padding-right: 40px;} \ .city_suggestion_pop .item_list_traffic a:hover .sug_category{background-position: right -366px;} \ .city_suggestion_pop .item_list_areaadmin .sug_category{background-position: right -404px;}\ .city_suggestion_pop .item_list_areaadmin .hover .sug_category{background-position: right -441px;}\ .city_suggestion_pop .item_list_areaadmin a:hover .sug_category{background-position: right -441px;}\ .city_suggestion_pop .item_list_business .sug_category{background-position: right -551px;}\ .city_suggestion_pop .item_list_business .hover .sug_category{background-position: right -590px;}\ .city_suggestion_pop .item_list_business a:hover .sug_category{background-position: right -590px;}\ .city_suggestion_pop .item_list_hotel .city {width:395px;}\ .t_relation{ padding:0 12px; height: 30px; line-height: 30px; font-size: 12px; overflow: hidden; background-color: #f2f2f2; color: #666; border-top: 1px solid #ccc;}\ .t_relation .keyword{ display: inline-block; _display:inline; vertical-align: -6px; *vertical-align: -1px; max-width: 200px; line-height: 20px; overflow:hidden; white-space:nowrap; _white-space:normal; text-overflow:ellipsis; _text-overflow:clip; color: #2577e3; font-weight: bold; }\ ', //===================== Domestic : TODO 这一部分如果页面没用到就删除 ======================= suggestionDomestic: '\ {{if (data)}}\
            \ ×\ {{enum(key, item) data}}\ {{if key==="subCity"}}\
            \ ${item.cnname}：{{if (item.data)}}{{each item.data}}${name}{{/each}}{{/if}}\
            \ {{else}}\
            \
                ${item.cnname}\
{{if (item.data)}}{{each item.data}}${name}{{/each}}{{/if}}\
            \ {{/if}}\ {{/enum}}\
            \ {{/if}}', suggestionIpadDomestic: '\
            \ ×\
显示键盘
\ {{if ($data.data)}}\ {{enum(key, item) $data.data}}\ {{if key==="subCity"}}\
            \ ${item.cnname}：{{if (item.data)}}{{each (key, it) item.data}}${it.name}{{/each}}{{/if}}\
            \ {{else}}\
            \
                ${item.cnname}\
{{if (item.data)}}{{each (key, it) item.data}}${it.name}{{/each}}{{/if}}\
            \ {{/if}}\ {{/enum}}\ {{/if}}\
', suggestionStyleDomestic: '\ .key_word_lhsl { width:498px; padding:8px 10px; border:1px solid #999; background-color:#fff; }\ .key_word_key{display:none;height:30px;}\ .ico_key,.ico_unkey{ width:39px; height:25px; background:url(//pic.c-ctrip.com/ctripOnPad/un_key.png) no-repeat; -webkit-transform:scale(.7);margin-left:-5px;cursor:pointer;}\ .key_word_lhsl .close { float:right; width:20px; height:20px; color:#666; text-align:center; font:bold 16px/20px Simsun; }\ .key_word_lhsl .close:hover { text-decoration:none; color:#FFA800; }\ .key_word_lhsl .key_word_list { margin-bottom:6px; }\ .key_word_lhsl .key_word_list dt { font-weight:bold; }\ .key_word_lhsl .key_word_list dd { display:inline-block; }\ .key_word_lhsl .key_word_list dd {display:block;overflow:hidden;}\ .key_word_lhsl .key_word_list a { float:left; height:22px; padding:0 15px 0 5px; border:1px solid #fff; line-height:22px; white-space:nowrap; color:#333;}\ .key_word_lhsl .key_word_list a:hover { border:1px solid #2577e3; background-color:#2577e3; text-decoration:none; color:#fff;}\ .key_word_lhsl .keyword_sub_city { margin:0 -10px -8px; padding:5px 10px; border-top:1px solid #CCC; background-color:#F3F3F3; color:#333; }\ .key_word_lhsl .keyword_sub_city a { margin-right:10px; color:#4D4D4D; }\ .key_word_lhsl_pad .key_word_key { display:block; }', suggestionStyleIpadDomestic: '\ .key_word_lhsl{position:relative;width:498px;padding:8px 10px;border:1px solid #999;background-color:#fff;font-size:16px;}\ .key_word_key{height:48px;}\ .ico_key,.ico_unkey{width:92px;height:43px;padding-left:65px;background:url(//pic.c-ctrip.com/ctripOnPad/un_key20131012.png) 10px 11px no-repeat;cursor:pointer;line-height:40px;font-size:18px;border-width:1px;border-style:solid;border-radius:3px;}\ .ico_key{border-color:#f0f0f0 #cfcfcf #707070;box-shadow:0 1px 0 #cfcfcf,1px 0 0 0 #f0f0f0 inset,-1px 0 0 0 #f0f0f0 inset,0 -1px 0 0 #f0f0f0 inset;}\ .ico_unkey{border-color:#898989 #e2e2e2 #e2e2e2;background-color:#f5f5f5;box-shadow:0 -1px 0 #e2e2e2,0 1px 0 #d1d1d1 inset;}\ .key_word_lhsl .close{position:absolute;top:10px;right:10px;width:30px;height:30px;line-height:30px;text-align:center;color:#666;font:bold 22px/30px "Heiti SC","Heiti SC light",STHeiti,STXihei,sans-serif;}\ .key_word_lhsl .key_word_list{margin-bottom:6px;}\ .key_word_lhsl .key_word_list dt{margin-bottom:10px;font-weight:bold;}\ .key_word_lhsl .key_word_list dd{display:inline-block;}\ .key_word_lhsl .key_word_list dd{display:block;overflow:hidden;}\ .key_word_lhsl .key_word_list a{float:left;height:30px;padding:0 8px;margin-right:2px;margin-bottom:10px;line-height:30px;color:#333;white-space:nowrap;}\ .key_word_lhsl .keyword_sub_city{margin:0 -10px -8px;padding:5px 10px;border-top:1px solid #CCC;background-color:#F3F3F3;color:#333;}\ .key_word_lhsl .keyword_sub_city a{margin-right:10px;color:#4D4D4D;}\ .key_word_lhsl_pad .key_word_key{display:block;}', filterDomestic: '\ {{if (newlist = cQuery.groupMarkerData($data.list))}}{{/if}}\ {{if (newlist.name.length || newlist.station.length || newlist.position.length)}}\
                \
                ×${$data.val}，若需缩小范围，请输入更多条件。

                \ {{if ((names = newlist.name).length)}}\
                \ {{each (i,item) names}}\ \ {{if (i==0)}}
                    名称
                    {{/if}}\ {{if (txt=cQuery.highlightKeyword(item.right, cQuery.keywordFilterHighlights[$data.val])) }}${txt}{{/if}}\ \ {{/each}}\
                \ {{/if}}\ {{if ((districts = newlist.district).length)}}\
                \ {{each (i,item) districts}}\ \ {{if (i==0)}}
                    景区
                    {{/if}}\ {{if (txt=cQuery.highlightKeyword(item.right, cQuery.keywordFilterHighlights[$data.val])) }}${txt}{{/if}}\ ${item.data.split("|")[5] || 0}家酒店\ \ {{/each}}\
                \ {{/if}}\ {{if ((stations = newlist.station).length)}}\
                \ {{each (i,item) stations}}\ \ {{if (i==0)}}
                    机场火车站
                    {{/if}}\ {{if (txt=cQuery.highlightKeyword(item.right, cQuery.keywordFilterHighlights[$data.val])) }}${txt}{{/if}}\ \ {{/each}}\
                \ {{/if}}\ {{if ((positions = newlist.position).length)}}\
                \ {{each (i,item) positions}}\ \ {{if (i==0)}}
                    位置
                    {{/if}}\ {{if (txt=cQuery.highlightKeyword(item.right, cQuery.keywordFilterHighlights[$data.val])) }}${txt}{{/if}}\ \ {{/each}}\
                \ {{/if}}\
                \ {{/if}}', filterStyleDomestic: '\ .keyword_prompting_lhsl{width:398px; border:1px solid #999; background-color:#fff;}\ .keyword_prompting_lhsl .title{height:26px; margin:0 10px 4px; padding:0 2px; border-bottom:1px dotted #ccc; line-height:26px; color:#999;}\ .keyword_prompting_lhsl .close{float:right; width:26px; height:26px; font:bold 14px/26px Simsun; color:#666; text-align:center;}\ .keyword_prompting_lhsl .close:hover { text-decoration:none; color:#FFA800; }\ .keyword_prompting_lhsl .sug_item{overflow:hidden;padding-bottom: 5px; padding-top:5px; border-bottom: 1px solid #ccc;*zoom:1;}\ .keyword_prompting_lhsl .sug_item a{display:block; overflow:hidden; padding:5px 7px 5px 10px; color:#333; line-height:18px; cursor:pointer;*zoom:1;}\ .keyword_prompting_lhsl .sug_item .hover { background-color:#2577e3; color:#fff; text-decoration:none;}\ .keyword_prompting_lhsl .sug_item .hover span, .keyword_prompting_lhsl .sug_item .hover b{color:#fff;}\ .notfound_pop{ padding-bottom: 4px;}\ .keyword_prompting_lhsl .sug_item .b{font-weight:bold; color:#06c; }\ .notfound_pop .title{ line-height:26px; overflow: hidden; margin:0 10px 4px; padding:0 2px; color: #c01111; border-bottom: 0 none;}\ .notfound_pop .close{ margin-top: 2px;}\ .keyword_prompting_lhsl .text_input { float:left; max-width:160px; _width:160px; overflow:hidden; white-space:nowrap; text-overflow:ellipsis; }\ .keyword_prompting_lhsl .sug_item a:after{ clear:both; content:"."; display:block; height:0; overflow:hidden; }\ .keyword_prompting_lhsl .sug_item .num { float:left; width: 80px; overflow: hidden; color:#999; text-align: right;}\ .keyword_prompting_lhsl .sug_item .city { display:block; float: left; width:260px; padding-right:4px; overflow:hidden; }\ .keyword_prompting_lhsl .item_list_scenic .city {width:195px;}\ .keyword_prompting_lhsl .sug_item b{font-weight:bold; color:#06c; }\ .keyword_prompting_lhsl .sug_category{ float:right; height:18px; line-height:18px; background-image:url(//pic.c-ctrip.com/hotels121118/ico_search_box_1.png); background-repeat: no-repeat;width:62px; padding-right:20px; padding-left:0; text-align:right;}\ .keyword_prompting_lhsl .sug_category_hover{ color: #fff; background-color: #2577e3; background-position: right 6px; background-color:#2577e3; }\ .keyword_prompting_lhsl .item_list_city .sug_category{background-position: right -33px;}\ .keyword_prompting_lhsl .item_list_city .hover .sug_category{background-position: right 2px;}\ .keyword_prompting_lhsl .item_list_landmarks .sug_category{background-position: right -204px;}\ .keyword_prompting_lhsl .item_list_landmarks .hover .sug_category{background-position: right -238px;}\ .keyword_prompting_lhsl .item_list_scenic .sug_category{background-position: right -271px;}\ .keyword_prompting_lhsl .item_list_scenic .hover .sug_category{background-position: right -303px;}\ .keyword_prompting_lhsl .item_list_traffic .sug_category{background-position: right -336px; padding-right:40px;}\ .keyword_prompting_lhsl .item_list_traffic .hover .sug_category{background-position: right -372px;}', filterStyleIpadDomestic: '\ .keyword_prompting_lhsl{width:450px; border:1px solid #999; background-color:#fff;}\ .keyword_prompting_lhsl .title{height:30px; margin:0 10px 4px; padding:0 2px; border-bottom:1px dotted #ccc; line-height:30px; color:#999;}\ .keyword_prompting_lhsl .close{float:right; width:26px; height:30px; font: bold 22px/30px "Heiti SC","Heiti SC light",STHeiti,STXihei,sans-serif; color:#666; text-align:center;}\ .keyword_prompting_lhsl .sug_item{overflow:hidden;padding-bottom: 5px; padding-top:5px; border-bottom: 1px solid #ccc;}\ .keyword_prompting_lhsl .sug_item a{display:block; overflow:hidden; padding:5px 7px 5px 10px; color:#333; line-height:24px; cursor:pointer;}\ .notfound_pop .title{overflow: hidden; margin:0 10px 4px; padding:0 2px; color: #c01111; border-bottom: 0 none;}\ .notfound_pop .close{ margin-top: 2px;}\ .keyword_prompting_lhsl .text_input { float:left; max-width:210px; _width:210px; overflow:hidden; white-space:nowrap; text-overflow:ellipsis; }\ .keyword_prompting_lhsl .sug_item a:after{ clear:both; content:"."; display:block; height:0; overflow:hidden; }\ .keyword_prompting_lhsl .sug_item .num { float:left; width: 80px; overflow: hidden; color:#999; text-align: right;}\ .keyword_prompting_lhsl .sug_item .city { display:block; float: left; width:300px; padding-right:4px; overflow:hidden; }\ .keyword_prompting_lhsl .item_list_scenic .city {width:199px;}\ .keyword_prompting_lhsl .sug_item b{font-weight:bold; color:#06c; }\ .keyword_prompting_lhsl .sug_item .b{font-weight:bold; color:#06c; }\ .keyword_prompting_lhsl .sug_category{ float:right; height:24px; line-height:24px; background-image:url(//pic.c-ctrip.com/hotels121118/ico_search_box_1.png); background-repeat: no-repeat;width:85px; padding-right:20px; padding-left:0; text-align:right;}\ .keyword_prompting_lhsl .item_list_city .sug_category{background-position: right -30px;}\ .keyword_prompting_lhsl .item_list_scenic .sug_category{background-position: right -271px;}\ .keyword_prompting_lhsl .item_list_scenic .hover .sug_category{background-position: right -303px;}\ .keyword_prompting_lhsl .item_list_landmarks .sug_category{background-position: right -201px;}\ .keyword_prompting_lhsl .item_list_traffic .sug_category{background-position: right -333px; padding-right:40px;}' }; /* 保存页面初始化的选中城市信息 */ window.PageData = { city: { domestic: { cityName: "", id: "", py: "" }, overseas: { cityName: "", id: "", py: "" } } }; // 国内、外下拉框列表 var $isOverseasWrap = $("#isOverseasWrap"), $isOverseasDL = $("#isOverseasDropdownList"), $isOverseasIpt = $isOverseasWrap.find("#isOverseasIpt"), $isOverseasArrow = $isOverseasWrap.find("#isOverseasArrow"), // 地址选择器input $SSH_CityName = $("#SSH_CityName"), $SSH_CityName_Overseas = $("#SSH_CityName_Overseas"), // 城市id、pinyin $SSH_CityId = $('#SSH_CityId'), $SSH_CityPY = $('#SSH_CityPy'), // 入住日期 $SSH_CheckInDate = $("#SSH_CheckIn"), // 游玩天数 $SSH_Playdays = $("#SSH_SelectNight"), // 酒店级别 $SSH_HotelLevel = $("#SSH_HotelLevel"), // 关键词 $SSH_Keyword = $("#Hotel_SSH_txtSearch"), // 搜索按钮 $SSH_SearchBtn = $("#Hotel_SSH_btnSearch"), $SSH_Form = $("#Hotel_SSH_form"); /* require DropDownList plugin */ var DropDownList = (function(){ var DropDownList = function(dropMenu, dropItemTagName) { this.dropMenu = dropMenu; this.dropItemTagName = dropItemTagName || "A"; this.dropTrigger = undefined; this.setTimeoutId = null; }; DropDownList.prototype = { constructor: DropDownList, dropDown: function() { var rect = dimension(this.dropTrigger[0]); this.dropMenu.css({position: "absolute", left: rect.left + "px", top: rect.bottom + "px"}); this.dropMenu.removeClass("hidden"); this.dropTrigger.dropDownCallback(); }, dropUp: function() { this.dropMenu.addClass("hidden"); this.dropTrigger && this.dropTrigger.dropUpCallback(); }, selectItem: function(e) { e.stopPropagation(); var target = e.target; if (target.tagName !== this.dropItemTagName) target = e.target = target.parentNode; if (target.tagName !== this.dropItemTagName) return; this.dropTrigger.selectCallback(this.dropMenu, target); this.dropUp(); }, reg: function(dropTriggers, options) { var me = this, dropTrigger; var defaults = { eventType: "click", dropDownCallback: function() {}, dropUpCallback: function() {}, selectCallback: function() {} }, option = {}; $.extend(option, defaults, options); if (Object.prototype.toString.call(dropTriggers) === "object Array") { dropTrigger = dropTriggers[0]; } else { dropTrigger = dropTriggers; dropTriggers = [dropTrigger]; } dropTrigger.dropUpCallback = option.dropUpCallback; dropTrigger.dropDownCallback = option.dropDownCallback; dropTrigger.selectCallback = option.selectCallback; this.dropMenu.bind("click", this.selectItem.bind(this)); if (option.eventType === "mouseover") { this.dropMenu.bind("mouseenter", this.show.bind(this)).bind("mouseleave", this.hide.bind(this)); } else { $(document).bind("click", function () { me.dropUp(); }); } dropTriggers.each(function (item) { item.bind(option.eventType, function (e) { me.dropTrigger = dropTrigger; me.dropDown(e); e.stopPropagation(); }); }); } }; function hacklib () { var orginBind = $.fn.bind; var mapping = { 'mouseenter': 'mouseover', 'mouseleave': 'mouseout' } $.fn.bind = function (evtName, fn) { var args = Array.prototype.slice.call(arguments); if(evtName !== 'mouseenter' && evtName !== 'mouseleave') return orginBind.apply(this, args); var target = this[0]; var fnWrapper = function (e) { var related = e.relatedTarget; if ( !related || (related !== target && !(target.compareDocumentPosition(related) & 16)) ) fn(e); } return orginBind.apply(this, [mapping[evtName], fnWrapper]); } } function dimension(el) { var dim = el.getBoundingClientRect(); var docElem = document.documentElement; var pageXOffset = (window.pageXOffset || docElem.scrollLeft) - (docElem.clientLeft || 0), pageYOffset = (window.pageYOffset || docElem.scrollTop) - (docElem.clientTop || 0); return { left: dim.left + pageXOffset, top: dim.top + pageYOffset, right: dim.right + pageXOffset, bottom: dim.bottom + pageYOffset, width: isNaN(dim.width) ? dim.right - dim.left : dim.width, height: isNaN(dim.height) ? dim.bottom - dim.top : dim.height } } if( !('onmouseenter' in document.createElement('div')) ) hacklib(); return DropDownList; })(); /* 大首页不方便将dropMenu DOM放到HTML body根目录下，因此定位会出错，改用手动添加DOM */ $("body").append($isOverseasDL); /* 自定义下拉框控件 */ var dropDownIsOverseas = new DropDownList($isOverseasDL); // 关键字用户行为 w.userBehaviorKeyWordInfo = { "searchType": "S", "cityId": null, "keyword": null }; // 用户行为跟踪 ;(function () { $SSH_SearchBtn.bind("click", function () { w.userBehaviorKeyWordInfo.cityId = $SSH_CityId.value(); w.userBehaviorKeyWordInfo.keyword = $SSH_Keyword.value(); //发送用户行为记录请求 w['__bfi'].push(['_tracklog', "SEARCH_AUTOCOMPLET_US", $.stringifyJSON(w.userBehaviorKeyWordInfo)]); //请求后还原 w.userBehaviorKeyWordInfo = { "searchType": "S", "cityId": null, "keyword": null }; }); })(); /* 模板引擎调用函数 */ SSHMod.tmplFn = { /** * [getKeywordsVal 返回关键字选择器的值] * @return {[String]} [value] */ getKeywordsVal: function() { return $SSH_Keyword.value(); }, isRecomResultShow: function(hotel){ var countOrgObjNum = 0, countRecomObjNum = 0; for (var i in hotel) { if (i.indexOf('_recom') == -1) { countOrgObjNum += hotel[i].length; //原始数据 } else { countRecomObjNum += hotel[i].length; //推荐数据 }; }; if (countRecomObjNum && countOrgObjNum < 5) { return ''; } else { return 'hidden'; }; }, /** * [groupList 给海外地址选择器filter的数据分组] */ groupList: function(list) { var group = {}; var yIndex = 1; var i = 0; list.each(function (item) { var arr = item.data.split('|'); var type = arr[2]; (group[type] || (group[type] = [])).push(item); }); //city if (group['city']) { for (var i = 0; i < group['city'].length; i++) { group['city'][i]["yindex"] = yIndex++; } } //landmark if (group['landmark']) { for (var i = 0; i < group['landmark'].length; i++) { group['landmark'][i]['yindex'] = yIndex++; } } //zone if (group['zone']) { for (var i = 0; i < group['zone'].length; i++) { group['zone'][i]['yindex'] = yIndex++; } } //airport if (group['airport']) { for (var i = 0; i < group['airport'].length; i++) { group['airport'][i]["yindex"] = yIndex++; } } //location if (group['location']) { for (var i = 0; i < group['location'].length; i++) { group['location'][i]["yindex"] = yIndex++; } } //district if (group['district']) { for (var i = 0; i < group['district'].length; i++) { group['district'][i]["yindex"] = yIndex++; } } //hotel if (group['hotel']) { for (var i = 0; i < group['hotel'].length; i++) { group['hotel'][i]["yindex"] = yIndex++; } } //business area if (group["busArea"]) { for (i = 0; i < group['busArea'].length; i++) { group['busArea'][i]["yindex"] = yIndex++; } } return group; }, /** * [groupKeywordList 给keyword的filter数据分组 keyword_enName|keyword_cnName|id|url|hotel_count|keyword_type|cityId|city_enName] * @param {[type]} list [description] * @return {[type]} [description] */ groupKeywordList: function (list) { var group = {}; var yIndex = 1; var i = 0; list.each(function (item) { // 有些酒店名称里有@符，和address冲突，故后端吐数据时替换成了全角的＠符，这里重新替换为半角的@符 item.data = item.data.replace(/＠/g, '@'); item.left = item.left.replace(/＠/g, '@'); item.right = item.right.replace(/＠/g, '@'); var arr = item.data.split('|'); var type = arr.length > 8 ? arr[6] : arr[5]; (group[type] || (group[type] = [])).push(item); }); //name if (group["hotel"]) { for (i = 0; i < group['hotel'].length; i++) { group['hotel'][i]["yindex"] = yIndex++; } } //station if (group["station"]) { for (i = 0; i < group['station'].length; i++) { group['station'][i]["yindex"] = yIndex++; } } //landmark if (group["landmark"]) { for (i = 0; i < group['landmark'].length; i++) { group['landmark'][i]["yindex"] = yIndex++; } } //airport if (group["airport"]) { for (i = 0; i < group['airport'].length; i++) { group['airport'][i]["yindex"] = yIndex++; } } return group; }, /** * [reFormat 重新格式化keyword的filter时的酒店名称] * keyword_enName|keyword_cnName|id|url|hotel_count|keyword_type|cityId|city_enName * => * keyword_enName|keyword_enName(keyword_cnName)|id|url|hotel_count|keyword_type|cityId|city_enName * @param {[type]} data [description] * @return {[type]} [description] */ reFormat: function(data) { var arr = data.split('|'); if (arr[1] != '') arr[1] = arr[0] + '(' + arr[1] + ')'; else arr[1] = arr[0]; return arr.join('|'); }, /** * [HighLightAddressResult 将字符串的指定内容高亮] * @param {[String]} result [原字串] * @param {[String]} value [高亮的匹配字符串] */ HighLightAddressResult: function(result, value) { var reg = new RegExp(filterSpicalCharForRegx(value), 'i'); return result.replace(reg, '$&'); }, /** * [byteLength 校验字串长度] * @param {[type]} str [description] * @return {[type]} [description] */ byteLength: function(str) { var len = str.length; var n = len; for (var i = 0; i < len; i++) { if (str.charCodeAt(i) > 255) n++; } return n; }, /** * [domesticKeywordToUrl 将国内的关键词转换成url] */ domesticKeywordToUrl: function (key, id) { var ret = key.replace(/Markland|RailwayStation|Airport/g, 'sl').replace(/Zone/g, 'zone').replace(/MetroStation/gi, 's').replace(/Metro/gi, 'l').replace(/Location/gi, 'location'); //从suggestion里选择的关键词key里面不包含id，从filter数据里选择的关键词key里面已包含id，所以要这么写 if (!/\d/.test(ret)) { return ret + id; } else { return ret; } }, addressFilterChange: function (mod, evt, that) { CITYENTER = false; //if (SSHMod.n_keyword) SSHMod.n_keyword.method('resetValue'); var items = evt.items; $.browser.isChrome && console.log('items[11]: ' + items[11], 'items[12]: ' + items[12]); if (items && items[2]) { that.value = items[1]; var isIntl = items[8] === '1' ? false : true; CURRENTCITY.id = items[3]; CURRENTCITY.py = items[0]; CURRENTCITY.cityName = items[4]; CURRENTCITY.isIntl = items[9] == 0 ? true : false; CURRENTCITY.isAddressSelected = true; var keywordArg = { itemId: CURRENTCITY.id, isDomesitcFilter: false, cityDisplay: '', keywordDisplay: '', isAirport: false }; $SSH_CityId.attr('_lastvalue', that.value); var isTW = items[1].indexOf('，' + SSHMod.langConf.taiwan + '，') !== -1; // 是否台湾 switch (items[2]) { case 'city': if (CURRENTCITY.isIntl && CURRENTCITY.id != '58' && CURRENTCITY.id != '59' && !isTW) { CURRENTCITY.url = '/international/' + items[4] + items[3]; CURRENTCITY.itemId = items[4] + items[3]; keywordArg.itemId = CURRENTCITY.id; } else { CURRENTCITY.url = '/hotel/' + items[4] + items[3]; keywordArg.isDomesitcFilter = true; keywordArg.itemId = CURRENTCITY.id; } CURRENTCITY.py = items[4]; break; case 'landmark': CURRENTCITY.id = items[5]; CURRENTCITY.py = items[6]; CURRENTCITY.url = '/international/' + CURRENTCITY.py + CURRENTCITY.id + '/s' + items[3]; CURRENTCITY.itemId = CURRENTCITY.py + CURRENTCITY.id + '/s' + items[3]; keywordArg.cityDisplay = items[4]; //HTL04HW - 1745 使文字结构保持一致【英文名（中文名）】 keywordArg.keywordDisplay = items[0] + '(' + items[7] + ')'; keywordArg.itemId = CURRENTCITY.id; break; case 'zone': CURRENTCITY.id = items[5]; CURRENTCITY.py = items[6]; CURRENTCITY.url = '/international/' + CURRENTCITY.py + CURRENTCITY.id + '/zone' + items[3];; CURRENTCITY.itemId = CURRENTCITY.py + CURRENTCITY.id + '/zone' + items[3]; keywordArg.cityDisplay = items[4]; //HTL04HW - 1745 使文字结构保持一致【英文名（中文名）】 keywordArg.keywordDisplay = items[0] + '(' + items[7] + ')'; keywordArg.itemId = CURRENTCITY.id; break; case 'airport': CURRENTCITY.id = items[3]; CURRENTCITY.py = 's'; CURRENTCITY.url = '/international/s' + items[3]; CURRENTCITY.itemId = 's' + items[3]; keywordArg.isAirport = true; keywordArg.itemId = items[3]; keywordArg.itemId = CURRENTCITY.id; break; case 'location': CURRENTCITY.id = items[5]; CURRENTCITY.py = items[6]; CURRENTCITY.url = '/hotel/' + CURRENTCITY.py + CURRENTCITY.id + '/location' + items[3]; keywordArg.isDomesitcFilter = true; keywordArg.cityDisplay = items[4]; keywordArg.keywordDisplay = items[7]; keywordArg.itemId = CURRENTCITY.id; break; case 'district': CURRENTCITY.id = items[5]; CURRENTCITY.py = items[6]; CURRENTCITY.url = '/hotel/' + items[0] + 'D' + items[3] + '_' + items[5]; keywordArg.isDomesitcFilter = true; keywordArg.itemId = CURRENTCITY.id; break; case 'hotel': CURRENTCITY.url = (CURRENTCITY.isIntl ? '/international/' : '/hotel/') + items[6] + items[5] + '/' + (items[7] ? 'k2' + encodeURIComponent(items[7]) : ''); CURRENTCITY.id = items[5]; CURRENTCITY.py = items[6]; keywordArg.itemId = CURRENTCITY.id; keywordArg.cityDisplay = items[4]; keywordArg.keywordDisplay = items[7]; break; default: CURRENTCITY.id = ''; CURRENTCITY.py = ''; CURRENTCITY.url = ''; break; } setKeywordData(keywordArg); // 更新关键词选择器控件 updateNight(keywordArg); // 更新联动的游玩天数 } else { CURRENTCITY.id = ''; CURRENTCITY.py = ''; CURRENTCITY.isIntl = true; } if (that.value != that.getAttribute('_lastvalue')) { that.setAttribute('_lastvalue', that.value); } setTimeout(function () { CITYENTER = true }, 100); $SSH_CityId.value(CURRENTCITY.id); $SSH_CityPY.value(CURRENTCITY.py); $SSH_CityName_Overseas[0].blur(); SSHMod.tmplFn.sentBFI(); }, addressFilterChangeDomestic: function(mod, evt, that) { CITYENTER = false; //if (SSHMod.n_keyword) SSHMod.n_keyword.method('resetValue'); /** 城市City 景区District 行政区Location 景点Sight 国内商业区DomesticZone 机场Airport 火车站RailwayStation pinyin|ShowName|ItemId|HotelQuantity|Word|ProvinceName|Type|CityName|CityId 城市/景区 pinyin|CityName|CityId|HotelQuantity|Word|ProvinceName|Type|ShowName|ItemId 行政区/景点/国内商业区/机场/火车站 */ var items = evt.items || []; var keywordArg = { itemId: "", isDomesitcFilter: true, cityDisplay: '', keywordDisplay: '', isAirport: false }; CURRENTCITY.isIntl = false; // 针对filter选中引发city change if (items.length === 9) { // Object {0: "Qiandaohu", 1: "千岛湖，淳安", 2: "D17_20", 3: "566", 4: "千岛湖", 5: "，浙江", 6: "District", 7: "淳安", 8: "20", length: 9} // Object {0: "Liyang", 1: "溧阳", 2: "1358", 3: "19", 4: "天目湖镇", 5: "，江苏", 6: "Location", 7: "天目湖镇，溧阳", 8: "926", length: 9} if (['City', 'District'].indexOf(items[6]) > -1) { keywordArg.itemId = items[8]; keywordArg.cityDisplay = items[1]; } else { keywordArg.itemId = items[2]; keywordArg.cityDisplay = items[1]; } CURRENTCITY.id = keywordArg.itemId; CURRENTCITY.py = items[0]; setKeywordData(keywordArg); // 更新关键词选择器控件 updateNight(keywordArg); // 更新联动的游玩天数 // 针对suggestion的选中引发city change } else if (items.length === 3 || items.length === 6) { keywordArg.itemId = items[2]; keywordArg.cityDisplay = items[1]; CURRENTCITY.id = keywordArg.itemId; CURRENTCITY.py = items[0]; setKeywordData(keywordArg); // 更新关键词选择器控件 updateNight(keywordArg); // 更新联动的游玩天数 } else { CURRENTCITY.id = ''; CURRENTCITY.py = ''; } if (that.value != that.getAttribute('_lastvalue')) { that.setAttribute('_lastvalue', that.value); } setTimeout(function () { CITYENTER = true }, 100); $SSH_CityId.value(CURRENTCITY.id); $SSH_CityPY.value(CURRENTCITY.py); $SSH_CityName[0].blur(); SSHMod.tmplFn.sentBFI(); }, keywordFilterChange: function (data, $keyword) { // keyword_enName|keyword_cnName|id|url|hotel_count|keyword_type|cityId|city_enName // 目的地选择机场时，才有cityId和city_enName，否则cityId和city_enName为空 var items = data.items; if (!items) return; if (IsDomestic) { $keyword.attr('url', SSHMod.tmplFn.domesticKeywordToUrl(items[3], items[2])); } else { $keyword.attr('url', items[3]); } $keyword.attr('_type', items[5]); $keyword.attr('keyworddata', items[2] + '|' + items[3].replace(/Markland|RailwayStation|Airport/g, 'sl').replace(/Zone/g, 'zone').replace(/MetroStation/gi, 's').replace(/Metro/gi, 'l').replace(/Location/gi, 'location')); var cityId = items[5] != "city_recom" ? items[6] : items[2]; var cityPY = items[5] != "city_recom" ? items[7] : items[1]; var hotelId = items[2]; if (items[5] && items[5] == "hotel" && hotelId && $('#hotelId').length > 0) { $('#hotelId').value(hotelId); } if ((cityId && cityPY) || (cityId && items[5] == "zone_recom")) { $SSH_CityId.value(cityId); $SSH_CityPY.value(cityPY.replace('(', '').replace(')', '')); } //HTL04HW-1745 需要显示【英文名（中文名）】 if (items[0] && items[1].indexOf('(') < 0) { $keyword.value(items[1] + '(' + items[0] + ')'); } if (IsDomestic) { $keyword.value(items[0] ? items[0] : items[1]); } if (items[5] == 'hotel' || items[5] == 'hotel_recom') { $keyword.attr('_hotelId', items[2]); }; setTimeout(function () { $keyword[0].blur(); $SSH_SearchBtn.click(); }, 200); SSHMod.tmplFn.sentBFI(); }, sentBFI: function() { if (typeof w['__bfi'] == 'undefined') w['__bfi'] = []; w.__bfi.push(['_tracklog','SSHkeyinput', 'keyword=' + (IsDomestic ? $SSH_CityName.value() : $SSH_CityName_Overseas.value()) + '&location=' + $SSH_Keyword.value()]); }, // ============================= 国内地址选择器模板调用函数 ============================== format: function(data) { var obj = {}; for (var key in data) { obj[key] = {}; if (key.search(/[A-Z]/i) != -1) { for (var i = 0; i < data[key].length; i++) { if (obj[key][data[key][i]['group']]) { obj[key][data[key][i]['group']].push(data[key][i]); } else { obj[key][data[key][i]['group']] = []; obj[key][data[key][i]['group']].push(data[key][i]); } } } else { for (var i = 0; i < data[key].length; i++) { if (obj[key]['']) { obj[key][''].push(data[key][i]); } else { obj[key][''] = []; obj[key][''].push(data[key][i]); } } } } return obj; }, groupCityFilterData: function(list) { var group = {}, yIndex = 1, i = 0; list.each(function(item) { if(item.length > 5){ var arr = item.data.split('|'), type = arr[6]; (group[type] || (group[type] = [])).push(item); } else{ type = "City"; (group[type] || (group[type] = [])).push(item); } }); /** * 添加埋点的Yindex数据 * 注意：这里['City', 'District', 'Sight', 'Location', 'DomesticZone', 'Airport', 'RailwayStation']是有序的， * 渲染浮层模版时和模版中的相关信息位置一一对应 */ ['City', 'District', 'Sight', 'Location', 'DomesticZone', 'Airport', 'RailwayStation'].each(function(key) { if (group[key]) { for (i = 0; i < group[key].length; i++) { group[key][i]["yindex"] = yIndex++; } } }); return group; }, getScenic: function(list) { var ret = []; list.each(function(item) { var arr = item.data.split('|'); var obj = ScenicData[arr[2]]; if (obj && arr[6] === 'District') { obj.data = item.data; ret.push(obj); } }); return ret; } }; /** * BI需求，拼成固定字符串 * @param {String} 当前input值 * @param {String} 传给tracklog的值 */ function makeTrackLogVals(value, autoCorrect) { var v = '', isMatch = 0; if (autoCorrect) { //if autoCorrected, isMatch set to true isMatch = 1; v = autoCorrect; } else { isMatch = 0; v = value; } return 'key=' + v + '&isMatch=' + isMatch; } /** * [filterSpicalCharForRegx 正则表达式的特殊字符处理] * @param {[String]} value [需要修改的字符串] * @return {[String]} [修改后的新字符串] */ function filterSpicalCharForRegx(value) { var spicalChar = ['\\', '^', '$', '.', '*', '+', '=', ':', '|', '/', '(', ')', '[', ']', '{', '}']; for (var i = 0; i < spicalChar.length; i++) { value = value.replace(spicalChar[i], '\\' + spicalChar[i]); } return value; } /** * [getDefaultData 获取默认的地址数据] * @param {[String]} url [默认地址数据url] */ function getDefaultData(url, callback) { $.loader.js(url, { onload: function() { callback(); } }); } /** * [filterAreaChanged 国内、海外筛选区域切换] * @param {Boolean} IsDomestic [国内or国外] */ function filterAreaChanged(IsDomestic) { if (IsDomestic) { $SSH_CityName.removeClass("hidden"); $SSH_CityName_Overseas.addClass("hidden"); $SSH_Keyword.addClass("inputSel").value(SSHMod.langConf.keyword_placeholder); // 保存国外的数据 if (!isPageInit) { PageData.city.overseas.id = $SSH_CityId.value(); PageData.city.overseas.py = $SSH_CityPY.value(); PageData.city.overseas.cityName = $SSH_CityName_Overseas.value().trim() === SSHMod.langConf.city_placeholder_domestic ? "" : $SSH_CityName_Overseas.value(); } // 切换到国内的数据 $SSH_CityId.value(PageData.city.domestic.id); $SSH_CityPY.value(PageData.city.domestic.py); $SSH_CityName.value(PageData.city.domestic.cityName || SSHMod.langConf.city_placeholder_domestic); updateNight({itemId: PageData.city.domestic.id}); setKeywordData({ isDomesitcFilter: true, itemId: PageData.city.domestic.id }); $SSH_CityName.addClass("inputSel"); if ($SSH_CityName.value().trim() !== "" && ($SSH_CityName.value().trim() !== SSHMod.langConf.city_placeholder_domestic)) { $SSH_CityName.removeClass("inputSel"); } } else { $SSH_CityName.addClass("hidden"); $SSH_CityName_Overseas.removeClass("hidden"); $SSH_Keyword.addClass("inputSel").value(SSHMod.langConf.keyword_placeholder); // 保存国内的数据 if (!isPageInit) { PageData.city.domestic.id = $SSH_CityId.value(); PageData.city.domestic.py = $SSH_CityPY.value(); PageData.city.domestic.cityName = $SSH_CityName.value().trim() === SSHMod.langConf.city_placeholder_domestic ? "" : $SSH_CityName.value(); } // 切换到国外的数据 $SSH_CityId.value(PageData.city.overseas.id); $SSH_CityPY.value(PageData.city.overseas.py); $SSH_CityName_Overseas.value(PageData.city.overseas.cityName || SSHMod.langConf.city_placeholder_domestic); updateNight({itemId: PageData.city.overseas.id}); setKeywordData({ isDomesitcFilter: false, itemId: PageData.city.overseas.id }); $SSH_CityName_Overseas.addClass("inputSel"); if ($SSH_CityName_Overseas.value().trim() !== "" && ($SSH_CityName_Overseas.value().trim() !== SSHMod.langConf.city_placeholder_domestic)) { $SSH_CityName_Overseas.removeClass("inputSel"); } } } /** * [setDropdownValue 设置下拉框的value] * @param {[DOM]} IptElem [dropdown trigger element] * @param {[DOM]} dropdownMenuElem [dropdown menu element] * @param {[Number]} selectedIndex [selected item index] */ function setDropdownValue(IptElem, dropdownMenuElem, selectedIndex) { var IptElem = $(IptElem), valueText = $(dropdownMenuElem).find("a").filter(":eq(" + selectedIndex + ")").text(); IptElem.attr("data-value", selectedIndex).value(valueText); } /** * [updateNight 根据所选城市更新游玩天数] * @param {[Object]} keywordArg [所选城市相关参数] */ function updateNight(keywordArg) { var _cityId = keywordArg.itemId; var url = SSHMod.langConf.url.getDays.replace('${id}', _cityId); $.loader.js(url); } /** * [setKeywordData 设置关键词选择器参数] * @param {[type]} opt [description] * opt = { itemId: 0, isDomesitcFilter: false, cityDisplay: '', keywordDisplay: '', isAirport: false }; */ function setKeywordData(opt) { if (!SSHMod.a_keyword) return; $SSH_Keyword.attr('url', ''); //$SSH_Keyword.attr('_type', opt.type); CURRENTCITY.isAddressSelected = true; //ie6 filter数据出不来bug setTimeout(function () { if (opt.keywordDisplay) { var kw = $SSH_Keyword; if (kw.length) { kw.value(opt.keywordDisplay); kw.attr('_lastvalue', kw.value()); } } if (opt.cityDisplay) { // 辨别国内、海外地址选择器 if (IsDomestic) { $SSH_CityName[0].value = opt.cityDisplay; } else { $SSH_CityName_Overseas[0].value = opt.cityDisplay; } $SSH_SearchBtn[0].focus(); } // 更改为景酒的关键词选择器接口 SSHMod.a_keyword.set('jsonpFilter', SSH_Address_Config.keywordFilter.replace('${id}', opt.itemId)); }, 0); } //================================================== RegMod ================================================== var RegMod = function (options) { this.init(options); this.startLoadMods(); this.initNotice(); this.initCalendar(); this.initDropDownMod(); this.initAddress(); this.initOverseasAddress(); this.initKeyword(); this.initValidate(); /* 首次加载以后需要Ajax请求用户的搜索历史记录，以初始化关键词选择器的jsonpSource */ this.initFirstKeywordContent(); }; $.extend(RegMod.prototype, { init: function(options) { this.ops = { domesticCity: [], overseasCity: [], startDate: [], endDate: [], keyword: [], checkInDate: [], checkOutDate: [] }; this.ops = $.extend(this.ops, options); }, startLoadMods: function() { var modConfig = { address: PluginsVersion.address, calendar: PluginsVersion.calendar, notice: PluginsVersion.notice, validate: PluginsVersion.validate }; $.mod.load("address", modConfig.address); $.mod.load("calendar", modConfig.calendar); $.mod.load("notice", modConfig.notice); $.mod.load("validate", modConfig.validate); }, initNotice: function() { this.ops.domesticCity.length && (SSHMod.n_domestic_city = this.ops.domesticCity.regMod("notice", PluginsVersion.notice, { name: "domestic_city", tips: SSHMod.langConf.city_placeholder_domestic, selClass: "inputSel" })); this.ops.overseasCity.length && (SSHMod.n_overseas_city = this.ops.overseasCity.regMod("notice", PluginsVersion.notice, { name: "overseas_city", tips: SSHMod.langConf.city_placeholder_domestic, selClass: "inputSel" })); this.ops.keyword.length && (SSHMod.n_keyword = this.ops.keyword.regMod("notice", PluginsVersion.notice, { name: "keyword", tips: SSHMod.langConf.keyword_placeholder, selClass: "inputSel" })); this.ops.checkInDate.length && (SSHMod.n_checkInDate = this.ops.checkInDate.regMod("notice", PluginsVersion.notice, { name: "checkInDate", tips: "yyyy-mm-dd", selClass: "inputSel" })); }, initValidate: function() { SSHMod.formValidator = $SSH_Form.regMod("validate", PluginsVersion.validate); SSHMod.showTips = function(t, e, i) { return "function" != typeof t.bind && (t = $(t)) && (t[0].blur()), "function" == typeof t.bind && (t[0].focus()), SSHMod.formValidator.method("show", { $obj: t, data: e, removeErrorClass: !0, hideEvent: i || "blur", isFocus: false, isScroll: false }), !1; }; }, initCalendar: function() { this.ops.checkInDate.length && (SSHMod.c_checkin_date = this.ops.checkInDate.regMod("calendar", PluginsVersion.calendar, { options: { showWeek: false, minDate: new Date() } }), this.ops.checkInDate.removeClass("inputSel").value(new Date().toFormatString("yyyy-MM-dd"))); }, initDropDownMod: function() { dropDownIsOverseas.reg($isOverseasWrap, { dropDownCallback: function() { $isOverseasArrow.removeClass("choice_icon_down").addClass("choice_icon_up"); }, dropUpCallback: function() { $isOverseasArrow.removeClass("choice_icon_up").addClass("choice_icon_down"); }, selectCallback: function(dropMenu, target) { if (target.getAttribute("data-value") === $isOverseasIpt.get(0).getAttribute("data-value")) return; var dataValue = target.getAttribute("data-value"); setDropdownValue($isOverseasIpt, $isOverseasDL, dataValue); IsDomestic = (dataValue === "0"); filterAreaChanged(IsDomestic); } }); // 初始化下拉菜单默认显示, 默认选中国内 setDropdownValue($isOverseasIpt, $isOverseasDL, 0); }, initAddress: function() { var $txtCity = this.ops.domesticCity; if ($txtCity.length < 0) return; SSHMod.a_domestic_city = $txtCity.regMod("address", PluginsVersion.address, { name: "SSH_CityName", jsonpSource: SSH_Address_Config.citySourceDomestic, jsonpFilter: SSH_Address_Config.cityFilterDomestic, isFocusNext: false, isAutoCorrect: false, delay: 200, relate: { 2: $SSH_CityId, 0: $SSH_CityPY }, message: { noFilterResult: '对不起，找不到：${$data.val}' }, keyboard: { left: false, right: false }, template: { padVersion: '2.0', suggestion: SSH_Address_Config.suggestionDomestic, suggestionIpad: SSH_Address_Config.suggestionIpadDomestic, suggestionStyle: SSH_Address_Config.suggestionStyleDomestic, suggestionStyleIpad: SSH_Address_Config.suggestionStyleIpadDomestic, suggestionInit: function (obj, test) { /** * 代码拷自address组件，实现tab切换， * 因为address组件只要用户配置了suggestionInit, 就不触发组件自己的suggestionInit，失去了tab切换功能 */ //must be opti var spans = obj.find('.tab_box li'); var uls = obj.find('div.city_item'); if (!spans.length) { return; } function switchTab() { var _this = this; spans.each(function (span, i) { if (span[0] == _this) { span.addClass('selected'); uls[i].style.display = ''; } else { span.removeClass('selected'); uls[i].style.display = 'none'; } }); } var w = 30; for (var i = 0, n = spans.length; i < n; i++) { w += spans[i].offsetWidth; } var t = obj.find('div').first(); if (t[0]) { if (w > 278) { t.css('width', '378px'); } } spans.bind('mousedown', switchTab); switchTab.apply(spans[0]); }, filterPageSize: 10, filter: SSH_Address_Config.filterDomestic, filterIpad: SSH_Address_Config.filterStyleIpadDomestic, filterStyle: SSH_Address_Config.filterStyleDomestic, filterStyleIpad: SSH_Address_Config.filterStyleDomestic } }); SSHMod.a_domestic_city.method('bind', 'change', function (mod, evt) { SSHMod.tmplFn.addressFilterChangeDomestic(mod, evt, $SSH_CityName[0]); }); var isSelect = true; SSHMod.a_domestic_city.method('bind', 'userinput', function (mod, evt) { var $cityId = $SSH_CityId; var $cityPY = $SSH_CityPY; //var cityVal = this.value; var cityVal = evt.autoCorrectValue; var _userBehaviorCityInfo = { "searchType": null, "cityId": $SSH_CityId.value(), "keyword": cityVal }; // 用户选择的目的地，不再验证。用户选择有以下几种： // * evt.eventType === 'suggestionMousedown' 鼠标选择suggestion的数据 // * evt.eventType === 'filterMousedown' 鼠标选择filter的数据 // * evt.eventType === 'keydown' && evt.data 键盘回车选择filter的数据 // * evt.eventType === 'keydown' && isSelect 一时想不起来什么情况了 //酒店搜索自动补全用户行为记录 if (evt.eventType === 'suggestionMousedown') { _userBehaviorCityInfo['searchType'] = "CTY_X"; w['__bfi'].push(['_tracklog', "SEARCH_AUTOCOMPLET_US", $.stringifyJSON(_userBehaviorCityInfo)]); } if (evt.eventType === 'filterMousedown' || evt.eventType === 'keydown') { _userBehaviorCityInfo['searchType'] = "CTY_BS"; _userBehaviorCityInfo['Yindex'] = (evt.target && $(evt.target).attr("data-yindex")); _userBehaviorCityInfo['inputkeyword'] = evt.value; _userBehaviorCityInfo['fulldata'] = evt.data; w['__bfi'].push(['_tracklog', "SEARCH_AUTOCOMPLET_US", $.stringifyJSON(_userBehaviorCityInfo)]); } // if (evt.eventType === 'suggestionMousedown' || evt.eventType === 'filterMousedown' || (evt.eventType === 'keydown' && (isSelect || evt.data))) { isSelect = true; return; } // 用户选择，之后失去焦点时，也不再验证 if (evt.eventType === 'blur' && isSelect) return; var queryCityId = ''; if (!this.value || this.value == $cityId.attr('_lastvalue')) { queryCityId = $cityId.value(); } function clearCity() { //$txtCity.value(''); $txtCity.addClass("inputSel").value(SSHMod.langConf.city_placeholder_domestic); $txtCity.attr('_lastvalue', ''); //SSHMod.a_domestic_city.method('resetValue'); $cityId.value(''); $cityId.attr('_lastvalue', ''); $cityPY.value(''); $cityPY.attr('_lastvalue', ''); } var url = SSHMod.a_domestic_city.get('jsonpFilter').replace('${key}', encodeURIComponent(escape($txtCity.value()))); $.loader.js(url, { type: 'text/javascript', charset: 'utf-8', async: true, cache: false, onload: function () { if (cQuery.isEmptyObject(cQuery.jsonpResponse)) { clearCity(); return; } var resultData = cQuery.jsonpResponse; var data = resultData.data; var cityList = data.match(/[^@]+\|[^@]+/g); if (cityList && cityList.length > 0) { var cityData = cityList[0].split('|'); evt.items = cityData; SSHMod.tmplFn.addressFilterChangeDomestic(mod, evt, $SSH_CityName[0]); cQuery.jsonpResponse = {}; } else { clearCity(); } w.$_bf.tracklog("SSHcity", makeTrackLogVals(resultData.key, $txtCity.value())); }, onerror: clearCity }); }); // 以下enter键支持可以删除 $txtCity.bind('focus', function () { CITYENTER = true; }).bind('keydown', function (e) { if (e.keyCode == 13) { isSelect = true; if (!CITYENTER || $txtCity.attr('_lastvalue') != this.value) { CITYENTER = true; e.stop(); if ($('.notfound_pop').length > 0) { //SSHMod.a_domestic_city.method('resetValue'); } setTimeout(function () { $txtCity[0].blur(); setTimeout(function () { //SSHSearch.submit(false, true); // TODO }, 500); }, 100); } else { setTimeout(function () { if (HotelSearch.submit()) { // TODO } else { $(this).get(0).focus(); } }, 500); } } else { isSelect = false; } }); }, initOverseasAddress: function() { var $txtCity = this.ops.overseasCity; if ($txtCity.length < 0) return; SSHMod.a_overseas_city = $txtCity.regMod("address", PluginsVersion.address, { name: "SSH_CityName_Overseas", jsonpSource: SSH_Address_Config.citySource, jsonpFilter: SSH_Address_Config.cityFilter, isFocusNext: false, isAutoCorrect: false, delay: 200, relate: { 4: $SSH_CityId, 5: $SSH_CityPY }, template: { suggestion: SSH_Address_Config.suggestion, suggestionIpad: SSH_Address_Config.suggestionIpad, suggestionStyle: SSH_Address_Config.suggestionStyle, suggestionStyleIpad: SSH_Address_Config.suggestionStyleIpad, suggestionInit: function (obj, test) { /** * 代码拷自address组件，实现tab切换， * 因为address组件只要用户配置了suggestionInit, 就不触发组件自己的suggestionInit，失去了tab切换功能 */ //must be opti var spans = obj.find('.tab_box li'); var uls = obj.find('div.city_item'); if (!spans.length) { return; } function switchTab() { var _this = this; spans.each(function (span, i) { if (span[0] == _this) { span.addClass('selected'); uls[i].style.display = ''; } else { span.removeClass('selected'); uls[i].style.display = 'none'; } }); } var w = 30; for (var i = 0, n = spans.length; i < n; i++) { w += spans[i].offsetWidth; } var t = obj.find('div').first(); if (t[0]) { if (w > 278) { t.css('width', '378px'); } } spans.bind('mousedown', switchTab); switchTab.apply(spans[0]); }, filter: SSH_Address_Config.filter, filterIpad: SSH_Address_Config.filterIpad, filterPageSize: -1, filterStyle: SSH_Address_Config.filterStyle, filterStyleIpad: SSH_Address_Config.filterStyle } }); SSHMod.a_overseas_city.method('bind', 'change', function (mod, evt) { SSHMod.tmplFn.addressFilterChange(mod, evt, $SSH_CityName_Overseas[0]); }); var isSelect = true; SSHMod.a_overseas_city.method('bind', 'userinput', function (mod, evt) { var $cityId = $SSH_CityId; var $cityPY = $SSH_CityPY; //var cityVal = this.value; var cityVal = evt.autoCorrectValue; var _userBehaviorCityInfo = { "searchType": null, "cityId": $SSH_CityId.value(), "keyword": cityVal }; // 用户选择的目的地，不再验证。用户选择有以下几种： // * evt.eventType === 'suggestionMousedown' 鼠标选择suggestion的数据 // * evt.eventType === 'filterMousedown' 鼠标选择filter的数据 // * evt.eventType === 'keydown' && evt.data 键盘回车选择filter的数据 // * evt.eventType === 'keydown' && isSelect 一时想不起来什么情况了 //酒店搜索自动补全用户行为记录 if (evt.eventType === 'suggestionMousedown') { _userBehaviorCityInfo['searchType'] = "CTY_X"; w['__bfi'].push(['_tracklog', "SEARCH_AUTOCOMPLET_US", $.stringifyJSON(_userBehaviorCityInfo)]); } if (evt.eventType === 'filterMousedown' || evt.eventType === 'keydown') { _userBehaviorCityInfo['searchType'] = "CTY_BS"; _userBehaviorCityInfo['Yindex'] = (evt.target && $(evt.target).attr("data-yindex")); _userBehaviorCityInfo['inputkeyword'] = evt.value; _userBehaviorCityInfo['fulldata'] = evt.data; w['__bfi'].push(['_tracklog', "SEARCH_AUTOCOMPLET_US", $.stringifyJSON(_userBehaviorCityInfo)]); } // if (evt.eventType === 'suggestionMousedown' || evt.eventType === 'filterMousedown' || (evt.eventType === 'keydown' && (isSelect || evt.data))) { isSelect = true; return; } // 用户选择，之后失去焦点时，也不再验证 if (evt.eventType === 'blur' && isSelect) return; var queryCityId = ''; if (!this.value || this.value == $cityId.attr('_lastvalue')) { queryCityId = $cityId.value(); } function clearCity() { //$txtCity.value(''); $txtCity.addClass("inputSel").value(SSHMod.langConf.city_placeholder_domestic); $txtCity.attr('_lastvalue', ''); //SSHMod.n_overseas_city.method('resetValue'); $cityId.value(''); $cityId.attr('_lastvalue', ''); $cityPY.value(''); $cityPY.attr('_lastvalue', ''); } var url = SSHMod.a_overseas_city.get('jsonpFilter').replace('${key}', encodeURIComponent(escape($txtCity.value()))); $.loader.js(url, { type: 'text/javascript', charset: 'utf-8', async: true, cache: false, onload: function () { if (cQuery.isEmptyObject(cQuery.jsonpResponse)) { clearCity(); return; } var resultData = cQuery.jsonpResponse; var data = resultData.data; var cityList = data.match(/[^@]+\|/g); if (cityList && cityList.length > 0) { var cityData = cityList[0].split('|'); evt.items = cityData; SSHMod.tmplFn.addressFilterChange(mod, evt, $SSH_CityName_Overseas[0]); cQuery.jsonpResponse = {}; } else { clearCity(); } w.$_bf.tracklog("SSHcity", makeTrackLogVals(resultData.key, $txtCity.value())); }, onerror: clearCity }); }); // 以下enter键支持可以删除 $txtCity.bind('focus', function () { CITYENTER = true; }).bind('keydown', function (e) { if (e.keyCode == 13) { isSelect = true; if (!CITYENTER || $txtCity.attr('_lastvalue') != this.value) { CITYENTER = true; e.stop(); if ($('.notfound_pop').length > 0) { //SSHMod.n_overseas_city.method('resetValue'); } setTimeout(function () { $txtCity[0].blur(); setTimeout(function () { //SSHSearch.submit(false, true); // TODO }, 500); }, 100); } else { setTimeout(function () { if (HotelSearch.submit()) { // TODO } else { $(this).get(0).focus(); } }, 500); } } else { isSelect = false; } }); }, initKeyword: function() { var $keyword = this.ops.keyword; if ($keyword.length) { SSHMod.a_keyword = $keyword.regMod("address", PluginsVersion.address, { name: "SSH_Keyword", isFocusNext: false, isAutoCorrect: false, delay: 200, template: { padVersion: '2.0', suggestion: '' }, source: { suggestion: '', data: '' } }); SSHMod.a_keyword.method("bind", "change", function (event, data) { data.items && $keyword.value(data.items[1] ? data.items[1].split('，')[0] : ""); $keyword.trigger("blur"); }); } }, initFirstKeywordContent: function() { // 读取默认选中的城市数据 getDefaultData(SSHMod.langConf.url.getDefaultData, function() { filterAreaChanged(IsDomestic); isPageInit = false; }); } }); //================================================== SSHSearch ================================================== var SSHSearch = { init: function() { new RegMod({ domesticCity: $SSH_CityName, overseasCity: $SSH_CityName_Overseas, checkInDate: $SSH_CheckInDate, keyword: $SSH_Keyword }); this.bindEvent(); }, bindEvent: function() { var me = this; $SSH_SearchBtn.bind("click", function(){ $(this).removeClass('s_btn_ing2').value(SSHMod.langConf.buttonText.defaults); if (me.submit()) { $(this).addClass('s_btn_ing2').value(SSHMod.langConf.buttonText.loading); var _areaType = IsDomestic ? 1 : 2, _keywords = $SSH_Keyword.value(), _destcity = $SSH_CityId.value(), _checkInDate = $SSH_CheckInDate.value(), _playdays = $SSH_Playdays.value(), _star = $SSH_HotelLevel.value(), _url = ""; _url = "&SearchClass=-1" + "&AreaType=" + _areaType + "&destcity=" + _destcity + (_keywords !== "" ? ("&keywords=" + escape(_keywords)) : "") + (_checkInDate ? ("&checkInDate=" + _checkInDate) : "") + (_playdays !== "0" ? ("&playdays=" + _playdays) : "") + (_star !== "0" ? ("&star=" + _star) : ""); var SSH_SearchURL = 'http://taocan.ctrip.com/sh/search?fluxentrance=10404&kwfrom=7004204&FromMenu=hotel'; /* PRO: 生产, UAT_NT：UAT, FAT: 测试 */ if (/^FAT/i.test(solution)) { SSH_SearchURL = 'http://taocan.fat2.qa.nt.ctripcorp.com/sh/search?fluxentrance=10404&kwfrom=7004204&FromMenu=hotel'; } else if (/^UAT_NT/i.test(solution)) { SSH_SearchURL = 'http://taocan.ctrip.uat.qa.nt.ctripcorp.com/sh/search?fluxentrance=10404&kwfrom=7004204&FromMenu=hotel'; } location.href = SSH_SearchURL + _url; } }); }, submit: function() { var $curCityIpt = IsDomestic ? $SSH_CityName : $SSH_CityName_Overseas; if ($curCityIpt.value() === "") { SSHMod.showTips($curCityIpt, SSHMod.langConf.notice.city); return false; } if ($SSH_CityId.value() === "") { SSHMod.showTips($curCityIpt, SSHMod.langConf.notice.noExistCity.replace('{city}', $curCityIpt.value())); return false; } var _checkInDate = $SSH_CheckInDate.value(); if (_checkInDate != "") { var _dt1 = _checkInDate.toDate() || 0, _today = new Date().toDate(); if (!_dt1) { SSHMod.showTips($SSH_CheckInDate, SSHMod.langConf.notice.dateErr); return false; } if (_dt1 < _today) { SSHMod.showTips($SSH_CheckInDate, SSHMod.langConf.notice.too_early_in); return false; } } return true; } }; SSHSearch.init(); })(window, document, cQuery) /** * [getDays 按城市ID获取游玩天数] * @param {[Object]} rs [响应的json转换后的对象] */ function getDays(rs) { var _sel = document.getElementById("SSH_SelectNight"); for (var i = 0, _len = _sel.options.length; i < _len; i++) { _sel.options[_sel.options.selectedIndex] = null; } document.getElementById("SSH_SelectNight").options.add(new Option("不限", 0)); for (var i = 0; i < rs.data.length; i++) { document.getElementById("SSH_SelectNight").options.add(new Option(rs.data[i].name, rs.data[i].playdays)); } } /** * [getDestCity 获取国内外默认城市，初始化默认参数] * @param {[Object]} rs [响应的json转换后的对象] */ function getDestCity(res) { if (!res) return; //var _rs = cQuery.parseJSON(res); var _rs = res; if(_rs.domestic) { cQuery.extend(PageData.city.domestic, _rs.domestic); // 在地址为空时，保持和地址选择器统一的赋值，即为""，而非"0" (PageData.city.domestic.id === "0") && (PageData.city.domestic.id = ""); } if (_rs.overseas) { cQuery.extend(PageData.city.overseas, _rs.overseas); // 在地址为空时，保持和地址选择器统一的赋值，即为""，而非"0" (PageData.city.overseas.id === "0") && (PageData.city.overseas.id = ""); } } /** * [getOverseasCities 获取目的地选择器suggestion海外城市数据] * @param {[Object]} res [response] */ function getOverseasCities(res) { window.overseasDesData = res.cities; }/*****$endoflist$*****/